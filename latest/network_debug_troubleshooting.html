

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="text/javascript" src="//www.redhat.com/dtm.js"></script>

  <!-- Google Tag Manager Data Layer -->
  <script>
   dataLayer = [];
  </script>
  <!-- End Google Tag Manager Data Layer -->




  
  <title>Network Debug and Troubleshooting Guide &mdash; Ansible Documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'2.4',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  false
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Ansible Documentation" href="index.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  <style>
    .search-reset-start {
        color: #463E3F;
        float: right;
        position: relative;
        top: -25px;
        left: -10px;
        z-index: 10;
     }
     .search-reset-start:hover {
        cursor: pointer;
        color: #2980B9;
     }
     #search-box-id {
        padding-right: 25px;
     }
  </style>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300'
    rel='stylesheet' type='text/css'>

</head>

<body class="wy-body-for-nav">

  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
  <!-- End Google Tag Manager -->

    <div class="DocSite-globalNav ansibleNav">
        <ul>
            <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
            <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
            <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
            <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
            <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
        </ul>
    </div>

  <a class="DocSite-nav" href="/">
    <img class="DocSiteNav-logo"
      src="_static/images/logo_invert.png"
      alt="Ansible Logo">
    <div class="DocSiteNav-title">
      Documentation
    </div>
  </a>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">

      <div style="background-color:#5bbdbf;height=80px;margin:'auto auto auto auto'">
        <a class="DocSiteProduct-header DocSiteProduct-header--core" href="/">
            <div class="DocSiteProduct-productName">
                <div class="DocSiteProduct-logoText">
                    Ansible  
                    <div class="DocSiteProduct-CurrentVersion" align="right">
                      v2.4
                  </div>
                </div>
            </div>
        </a>
        

          <div class="DocSiteProduct-CheckVersionPara">For previous versions, see the  <a class="DocSiteProduct-versionheader" href="/#coreversionselect">documentation archive.</a></div>
      </div>

      <div id="menu-id" class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_inventory.html">Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_dynamic_inventory.html">Dynamic Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_adhoc.html">Introduction To Ad-Hoc Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_configuration.html">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_bsd.html">BSD Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_windows.html">Windows Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_networking.html">Networking Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Video</a></li>
<li class="toctree-l1"><a class="reference internal" href="playbooks.html">Playbooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="playbooks_intro.html">Intro to Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_reuse.html">Creating Reusable Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_templating.html">Templating (Jinja2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_strategies.html">Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_best_practices.html">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="playbooks_special_topics.html">Playbooks: Special Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="become.html">Become (Privilege Escalation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_acceleration.html">Accelerated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_async.html">Asynchronous Actions and Polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_checkmode.html">Check Mode (&#8220;Dry Run&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_debugger.html">Playbook Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_delegation.html">Delegation, Rolling Updates, and Local Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_environment.html">Setting the Environment (and Working With Proxies)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_environment.html#working-with-language-specific-version-managers">Working With Language-Specific Version Managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling.html">Error Handling In Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_lookups.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_prompts.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_tags.html">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_vault.html">Using Vault in playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_startnstep.html">Start and Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_keywords.html">Directives Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">About Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules_intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_return_values.html">Return Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules_support.html">Module Maintenance &amp; Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules_by_category.html">Module Index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="list_of_all_modules.html">All Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_cloud_modules.html">Cloud Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_clustering_modules.html">Clustering Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_commands_modules.html">Commands Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_crypto_modules.html">Crypto Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_database_modules.html">Database Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_files_modules.html">Files Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_identity_modules.html">Identity Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_inventory_modules.html">Inventory Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_messaging_modules.html">Messaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_monitoring_modules.html">Monitoring Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_net_tools_modules.html">Net Tools Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_network_modules.html">Network Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_notification_modules.html">Notification Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_packaging_modules.html">Packaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_remote_management_modules.html">Remote Management Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_source_control_modules.html">Source Control Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_storage_modules.html">Storage Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_system_modules.html">System Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_utilities_modules.html">Utilities Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_web_infrastructure_modules.html">Web Infrastructure Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_windows_modules.html">Windows Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vault.html">Ansible Vault</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vault.html#what-can-be-encrypted-with-vault">What Can Be Encrypted With Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#creating-encrypted-files">Creating Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#editing-encrypted-files">Editing Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#rekeying-encrypted-files">Rekeying Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#encrypting-unencrypted-files">Encrypting Unencrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#decrypting-encrypted-files">Decrypting Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#viewing-encrypted-files">Viewing Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#use-encrypt-string-to-create-encrypted-variables-to-embed-in-yaml">Use encrypt_string to create encrypted variables to embed in yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#vault-ids-and-multiple-vault-passwords">Vault Ids and Multiple Vault Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#providing-vault-passwords">Providing Vault Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#speeding-up-vault-operations">Speeding Up Vault Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#vault-format">Vault Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#vault-payload-format-1-1">Vault Payload Format 1.1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Command Line Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-playbook.html">ansible-playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-vault.html">ansible-vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-galaxy.html">ansible-galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-console.html">ansible-console</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-config.html">ansible-config</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-doc.html">ansible-doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-inventory.html">ansible-inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-pull.html">ansible-pull</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Detailed Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="guide_aws.html">Amazon Web Services Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_azure.html">Getting Started with Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rax.html">Rackspace Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_gce.html">Google Cloud Platform Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_cloudstack.html">CloudStack Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_vagrant.html">Using Vagrant and Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade.html">Continuous Delivery and Rolling Upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_docker.html">Getting Started with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_packet.html">Using Ansible with the Packet host</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide/index.html">Developer Information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_guide/index.html#ansible-developer-guide">Ansible Developer Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community Information &amp; Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="community.html#ansible-users">Ansible Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#for-current-and-prospective-developers">For Current and Prospective Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#other-topics">Other Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#community-code-of-conduct">Community Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#contributors-license-agreement">Contributors License Agreement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="galaxy.html">Ansible Galaxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-website">The Website</a></li>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-command-line-tool">The command line tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_strategies.html">Testing Strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-ansible-playbooks">Integrating Testing With Ansible Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#the-right-level-of-testing">The Right Level of Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#check-mode-as-a-drift-test">Check Mode As A Drift Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#modules-that-are-useful-for-testing">Modules That Are Useful for Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#testing-lifecycle">Testing Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-rolling-updates">Integrating Testing With Rolling Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#achieving-continuous-deployment">Achieving Continuous Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-set-the-path-or-any-other-environment-variable-for-a-task-or-entire-playbook">How can I set the PATH or any other environment variable for a task or entire playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-different-machines-needing-different-user-accounts-or-ports-to-log-in-with">How do I handle different machines needing different user accounts or ports to log in with?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-get-ansible-to-reuse-connections-enable-kerberized-ssh-or-have-ansible-pay-attention-to-my-local-ssh-config-file">How do I get ansible to reuse connections, enable Kerberized SSH, or have Ansible pay attention to my local SSH config file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to">How do I configure a jump host to access servers that I have no direct access to?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-speed-up-management-inside-ec2">How do I speed up management inside EC2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine">How do I handle python pathing not having a Python 2.X in /usr/bin/python on a remote machine?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-best-way-to-make-content-reusable-redistributable">What is the best way to make content reusable/redistributable?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#where-does-the-configuration-file-live-and-what-can-i-configure-in-it">Where does the configuration file live and what can I configure in it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-disable-cowsay">How do I disable cowsay?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-a-list-of-all-of-the-ansible-variables">How do I see a list of all of the ansible_ variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-all-the-inventory-vars-defined-for-my-host">How do I see all the inventory vars defined for my host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template">How do I loop over a list of hosts in a group, inside of a template?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-name-programmatically">How do I access a variable name programmatically?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-of-the-first-host-in-a-group">How do I access a variable of the first host in a group?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-copy-files-recursively-onto-a-target-host">How do I copy files recursively onto a target host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-shell-environment-variables">How do I access shell environment variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-generate-crypted-passwords-for-the-user-module">How do I generate crypted passwords for the user module?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#can-i-get-training-on-ansible">Can I get training on Ansible?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#is-there-a-web-interface-rest-api-etc">Is there a web interface / REST API / etc?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-submit-a-change-to-the-documentation">How do I submit a change to the documentation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-keep-secret-data-in-my-playbook">How do I keep secret data in my playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#when-should-i-use-also-how-to-interpolate-variables-or-dynamic-variable-names">When should I use {{ }}? Also, how to interpolate variables or dynamic variable names</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-don-t-you-ship-in-x-format">Why don&#8217;t you ship in X format?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#i-don-t-see-my-question-here">I don&#8217;t see my question here</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="config.html#common-options">Common Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="YAMLSyntax.html">YAML Syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#yaml-basics">YAML Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guides.html">Ansible Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_3_support.html">Python 3 Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python_3_support.html#testing-python-3-with-commands-and-playbooks">Testing Python 3 with commands and playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_3_support.html#testing-python-3-module-support">Testing Python 3 module support</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_3_support.html#what-to-do-if-an-incompatibility-is-found">What to do if an incompatibility is found</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_and_maintenance.html">Release and maintenance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release_and_maintenance.html#release-cycle">Release cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_and_maintenance.html#release-status">Release status</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_and_maintenance.html#development-and-stable-version-maintenance-workflow">Development and stable version maintenance workflow</a></li>
</ul>
</li>
</ul>

        


    <div class="DocSite-sideNav ansibleNav">
       <ul class="">
       <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
       <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
       <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
       <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
       <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
       </ul>
     </div>

    <!-- changeable widget -->
    <div id="sideBanner">
    <br/>
    <a href="https://www.ansible.com/docs-left?utm_source=docs">
      <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
    </a>
    </div>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Ansible Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <!-- Banner ads
          <div class="DocSiteBanner">
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-left.png">
            </a>
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-right.png">
            </a>
        </div> -->

          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Network Debug and Troubleshooting Guide</a></li>
  
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/ansible/ansible/blob/devel/docs/docsite/rst/network_debug_troubleshooting.rst" class="icon icon-github"> Edit on GitHub</a>
    </li>
  
</ul>
<hr/>

          <div id="page-content">
          
  <div class="section" id="network-debug-and-troubleshooting-guide">
<span id="network-debug-troubleshooting"></span><h1><a class="toc-backref" href="#id1">Network Debug and Troubleshooting Guide</a><a class="headerlink" href="#network-debug-and-troubleshooting-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="#network-debug-and-troubleshooting-guide" id="id1">Network Debug and Troubleshooting Guide</a><ul>
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#how-to-troubleshoot" id="id3">How to troubleshoot</a><ul>
<li><a class="reference internal" href="#enabling-networking-logging-and-how-to-read-the-logfile" id="id4">Enabling Networking logging and how to read the logfile</a></li>
<li><a class="reference internal" href="#isolating-an-error" id="id5">Isolating an error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#category-unable-to-open-shell" id="id6">Category &#8220;Unable to open shell&#8221;</a><ul>
<li><a class="reference internal" href="#error-errno-2-name-or-service-not-known" id="id7">Error: &#8220;[Errno -2] Name or service not known&#8221;</a></li>
<li><a class="reference internal" href="#error-authentication-failed" id="id8">Error: &#8220;Authentication failed&#8221;</a></li>
<li><a class="reference internal" href="#error-connecting-to-host-hostname-returned-an-error-or-bad-address" id="id9">Error: &#8220;connecting to host &lt;hostname&gt; returned an error&#8221; or &#8220;Bad address&#8221;</a></li>
<li><a class="reference internal" href="#error-no-authentication-methods-available" id="id10">Error: &#8220;No authentication methods available&#8221;</a></li>
<li><a class="reference internal" href="#clearing-out-persistent-connections" id="id11">Clearing Out Persistent Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#timeout-issues" id="id12">Timeout issues</a><ul>
<li><a class="reference internal" href="#timeouts" id="id13">Timeouts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#playbook-issues" id="id14">Playbook issues</a><ul>
<li><a class="reference internal" href="#error-invalid-connection-specified-expected-connection-local-got-ssh" id="id15">Error: &#8220;invalid connection specified, expected connection=local, got ssh&#8221;</a></li>
<li><a class="reference internal" href="#error-unable-to-enter-configuration-mode" id="id16">Error: &#8220;Unable to enter configuration mode&#8221;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#proxy-issues" id="id17">Proxy Issues</a><ul>
<li><a class="reference internal" href="#delegate-to-vs-proxycommand" id="id18">delegate_to vs ProxyCommand</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Starting with Ansible version 2.1, you can now use the familiar Ansible models of playbook authoring and module development to manage heterogeneous networking devices. Ansible supports a growing number of network devices using both CLI over SSH and API (when available) transports.</p>
<p>This section discusses how to debug and troubleshoot network modules in Ansible 2.3.</p>
</div>
<div class="section" id="how-to-troubleshoot">
<h2><a class="toc-backref" href="#id3">How to troubleshoot</a><a class="headerlink" href="#how-to-troubleshoot" title="Permalink to this headline">¶</a></h2>
<p>This section covers troubleshooting issues with Network Modules.</p>
<p>Errors generally fall into one of the following categories:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Authentication issues:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first simple">
<li>Not correctly specifying credentials</li>
<li>Remote device (network switch/router) not falling back to other other authentication methods</li>
<li>SSH key issues</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Timeout issues:</th><td class="field-body"><ul class="first simple">
<li>Can occur when trying to pull a large amount of data</li>
<li>May actually be masking a authentication issue</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Playbook issues:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li>Use of <code class="docutils literal"><span class="pre">delegate_to</span></code>, instead of <code class="docutils literal"><span class="pre">ProxyCommand</span></code>. See <a class="reference internal" href="#network-delegate-to-vs-proxycommand"><span class="std std-ref">network proxy guide</span></a> for more information.</li>
<li>Not using <code class="docutils literal"><span class="pre">connection:</span> <span class="pre">local</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><code class="docutils literal"><span class="pre">unable</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">shell</span></code></p>
<p class="last">The <code class="docutils literal"><span class="pre">unable</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">shell</span></code> message is new in Ansible 2.3, it means that the <code class="docutils literal"><span class="pre">ansible-connection</span></code> daemon has not been able to successfully
talk to the remote network device. This generally means that there is an authentication issue. See the &#8220;Authentication and connection issues&#8221; section
in this document for more information.</p>
</div>
<div class="section" id="enabling-networking-logging-and-how-to-read-the-logfile">
<span id="enable-network-logging"></span><h3><a class="toc-backref" href="#id4">Enabling Networking logging and how to read the logfile</a><a class="headerlink" href="#enabling-networking-logging-and-how-to-read-the-logfile" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> Any</p>
<p>Ansible 2.3 features improved logging to help diagnose and troubleshoot issues regarding Ansible Networking modules.</p>
<p>Because logging is very verbose it is disabled by default. It can be enabled via the <span class="target" id="index-0"></span><a class="reference internal" href="config.html#envvar-ANSIBLE_LOG_PATH"><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_LOG_PATH</span></code></a> and <span class="target" id="index-1"></span><a class="reference internal" href="config.html#envvar-ANSIBLE_DEBUG"><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_DEBUG</span></code></a> options:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># Specify the location for the log file</span>
<span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_LOG_PATH=~/ansible.log</span>
<span class="l l-Scalar l-Scalar-Plain"># Enable Debug</span>
<span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_DEBUG=True</span>

<span class="l l-Scalar l-Scalar-Plain"># Run with 4*v for connection level verbosity</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-playbook -vvvv ...</span>
</pre></div>
</div>
<p>After Ansible has finished running you can inspect the log file:</p>
<div class="code highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:19:52,740 p=28990 u=fred |  creating new control socket for host veos01:22 as user admin</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:19:52,741 p=28990 u=fred |  control socket path is /home/fred/.ansible/pc/ca5960d27a</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:19:52,741 p=28990 u=fred |  current working directory is /home/fred/ansible/test/integration</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:19:52,741 p=28990 u=fred |  using connection plugin network_cli</span>
<span class="nn">...</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:20:14,771 paramiko.transport userauth is OK</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:20:15,283 paramiko.transport Authentication (keyboard-interactive) successful!</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:20:15,302 p=28990 u=fred |  ssh connection done, setting terminal</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:20:15,321 p=28990 u=fred |  ssh connection has completed successfully</span>
<span class="l l-Scalar l-Scalar-Plain">2017-03-30 13:20:15,322 p=28990 u=fred |  connection established to veos01 in 0:00:22.580626</span>
</pre></div>
</div>
<p>From the log notice:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">p=28990</span></code> Is the PID (Process ID) of the <code class="docutils literal"><span class="pre">ansible-connection</span></code> process</li>
<li><code class="docutils literal"><span class="pre">u=fred</span></code> Is the user <cite>running</cite> ansible, not the remote-user you are attempting to connect as</li>
<li><code class="docutils literal"><span class="pre">creating</span> <span class="pre">new</span> <span class="pre">control</span> <span class="pre">socket</span> <span class="pre">for</span> <span class="pre">host</span> <span class="pre">veos01:22</span> <span class="pre">as</span> <span class="pre">user</span> <span class="pre">admin</span></code> host:port as user</li>
<li><code class="docutils literal"><span class="pre">control</span> <span class="pre">socket</span> <span class="pre">path</span> <span class="pre">is</span></code> location on disk where the persistent connection socket is created</li>
<li><code class="docutils literal"><span class="pre">using</span> <span class="pre">connection</span> <span class="pre">plugin</span> <span class="pre">network_cli</span></code> Informs you that persistent connection is being used</li>
<li><code class="docutils literal"><span class="pre">connection</span> <span class="pre">established</span> <span class="pre">to</span> <span class="pre">veos01</span> <span class="pre">in</span> <span class="pre">0:00:22.580626</span></code> Time taken to obtain a shell on the remote device</li>
</ul>
<p>Because the log files are verbose, you can use grep to look for specific information. For example, once you have identified the <code class="docutils literal"><span class="pre">`pid</span></code> from the <code class="docutils literal"><span class="pre">creating</span> <span class="pre">new</span> <span class="pre">control</span> <span class="pre">socket</span> <span class="pre">for</span> <span class="pre">host</span></code> line you can search for other connection log entries:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">grep &quot;p=28990&quot; $ANSIBLE_LOG_PATH</span>
</pre></div>
</div>
</div>
<div class="section" id="isolating-an-error">
<h3><a class="toc-backref" href="#id5">Isolating an error</a><a class="headerlink" href="#isolating-an-error" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> Any</p>
<p>As with any effort to troubleshoot it&#8217;s important to simplify the test case as much as possible.</p>
<p>For Ansible this can be done by ensuring you are only running against one remote device:</p>
<ul class="simple">
<li>Using <code class="docutils literal"><span class="pre">ansible-playbook</span> <span class="pre">--limit</span> <span class="pre">switch1.example.net...</span></code></li>
<li>Using an ad-hoc <code class="docutils literal"><span class="pre">ansible</span></code> command</li>
</ul>
<p><cite>ad-hoc</cite> refers to running Ansible to perform some quick command using <code class="docutils literal"><span class="pre">/usr/bin/ansible</span></code>, rather than the orchestration language, which is <code class="docutils literal"><span class="pre">/usr/bin/ansible-playbook</span></code>. In this case we can ensure connectivity by attempting to execute a single command on the remote device:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible -m eos_command -a &#39;commands=?&#39; -i inventory switch1.example.net -e &#39;ansible_connection=local&#39; -u admin -k</span>
</pre></div>
</div>
<p>In the above example, we:</p>
<ul class="simple">
<li>connect to <code class="docutils literal"><span class="pre">switch1.example.net</span></code> specified in the inventory file <code class="docutils literal"><span class="pre">inventory</span></code></li>
<li>use the module <code class="docutils literal"><span class="pre">eos_command</span></code></li>
<li>run the command <code class="docutils literal"><span class="pre">?</span></code></li>
<li>connect using the username <code class="docutils literal"><span class="pre">admin</span></code></li>
<li>inform ansible to prompt for the ssh password by specifying <code class="docutils literal"><span class="pre">-k</span></code></li>
</ul>
<p>If you have SSH keys configured correctly, you don&#8217;t need to specify the <code class="docutils literal"><span class="pre">-k</span></code> parameter</p>
<p>If the connection still fails you can combine it with the enable_network_logging parameter. For example:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># Specify the location for the log file</span>
<span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_LOG_PATH=~/ansible.log</span>
<span class="l l-Scalar l-Scalar-Plain"># Enable Debug</span>
<span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_DEBUG=True</span>
<span class="l l-Scalar l-Scalar-Plain"># Run with 4*v for connection level verbosity</span>
<span class="l l-Scalar l-Scalar-Plain">ansible -m eos_command -a &#39;commands=?&#39; -i inventory switch1.example.net -e &#39;ansible_connection=local&#39; -u admin -k</span>
</pre></div>
</div>
<p>Then review the log file and find the relevant error message in the rest of this document.</p>
</div>
</div>
<div class="section" id="category-unable-to-open-shell">
<span id="unable-to-open-shell"></span><h2><a class="toc-backref" href="#id6">Category &#8220;Unable to open shell&#8221;</a><a class="headerlink" href="#category-unable-to-open-shell" title="Permalink to this headline">¶</a></h2>
<p><strong>Platforms:</strong> Any</p>
<p>The <code class="docutils literal"><span class="pre">unable</span> <span class="pre">to</span> <span class="pre">open</span> <span class="pre">shell</span></code> message is new in Ansible 2.3. This message means that the <code class="docutils literal"><span class="pre">ansible-connection</span></code> daemon has not been able to successfully talk to the remote network device. This generally means that there is an authentication issue. It is a &#8220;catch all&#8221; message, meaning you need to enable <a class="reference internal" href="intro_configuration.html#log-path"><span class="std std-ref">log_path</span></a> to find the underlying issues.</p>
<p>For example:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>TASK [prepare_eos_tests : enable cli on remote device] **************************************************
fatal: [veos01]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;failed&quot;: true, &quot;msg&quot;: &quot;unable to open shell&quot;}
</pre></div>
</div>
<p>or:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>TASK [ios_system : configure name_servers] *************************************************************
task path:
fatal: [ios-csr1000v]: FAILED! =&gt; {
    &quot;changed&quot;: false,
    &quot;failed&quot;: true,
    &quot;msg&quot;: &quot;unable to open shell&quot;,
}
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>Follow the steps detailed in <a class="reference internal" href="#enable-network-logging">enable_network_logging</a>.</p>
<p>Once you&#8217;ve identified the error message from the log file, the specific solution can be found in the rest of this document.</p>
<div class="section" id="error-errno-2-name-or-service-not-known">
<h3><a class="toc-backref" href="#id7">Error: &#8220;[Errno -2] Name or service not known&#8221;</a><a class="headerlink" href="#error-errno-2-name-or-service-not-known" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> Any</p>
<p>Indicates that the remote host you are trying to connect to can not be reached</p>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-04-04 11:39:48,147 p=15299 u=fred |  control socket path is /home/fred/.ansible/pc/ca5960d27a</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 11:39:48,147 p=15299 u=fred |  current working directory is /home/fred/git/ansible-inc/stable-2.3/test/integration</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 11:39:48,147 p=15299 u=fred |  using connection plugin network_cli</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 11:39:48,340 p=15299 u=fred |  connecting to host veos01 returned an error</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 11:39:48,340 p=15299 u=fred |  [Errno -2] Name or service not known</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<ul class="simple">
<li>If you are using the <code class="docutils literal"><span class="pre">provider:</span></code> options ensure that it&#8217;s suboption <code class="docutils literal"><span class="pre">host:</span></code> is set correctly.</li>
<li>If you are not using <code class="docutils literal"><span class="pre">provider:</span></code> nor top-level arguments ensure your inventory file is correct.</li>
</ul>
</div>
<div class="section" id="error-authentication-failed">
<h3><a class="toc-backref" href="#id8">Error: &#8220;Authentication failed&#8221;</a><a class="headerlink" href="#error-authentication-failed" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> Any</p>
<p>Occurs if the credentials (username, passwords, or ssh keys) passed to <code class="docutils literal"><span class="pre">ansible-connection</span></code> (via <code class="docutils literal"><span class="pre">ansible</span></code> or <code class="docutils literal"><span class="pre">ansible-playbook</span></code>) can not be used to connect to the remote device.</p>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">&lt;ios01&gt; ESTABLISH CONNECTION FOR USER</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cisco on PORT 22 TO ios01</span>
<span class="l l-Scalar l-Scalar-Plain">&lt;ios01&gt; Authentication failed.</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>If you are specifying credentials via <code class="docutils literal"><span class="pre">password:</span></code> (either directly or via <code class="docutils literal"><span class="pre">provider:</span></code>) or the environment variable <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_NET_PASSWORD</span></code> it is possible that <code class="docutils literal"><span class="pre">paramiko</span></code> (the Python SSH library that Ansible uses) is using ssh keys, and therefore the credentials you are specifying are being ignored. To find out if this is the case, disable &#8220;look for keys&#8221;. This can be done like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_PARAMIKO_LOOK_FOR_KEYS=False</span>
</pre></div>
</div>
<p>To make this a permanent change, add the following to your <code class="docutils literal"><span class="pre">ansible.cfg</span></code> file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[paramiko_connection]</span>
<span class="na">look_for_keys</span> <span class="o">=</span> <span class="s">False</span>
</pre></div>
</div>
</div>
<div class="section" id="error-connecting-to-host-hostname-returned-an-error-or-bad-address">
<h3><a class="toc-backref" href="#id9">Error: &#8220;connecting to host &lt;hostname&gt; returned an error&#8221; or &#8220;Bad address&#8221;</a><a class="headerlink" href="#error-connecting-to-host-hostname-returned-an-error-or-bad-address" title="Permalink to this headline">¶</a></h3>
<p>This may occur if the SSH fingerprint hasn&#8217;t been added to Paramiko&#8217;s (the Python SSH library) know hosts file.</p>
<p>When using persistent connections with Paramiko, the connection runs in a background process.  If the host doesn&#8217;t already have a valid SSH key, by default Ansible will prompt to add the host key.  This will cause connections running in background processes to fail.</p>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:06:03,486 p=17981 u=fred |  using connection plugin network_cli</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:06:04,680 p=17981 u=fred |  connecting to host veos01 returned an error</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:06:04,682 p=17981 u=fred |  (14, &#39;Bad address&#39;)</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:06:33,519 p=17981 u=fred |  number of connection attempts exceeded, unable to connect to control socket</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:06:33,520 p=17981 u=fred |  persistent_connect_interval=1, persistent_connect_retries=30</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>Use <code class="docutils literal"><span class="pre">ssh-keyscan</span></code> to pre-populate the known_hosts. You need to ensure the keys are correct.</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>ssh-keyscan veos01
</pre></div>
</div>
<p>or</p>
<p>You can tell Ansible to automatically accept the keys</p>
<p>Environment variable method:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_PARAMIKO_HOST_KEY_AUTO_ADD=True</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-playbook ...</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">ansible.cfg</span></code> method:</p>
<p>ansible.cfg</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[paramiko_connection]</span>
<span class="na">host_key_auto_add</span> <span class="o">=</span> <span class="s">True</span>
</pre></div>
</div>
</div>
<div class="section" id="error-no-authentication-methods-available">
<h3><a class="toc-backref" href="#id10">Error: &#8220;No authentication methods available&#8221;</a><a class="headerlink" href="#error-no-authentication-methods-available" title="Permalink to this headline">¶</a></h3>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:05,670 p=18591 u=fred |  creating new control socket for host veos01:None as user admin</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:05,670 p=18591 u=fred |  control socket path is /home/fred/.ansible/pc/ca5960d27a</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:05,670 p=18591 u=fred |  current working directory is /home/fred/git/ansible-inc/ansible-workspace-2/test/integration</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:05,670 p=18591 u=fred |  using connection plugin network_cli</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:06,606 p=18591 u=fred |  connecting to host veos01 returned an error</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:06,606 p=18591 u=fred |  No authentication methods available</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:35,708 p=18591 u=fred |  connect retry timeout expired, unable to connect to control socket</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:35,709 p=18591 u=fred |  persistent_connect_retry_timeout is 15 secs</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>No password or SSH key supplied</p>
</div>
<div class="section" id="clearing-out-persistent-connections">
<h3><a class="toc-backref" href="#id11">Clearing Out Persistent Connections</a><a class="headerlink" href="#clearing-out-persistent-connections" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> Any</p>
<p>In Ansible 2.3, persistent connection sockets are stored in <code class="docutils literal"><span class="pre">~/.ansible/pc</span></code> for all network devices.  When an Ansible playbook runs, the persistent socket connection is displayed when verbose output is specified.</p>
<p><code class="docutils literal"><span class="pre">&lt;switch&gt;</span> <span class="pre">socket_path:</span> <span class="pre">/home/fred/.ansible/pc/f64ddfa760</span></code></p>
<p>To clear out a persistent connection before it times out (the default timeout is 30 seconds
of inactivity), simple delete the socket file.</p>
</div>
</div>
<div class="section" id="timeout-issues">
<h2><a class="toc-backref" href="#id12">Timeout issues</a><a class="headerlink" href="#timeout-issues" title="Permalink to this headline">¶</a></h2>
<div class="section" id="timeouts">
<h3><a class="toc-backref" href="#id13">Timeouts</a><a class="headerlink" href="#timeouts" title="Permalink to this headline">¶</a></h3>
<p>Persistent connection idle timeout:</p>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:05,670 p=18591 u=fred |  persistent connection idle timeout triggered, timeout value is 30 secs</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>Increase value of presistent connection idle timeout.
.. code-block:: yaml</p>
<blockquote>
<div>export ANSIBLE_PERSISTENT_CONNECT_TIMEOUT=60</div></blockquote>
<p>To make this a permanent change, add the following to your <code class="docutils literal"><span class="pre">ansible.cfg</span></code> file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[persistent_connection]</span>
<span class="na">connect_timeout</span> <span class="o">=</span> <span class="s">60</span>
</pre></div>
</div>
<p>Command timeout:
For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:05,670 p=18591 u=fred |  command timeout triggered, timeout value is 10 secs</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>Options 1:
Increase value of command timeout in configuration file or by setting environment variable.
Note: This value should be less than persistent connection idle timeout ie. connect_timeout</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_PERSISTENT_COMMAND_TIMEOUT=30</span>
</pre></div>
</div>
<p>To make this a permanent change, add the following to your <code class="docutils literal"><span class="pre">ansible.cfg</span></code> file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[persistent_connection]</span>
<span class="na">command_timeout</span> <span class="o">=</span> <span class="s">30</span>
</pre></div>
</div>
<p>Option 2:
Increase command timeout per task basis. All network modules support a
timeout value that can be set on a per task basis.
The timeout value controls the amount of time in seconds before the
task will fail if the command has not returned.</p>
<p>For example:</p>
<p>Suggestions to resolve:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">save running-config</span>
  <span class="l l-Scalar l-Scalar-Plain">ios_command</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">commands</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">copy running-config startup-config</span>
    <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">cli</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">timeout</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
</pre></div>
</div>
<p>Some operations take longer than the default 10 seconds to complete.  One good
example is saving the current running config on IOS devices to startup config.
In this case, changing the timeout value form the default 10 seconds to 30
seconds will prevent the task from failing before the command completes
successfully.
Note: This value should be less than persistent connection idle timeout ie. connect_timeout</p>
<p>Persistent socket connect timeout:
For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:35,708 p=18591 u=fred |  connect retry timeout expired, unable to connect to control socket</span>
<span class="l l-Scalar l-Scalar-Plain">2017-04-04 12:19:35,709 p=18591 u=fred |  persistent_connect_retry_timeout is 15 secs</span>
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>Increase the value of the persistent connection idle timeout.
Note: This value should be greater than the SSH timeout value (the timeout value under the defaults
section in the configuration file) and less than the value of the persistent
connection idle timeout (connect_timeout).</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">export ANSIBLE_PERSISTENT_CONNECT_RETRY_TIMEOUT=30</span>
</pre></div>
</div>
<p>To make this a permanent change, add the following to your <code class="docutils literal"><span class="pre">ansible.cfg</span></code> file:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[persistent_connection]</span>
<span class="na">connect_retry_timeout</span> <span class="o">=</span> <span class="s">30</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="playbook-issues">
<h2><a class="toc-backref" href="#id14">Playbook issues</a><a class="headerlink" href="#playbook-issues" title="Permalink to this headline">¶</a></h2>
<p>This section details issues are caused by issues with the Playbook itself.</p>
<div class="section" id="error-invalid-connection-specified-expected-connection-local-got-ssh">
<h3><a class="toc-backref" href="#id15">Error: &#8220;invalid connection specified, expected connection=local, got ssh&#8221;</a><a class="headerlink" href="#error-invalid-connection-specified-expected-connection-local-got-ssh" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> Any</p>
<p>Network modules require that the connection is set to <code class="docutils literal"><span class="pre">local</span></code>.  Any other
connection setting will cause the playbook to fail.  Ansible will now detect
this condition and return an error message:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>fatal: [nxos01]: FAILED! =&gt; {
    &quot;changed&quot;: false,
    &quot;failed&quot;: true,
    &quot;msg&quot;: &quot;invalid connection specified, expected connection=local, got ssh&quot;
}
</pre></div>
</div>
<p>To fix this issue, set the connection value to <code class="docutils literal"><span class="pre">local</span></code> using one of the
following methods:</p>
<ul class="simple">
<li>Set the play to use <code class="docutils literal"><span class="pre">connection:</span> <span class="pre">local</span></code></li>
<li>Set the task to use <code class="docutils literal"><span class="pre">connection:</span> <span class="pre">local</span></code></li>
<li>Run ansible-playbook using the <code class="docutils literal"><span class="pre">-c</span> <span class="pre">local</span></code> setting</li>
</ul>
</div>
<div class="section" id="error-unable-to-enter-configuration-mode">
<h3><a class="toc-backref" href="#id16">Error: &#8220;Unable to enter configuration mode&#8221;</a><a class="headerlink" href="#error-unable-to-enter-configuration-mode" title="Permalink to this headline">¶</a></h3>
<p><strong>Platforms:</strong> eos and ios</p>
<p>This occurs when you attempt to run a task that requires privileged mode in a user mode shell.</p>
<p>For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>TASK [ios_system : configure name_servers] *****************************************************************************
task path:
fatal: [ios-csr1000v]: FAILED! =&gt; {
    &quot;changed&quot;: false,
    &quot;failed&quot;: true,
   &quot;msg&quot;: &quot;unable to enter configuration mode&quot;,
}
</pre></div>
</div>
<p>Suggestions to resolve:</p>
<p>Add <code class="docutils literal"><span class="pre">authorize:</span> <span class="pre">yes</span></code> to the task. For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">configure hostname</span>
  <span class="l l-Scalar l-Scalar-Plain">ios_system</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">hostname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
      <span class="l l-Scalar l-Scalar-Plain">authorize</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
</pre></div>
</div>
<p>If the user requires a password to go into privileged mode, this can be specified with <code class="docutils literal"><span class="pre">auth_pass</span></code>; if <code class="docutils literal"><span class="pre">auth_pass</span></code> isn&#8217;t set, the environment variable <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal"><span class="pre">ANSIBLE_NET_AUTHORIZE</span></code> will be used instead.</p>
<p>Add <code class="docutils literal"><span class="pre">authorize:</span> <span class="pre">yes</span></code> to the task. For example:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">configure hostname</span>
  <span class="l l-Scalar l-Scalar-Plain">ios_system</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">provider</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">hostname</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
    <span class="l l-Scalar l-Scalar-Plain">authorize</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="l l-Scalar l-Scalar-Plain">auth_pass</span><span class="p p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">mypasswordvar</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="proxy-issues">
<h2><a class="toc-backref" href="#id17">Proxy Issues</a><a class="headerlink" href="#proxy-issues" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div></div></blockquote>
<div class="section" id="delegate-to-vs-proxycommand">
<span id="network-delegate-to-vs-proxycommand"></span><h3><a class="toc-backref" href="#id18">delegate_to vs ProxyCommand</a><a class="headerlink" href="#delegate-to-vs-proxycommand" title="Permalink to this headline">¶</a></h3>
<p>The new connection framework for Network Modules in Ansible 2.3 that uses <code class="docutils literal"><span class="pre">cli</span></code> transport
no longer supports the use of the <code class="docutils literal"><span class="pre">delegate_to</span></code> directive.
In order to use a bastion or intermediate jump host to connect to network devices over <code class="docutils literal"><span class="pre">cli</span></code>
transport, network modules now support the use of <code class="docutils literal"><span class="pre">ProxyCommand</span></code>.</p>
<p>To use <code class="docutils literal"><span class="pre">ProxyCommand</span></code>, configure the proxy settings in the Ansible inventory
file to specify the proxy host.</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[nxos]</span>
<span class="na">nxos01</span>
<span class="na">nxos02</span>

<span class="k">[nxos:vars]</span>
<span class="na">ansible_ssh_common_args</span><span class="o">=</span><span class="s">&#39;-o ProxyCommand=&quot;ssh -W %h:%p -q bastion01&quot;&#39;</span>
</pre></div>
</div>
<p>With the configuration above, simply build and run the playbook as normal with
no additional changes necessary.  The network module will now connect to the
network device by first connecting to the host specified in
<code class="docutils literal"><span class="pre">ansible_ssh_common_args</span></code>, which is <code class="docutils literal"><span class="pre">bastion01</span></code> in the above example.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Using <code class="docutils literal"><span class="pre">ProxyCommand</span></code> with passwords via variables</p>
<p>By design, SSH doesn&#8217;t support providing passwords via environment variables.
This is done to prevent secrets from leaking out, for example in <code class="docutils literal"><span class="pre">ps</span></code> output.</p>
<p class="last">We recommend using SSH Keys, and if needed an ssh-agent, rather than passwords, where ever possible.</p>
</div>
</div>
</div>
</div>


          </div>
          <div id="search-results"><gcse:searchresults-only></div>
          <footer>
  

  <hr/>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <p>
  Copyright © 2017 Red Hat, Inc.
  <br>
    Last updated on Oct 10, 2017.
  </p>
<p>
Ansible docs are generated from <a href="https://github.com/ansible/ansible">GitHub sources</a> using <a href="http://sphinx-doc.org/">Sphinx</a> using a theme provided by <a href="http://readthedocs.org">Read the Docs</a>. 
</p>
</footer>
        </div>
      </div>

    </section>

  </div>
  


<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
        (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
        n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
        e.parentNode.insertBefore(n, e);
        })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
_satellite.pageBottom();
}
</script>
</body>
</html>