

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="text/javascript" src="//www.redhat.com/dtm.js"></script>

  <!-- Google Tag Manager Data Layer -->
  <script>
   dataLayer = [];
  </script>
  <!-- End Google Tag Manager Data Layer -->




  
  <title>Loops &mdash; Ansible Documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'2.4',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  false
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Ansible Documentation" href="index.html"/>
        <link rel="up" title="Playbooks" href="playbooks.html"/>
        <link rel="next" title="Blocks" href="playbooks_blocks.html"/>
        <link rel="prev" title="Conditionals" href="playbooks_conditionals.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  <style>
    .search-reset-start {
        color: #463E3F;
        float: right;
        position: relative;
        top: -25px;
        left: -10px;
        z-index: 10;
     }
     .search-reset-start:hover {
        cursor: pointer;
        color: #2980B9;
     }
     #search-box-id {
        padding-right: 25px;
     }
  </style>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300'
    rel='stylesheet' type='text/css'>

</head>

<body class="wy-body-for-nav">

  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
  <!-- End Google Tag Manager -->

    <div class="DocSite-globalNav ansibleNav">
        <ul>
            <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
            <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
            <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
            <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
            <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
        </ul>
    </div>

  <a class="DocSite-nav" href="/">
    <img class="DocSiteNav-logo"
      src="_static/images/logo_invert.png"
      alt="Ansible Logo">
    <div class="DocSiteNav-title">
      Documentation
    </div>
  </a>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">

      <div style="background-color:#5bbdbf;height=80px;margin:'auto auto auto auto'">
        <a class="DocSiteProduct-header DocSiteProduct-header--core" href="/">
            <div class="DocSiteProduct-productName">
                <div class="DocSiteProduct-logoText">
                    Ansible  
                    <div class="DocSiteProduct-CurrentVersion" align="right">
                      v2.4
                  </div>
                </div>
            </div>
        </a>
        

          <div class="DocSiteProduct-CheckVersionPara">For previous versions, see the  <a class="DocSiteProduct-versionheader" href="/#coreversionselect">documentation archive.</a></div>
      </div>

      <div id="menu-id" class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro_installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_inventory.html">Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_dynamic_inventory.html">Dynamic Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_adhoc.html">Introduction To Ad-Hoc Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_configuration.html">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_bsd.html">BSD Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_windows.html">Windows Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_networking.html">Networking Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Video</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="playbooks.html">Playbooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="playbooks_intro.html">Intro to Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_reuse.html">Creating Reusable Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_templating.html">Templating (Jinja2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_strategies.html">Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_best_practices.html">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="playbooks_special_topics.html">Playbooks: Special Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="become.html">Become (Privilege Escalation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_acceleration.html">Accelerated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_async.html">Asynchronous Actions and Polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_checkmode.html">Check Mode (&#8220;Dry Run&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_debugger.html">Playbook Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_delegation.html">Delegation, Rolling Updates, and Local Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_environment.html">Setting the Environment (and Working With Proxies)</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_environment.html#working-with-language-specific-version-managers">Working With Language-Specific Version Managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling.html">Error Handling In Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_lookups.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_prompts.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_tags.html">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_vault.html">Using Vault in playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_startnstep.html">Start and Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks_keywords.html">Directives Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">About Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules_intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_return_values.html">Return Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules_support.html">Module Maintenance &amp; Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules_by_category.html">Module Index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="list_of_all_modules.html">All Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_cloud_modules.html">Cloud Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_clustering_modules.html">Clustering Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_commands_modules.html">Commands Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_crypto_modules.html">Crypto Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_database_modules.html">Database Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_files_modules.html">Files Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_identity_modules.html">Identity Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_inventory_modules.html">Inventory Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_messaging_modules.html">Messaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_monitoring_modules.html">Monitoring Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_net_tools_modules.html">Net Tools Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_network_modules.html">Network Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_notification_modules.html">Notification Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_packaging_modules.html">Packaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_remote_management_modules.html">Remote Management Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_source_control_modules.html">Source Control Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_storage_modules.html">Storage Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_system_modules.html">System Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_utilities_modules.html">Utilities Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_web_infrastructure_modules.html">Web Infrastructure Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="list_of_windows_modules.html">Windows Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vault.html">Ansible Vault</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vault.html#what-can-be-encrypted-with-vault">What Can Be Encrypted With Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#creating-encrypted-files">Creating Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#editing-encrypted-files">Editing Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#rekeying-encrypted-files">Rekeying Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#encrypting-unencrypted-files">Encrypting Unencrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#decrypting-encrypted-files">Decrypting Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#viewing-encrypted-files">Viewing Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#use-encrypt-string-to-create-encrypted-variables-to-embed-in-yaml">Use encrypt_string to create encrypted variables to embed in yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#vault-ids-and-multiple-vault-passwords">Vault Ids and Multiple Vault Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#providing-vault-passwords">Providing Vault Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#speeding-up-vault-operations">Speeding Up Vault Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#vault-format">Vault Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html#vault-payload-format-1-1">Vault Payload Format 1.1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Command Line Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-playbook.html">ansible-playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-vault.html">ansible-vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-galaxy.html">ansible-galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-console.html">ansible-console</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-config.html">ansible-config</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-doc.html">ansible-doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-inventory.html">ansible-inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible-pull.html">ansible-pull</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guides.html">Detailed Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="guide_aws.html">Amazon Web Services Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_azure.html">Getting Started with Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rax.html">Rackspace Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_gce.html">Google Cloud Platform Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_cloudstack.html">CloudStack Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_vagrant.html">Using Vagrant and Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade.html">Continuous Delivery and Rolling Upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_docker.html">Getting Started with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_packet.html">Using Ansible with the Packet host</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide/index.html">Developer Information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_guide/index.html#ansible-developer-guide">Ansible Developer Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="community.html">Community Information &amp; Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="community.html#ansible-users">Ansible Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#for-current-and-prospective-developers">For Current and Prospective Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#other-topics">Other Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#community-code-of-conduct">Community Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="community.html#contributors-license-agreement">Contributors License Agreement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="galaxy.html">Ansible Galaxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-website">The Website</a></li>
<li class="toctree-l2"><a class="reference internal" href="galaxy.html#the-command-line-tool">The command line tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_strategies.html">Testing Strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-ansible-playbooks">Integrating Testing With Ansible Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#the-right-level-of-testing">The Right Level of Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#check-mode-as-a-drift-test">Check Mode As A Drift Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#modules-that-are-useful-for-testing">Modules That Are Useful for Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#testing-lifecycle">Testing Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#integrating-testing-with-rolling-updates">Integrating Testing With Rolling Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#achieving-continuous-deployment">Achieving Continuous Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_strategies.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-set-the-path-or-any-other-environment-variable-for-a-task-or-entire-playbook">How can I set the PATH or any other environment variable for a task or entire playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-different-machines-needing-different-user-accounts-or-ports-to-log-in-with">How do I handle different machines needing different user accounts or ports to log in with?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-get-ansible-to-reuse-connections-enable-kerberized-ssh-or-have-ansible-pay-attention-to-my-local-ssh-config-file">How do I get ansible to reuse connections, enable Kerberized SSH, or have Ansible pay attention to my local SSH config file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to">How do I configure a jump host to access servers that I have no direct access to?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-speed-up-management-inside-ec2">How do I speed up management inside EC2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine">How do I handle python pathing not having a Python 2.X in /usr/bin/python on a remote machine?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-best-way-to-make-content-reusable-redistributable">What is the best way to make content reusable/redistributable?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#where-does-the-configuration-file-live-and-what-can-i-configure-in-it">Where does the configuration file live and what can I configure in it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-disable-cowsay">How do I disable cowsay?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-a-list-of-all-of-the-ansible-variables">How do I see a list of all of the ansible_ variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-all-the-inventory-vars-defined-for-my-host">How do I see all the inventory vars defined for my host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template">How do I loop over a list of hosts in a group, inside of a template?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-name-programmatically">How do I access a variable name programmatically?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-a-variable-of-the-first-host-in-a-group">How do I access a variable of the first host in a group?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-copy-files-recursively-onto-a-target-host">How do I copy files recursively onto a target host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-access-shell-environment-variables">How do I access shell environment variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-generate-crypted-passwords-for-the-user-module">How do I generate crypted passwords for the user module?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#can-i-get-training-on-ansible">Can I get training on Ansible?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#is-there-a-web-interface-rest-api-etc">Is there a web interface / REST API / etc?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-submit-a-change-to-the-documentation">How do I submit a change to the documentation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-keep-secret-data-in-my-playbook">How do I keep secret data in my playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#when-should-i-use-also-how-to-interpolate-variables-or-dynamic-variable-names">When should I use {{ }}? Also, how to interpolate variables or dynamic variable names</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-don-t-you-ship-in-x-format">Why don&#8217;t you ship in X format?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#i-don-t-see-my-question-here">I don&#8217;t see my question here</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="config.html#common-options">Common Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="YAMLSyntax.html">YAML Syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#yaml-basics">YAML Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="YAMLSyntax.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="porting_guides.html">Ansible Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_3_support.html">Python 3 Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="python_3_support.html#testing-python-3-with-commands-and-playbooks">Testing Python 3 with commands and playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_3_support.html#testing-python-3-module-support">Testing Python 3 module support</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_3_support.html#what-to-do-if-an-incompatibility-is-found">What to do if an incompatibility is found</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_and_maintenance.html">Release and maintenance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release_and_maintenance.html#release-cycle">Release cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_and_maintenance.html#release-status">Release status</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_and_maintenance.html#development-and-stable-version-maintenance-workflow">Development and stable version maintenance workflow</a></li>
</ul>
</li>
</ul>

        


    <div class="DocSite-sideNav ansibleNav">
       <ul class="">
       <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
       <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
       <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
       <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
       <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
       </ul>
     </div>

    <!-- changeable widget -->
    <div id="sideBanner">
    <br/>
    <a href="https://www.ansible.com/docs-left?utm_source=docs">
      <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
    </a>
    </div>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Ansible Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <!-- Banner ads
          <div class="DocSiteBanner">
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-left.png">
            </a>
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-right.png">
            </a>
        </div> -->

          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Loops</a></li>
  
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/ansible/ansible/blob/devel/docs/docsite/rst/playbooks_loops.rst" class="icon icon-github"> Edit on GitHub</a>
    </li>
  
</ul>
<hr/>

          <div id="page-content">
          
  <div class="section" id="loops">
<h1><a class="toc-backref" href="#id12">Loops</a><a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h1>
<p>Often you&#8217;ll want to do many things in one task, such as create a lot of users, install a lot of packages, or
repeat a polling step until a certain result is reached.</p>
<p>This chapter is all about how to use loops in playbooks.</p>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="#loops" id="id12">Loops</a><ul>
<li><a class="reference internal" href="#standard-loops" id="id13">Standard Loops</a></li>
<li><a class="reference internal" href="#nested-loops" id="id14">Nested Loops</a></li>
<li><a class="reference internal" href="#looping-over-hashes" id="id15">Looping over Hashes</a></li>
<li><a class="reference internal" href="#looping-over-files" id="id16">Looping over Files</a></li>
<li><a class="reference internal" href="#id4" id="id17">Looping over Fileglobs</a></li>
<li><a class="reference internal" href="#looping-over-filetrees" id="id18">Looping over Filetrees</a></li>
<li><a class="reference internal" href="#looping-over-parallel-sets-of-data" id="id19">Looping over Parallel Sets of Data</a></li>
<li><a class="reference internal" href="#looping-over-subelements" id="id20">Looping over Subelements</a></li>
<li><a class="reference internal" href="#looping-over-integer-sequences" id="id21">Looping over Integer Sequences</a></li>
<li><a class="reference internal" href="#random-choices" id="id22">Random Choices</a></li>
<li><a class="reference internal" href="#do-until-loops" id="id23">Do-Until Loops</a></li>
<li><a class="reference internal" href="#finding-first-matched-files" id="id24">Finding First Matched Files</a></li>
<li><a class="reference internal" href="#iterating-over-the-results-of-a-program-execution" id="id25">Iterating Over The Results of a Program Execution</a></li>
<li><a class="reference internal" href="#looping-over-a-list-with-an-index" id="id26">Looping Over A List With An Index</a></li>
<li><a class="reference internal" href="#using-ini-file-with-a-loop" id="id27">Using ini file with a loop</a></li>
<li><a class="reference internal" href="#flattening-a-list" id="id28">Flattening A List</a></li>
<li><a class="reference internal" href="#using-register-with-a-loop" id="id29">Using register with a loop</a></li>
<li><a class="reference internal" href="#looping-over-the-inventory" id="id30">Looping over the inventory</a></li>
<li><a class="reference internal" href="#loop-control" id="id31">Loop Control</a></li>
<li><a class="reference internal" href="#loops-and-includes-in-2-0" id="id32">Loops and Includes in 2.0</a></li>
<li><a class="reference internal" href="#writing-your-own-iterators" id="id33">Writing Your Own Iterators</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="standard-loops">
<span id="id1"></span><h2><a class="toc-backref" href="#id13">Standard Loops</a><a class="headerlink" href="#standard-loops" title="Permalink to this headline">¶</a></h2>
<p>To save some typing, repeated tasks can be written in short-hand like so:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">add several users</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="l l-Scalar l-Scalar-Plain">groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;wheel&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">testuser1</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">testuser2</span>
</pre></div>
</div>
<p>If you have defined a YAML list in a variables file, or the &#8216;vars&#8217; section, you can also do:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">somelist</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>The above would be the equivalent of:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">add user testuser1</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;testuser1&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="l l-Scalar l-Scalar-Plain">groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;wheel&quot;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">add user testuser2</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;testuser2&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="l l-Scalar l-Scalar-Plain">groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;wheel&quot;</span>
</pre></div>
</div>
<p>The yum and apt modules use with_items to execute fewer package manager transactions.</p>
<p>Note that the types of items you iterate over with &#8216;with_items&#8217; do not have to be simple lists of strings.
If you have a list of hashes, you can reference subkeys using things like:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">add several users</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="l l-Scalar l-Scalar-Plain">groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.groups</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">name</span><span class="p p-Indicator">:</span> <span class="s">&#39;testuser1&#39;</span><span class="p p-Indicator">,</span> <span class="nv">groups</span><span class="p p-Indicator">:</span> <span class="s">&#39;wheel&#39;</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">name</span><span class="p p-Indicator">:</span> <span class="s">&#39;testuser2&#39;</span><span class="p p-Indicator">,</span> <span class="nv">groups</span><span class="p p-Indicator">:</span> <span class="s">&#39;root&#39;</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Also be aware that when combining <cite>when</cite> with <cite>with_items</cite> (or any other loop statement), the <cite>when</cite> statement is processed separately for each item. See <a class="reference internal" href="playbooks_conditionals.html#the-when-statement"><span class="std std-ref">The When Statement</span></a> for an example.</p>
<p>Loops are actually a combination of things <cite>with_</cite> + <cite>lookup()</cite>, so any lookup plugin can be used as a source for a loop, &#8216;items&#8217; is lookup.</p>
<p>Please note that <code class="docutils literal"><span class="pre">with_items</span></code> flattens the first depth of the list it is
provided and can yield unexpected results if you pass a list which is composed
of lists. You can work around this by wrapping your nested list inside a list:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># This will run debug three times since the list is flattened</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">nested_list</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">one</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">two</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">three</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">nested_list</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="c1"># This will run debug once with the three items</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">vars</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">nested_list</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">one</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">two</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">three</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">nested_list</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="nested-loops">
<span id="id2"></span><h2><a class="toc-backref" href="#id14">Nested Loops</a><a class="headerlink" href="#nested-loops" title="Permalink to this headline">¶</a></h2>
<p>Loops can be nested as well:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">give users access to multiple databases</span>
  <span class="l l-Scalar l-Scalar-Plain">mysql_user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span><span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">priv</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span><span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="cp">}}</span><span class="s">.*:ALL&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">append_privs</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;foo&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_nested</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span> <span class="s">&#39;alice&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;bob&#39;</span> <span class="p p-Indicator">]</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span> <span class="s">&#39;clientdb&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;employeedb&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;providerdb&#39;</span> <span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>As with the case of &#8216;with_items&#8217; above, you can use previously defined variables.:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">here, &#39;users&#39; contains the above list of employees</span>
  <span class="l l-Scalar l-Scalar-Plain">mysql_user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span><span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">priv</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span><span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="cp">}}</span><span class="s">.*:ALL&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">append_privs</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;foo&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_nested</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">users</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span> <span class="s">&#39;clientdb&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;employeedb&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;providerdb&#39;</span> <span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="looping-over-hashes">
<span id="id3"></span><h2><a class="toc-backref" href="#id15">Looping over Hashes</a><a class="headerlink" href="#looping-over-hashes" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.5.</span></p>
</div>
<p>Suppose you have the following variable:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">alice</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Alice Appleworth</span>
    <span class="l l-Scalar l-Scalar-Plain">telephone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">123-456-7890</span>
  <span class="l l-Scalar l-Scalar-Plain">bob</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bob Bananarama</span>
    <span class="l l-Scalar l-Scalar-Plain">telephone</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">987-654-3210</span>
</pre></div>
</div>
<p>And you want to print every user&#8217;s name and phone number.  You can loop through the elements of a hash using <code class="docutils literal"><span class="pre">with_dict</span></code> like this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Print phone records</span>
    <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;User</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item.key</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item.value.name</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">(</span><span class="cp">{{</span> <span class="nv">item.value.telephone</span> <span class="cp">}}</span><span class="s">)&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">with_dict</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">users</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="looping-over-files">
<span id="looping-over-fileglobs"></span><h2><a class="toc-backref" href="#id16">Looping over Files</a><a class="headerlink" href="#looping-over-files" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">with_file</span></code> iterates over the content of a list of files, <cite>item</cite> will be set to the content of each file in sequence.  It can be used like this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>

  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

    <span class="c1"># emit a debug message containing the content of each file.</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_file</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">first_example_file</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">second_example_file</span>
</pre></div>
</div>
<p>Assuming that <code class="docutils literal"><span class="pre">first_example_file</span></code> contained the text &#8220;hello&#8221; and <code class="docutils literal"><span class="pre">second_example_file</span></code> contained the text &#8220;world&#8221;, this would result in:</p>
<div class="highlight-shell-session"><div class="highlight"><pre><span></span><span class="go">TASK [debug msg={{ item }}] ******************************************************</span>
<span class="go">ok: [localhost] =&gt; (item=hello) =&gt; {</span>
<span class="go">    &quot;item&quot;: &quot;hello&quot;,</span>
<span class="go">    &quot;msg&quot;: &quot;hello&quot;</span>
<span class="go">}</span>
<span class="go">ok: [localhost] =&gt; (item=world) =&gt; {</span>
<span class="go">    &quot;item&quot;: &quot;world&quot;,</span>
<span class="go">    &quot;msg&quot;: &quot;world&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id17">Looping over Fileglobs</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">with_fileglob</span></code> matches all files in a single directory, non-recursively, that match a pattern. It calls
<a class="reference external" href="https://docs.python.org/2/library/glob.html">Python&#8217;s glob library</a>, and can be used like this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>

  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

    <span class="c1"># first ensure our target directory exists</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure target directory exists</span>
      <span class="l l-Scalar l-Scalar-Plain">file</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="s">&quot;/etc/fooapp&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>

    <span class="c1"># copy each file over that matches the given pattern</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Copy each file over that matches the given pattern</span>
      <span class="l l-Scalar l-Scalar-Plain">copy</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="s">&quot;/etc/fooapp/&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">owner</span><span class="p p-Indicator">:</span> <span class="s">&quot;root&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0600</span>
      <span class="l l-Scalar l-Scalar-Plain">with_fileglob</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;/playbooks/files/fooapp/*&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using a relative path with <code class="docutils literal"><span class="pre">with_fileglob</span></code> in a role, Ansible resolves the path relative to the <cite>roles/&lt;rolename&gt;/files</cite> directory.</p>
</div>
</div>
<div class="section" id="looping-over-filetrees">
<h2><a class="toc-backref" href="#id18">Looping over Filetrees</a><a class="headerlink" href="#looping-over-filetrees" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">with_filetree</span></code> recursively matches all files in a directory tree, enabling you to template a complete tree of files on a target system while retaining permissions and ownership.</p>
<p>The <code class="docutils literal"><span class="pre">filetree</span></code> lookup-plugin supports directories, files and symlinks, including SELinux and other file properties. Here is a complete list of what each file object consists of:</p>
<ul class="simple">
<li>src</li>
<li>root</li>
<li>path</li>
<li>mode</li>
<li>state</li>
<li>owner</li>
<li>group</li>
<li>seuser</li>
<li>serole</li>
<li>setype</li>
<li>selevel</li>
<li>uid</li>
<li>gid</li>
<li>size</li>
<li>mtime</li>
<li>ctime</li>
</ul>
<p>If you provide more than one path, it will implement a <code class="docutils literal"><span class="pre">with_first_found</span></code> logic, and will not process entries it already processed in previous paths. This enables the user to merge different trees in order of importance, or add role_vars specific paths to influence different instances of the same role.</p>
<p>Here is an example of how we use with_filetree within a role. The <code class="docutils literal"><span class="pre">web/</span></code> path is relative to either <code class="docutils literal"><span class="pre">roles/&lt;role&gt;/files/</span></code> or <code class="docutils literal"><span class="pre">files/</span></code>:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Create directories</span>
  <span class="l l-Scalar l-Scalar-Plain">file</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/web/</span><span class="cp">{{</span> <span class="nv">item.path</span> <span class="cp">}}</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.mode</span> <span class="cp">}}</span><span class="s">&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_filetree</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web/</span>
  <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">item.state == &#39;directory&#39;</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Template files</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.src</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/web/</span><span class="cp">{{</span> <span class="nv">item.path</span> <span class="cp">}}</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.mode</span> <span class="cp">}}</span><span class="s">&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_filetree</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web/</span>
  <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">item.state == &#39;file&#39;</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Recreate symlinks</span>
  <span class="l l-Scalar l-Scalar-Plain">file</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.src</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/web/</span><span class="cp">{{</span> <span class="nv">item.path</span> <span class="cp">}}</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">link</span>
    <span class="l l-Scalar l-Scalar-Plain">force</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.mode</span> <span class="cp">}}</span><span class="s">&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_filetree</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web/</span>
  <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">item.state == &#39;link&#39;</span>
</pre></div>
</div>
<p>The following properties are also available:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">root</span></code>: allows filtering by original location</li>
<li><code class="docutils literal"><span class="pre">path</span></code>: contains the relative path to root</li>
<li><code class="docutils literal"><span class="pre">uidi</span></code>, <code class="docutils literal"><span class="pre">gid</span></code>: force-create by exact id, rather than by name</li>
<li><code class="docutils literal"><span class="pre">size</span></code>, <code class="docutils literal"><span class="pre">mtime</span></code>, <code class="docutils literal"><span class="pre">ctime</span></code>: filter out files by size, mtime or ctime</li>
</ul>
</div>
<div class="section" id="looping-over-parallel-sets-of-data">
<h2><a class="toc-backref" href="#id19">Looping over Parallel Sets of Data</a><a class="headerlink" href="#looping-over-parallel-sets-of-data" title="Permalink to this headline">¶</a></h2>
<p>Suppose you have the following variable data:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">alpha</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span> <span class="s">&#39;a&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;b&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;c&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;d&#39;</span> <span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">numbers</span><span class="p p-Indicator">:</span>  <span class="p p-Indicator">[</span> <span class="nv">1</span><span class="p p-Indicator">,</span> <span class="nv">2</span><span class="p p-Indicator">,</span> <span class="nv">3</span><span class="p p-Indicator">,</span> <span class="nv">4</span> <span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>...and you want the set of &#8216;(a, 1)&#8217; and &#8216;(b, 2)&#8217;.   Use &#8216;with_together&#8217; to get this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.0</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item.1</span> <span class="cp">}}</span><span class="s">&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_together</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">alpha</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">numbers</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="looping-over-subelements">
<h2><a class="toc-backref" href="#id20">Looping over Subelements</a><a class="headerlink" href="#looping-over-subelements" title="Permalink to this headline">¶</a></h2>
<p>Suppose you want to do something like loop over a list of users, creating them, and allowing them to login by a certain set of
SSH keys.</p>
<p>In this example, we&#8217;ll assume you have the following defined and loaded in via &#8220;vars_files&#8221; or maybe a &#8220;group_vars/all&#8221; file:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
    <span class="l l-Scalar l-Scalar-Plain">authorized</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
    <span class="l l-Scalar l-Scalar-Plain">mysql</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql-password</span>
        <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;%&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;127.0.0.1&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;::1&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;localhost&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">privs</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;*.*:SELECT&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;DB1.*:ALL&quot;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
    <span class="l l-Scalar l-Scalar-Plain">authorized</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bob/id_rsa.pub</span>
    <span class="l l-Scalar l-Scalar-Plain">mysql</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">other-mysql-password</span>
        <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;db1&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">privs</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;*.*:SELECT&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;DB2.*:ALL&quot;</span>
</pre></div>
</div>
<p>You could loop over these subelements like this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Create User</span>
  <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="l l-Scalar l-Scalar-Plain">generate_ssh_key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">users</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Set authorized ssh key</span>
  <span class="l l-Scalar l-Scalar-Plain">authorized_key</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.0.name</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">&#39;file&#39;</span><span class="o">,</span> <span class="nv">item.1</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_subelements</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">users</span> <span class="cp">}}</span><span class="s">&quot;</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">authorized</span>
</pre></div>
</div>
<p>Given the mysql hosts and privs subkey lists, you can also iterate over a list in a nested subkey:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Setup MySQL users</span>
  <span class="l l-Scalar l-Scalar-Plain">mysql_user</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.0.name</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.0.mysql.password</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.1</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">priv</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.0.mysql.privs</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s1">&#39;/&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_subelements</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">users</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mysql.hosts</span>
</pre></div>
</div>
<p>Subelements walks a list of hashes (aka dictionaries) and then traverses a list with a given (nested sub-)key inside of those
records.</p>
<p>Optionally,  you can add a third element to the subelements list, that holds a
dictionary of flags. Currently you can add the &#8216;skip_missing&#8217; flag. If set to
True, the lookup plugin will skip the lists items that do not contain the given
subkey. Without this flag, or if that flag is set to False, the plugin will
yield an error and complain about the missing subkey.</p>
<p>The authorized_key pattern is exactly where it comes up most.</p>
</div>
<div class="section" id="looping-over-integer-sequences">
<span id="id5"></span><h2><a class="toc-backref" href="#id21">Looping over Integer Sequences</a><a class="headerlink" href="#looping-over-integer-sequences" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">with_sequence</span></code> generates a sequence of items. You
can specify a start value, an end value, an optional &#8220;stride&#8221; value that specifies the number of steps to increment the sequence, and an optional printf-style format string.</p>
<p>Arguments should be specified as key=value pair strings.</p>
<p>A simple shortcut form of the arguments string is also accepted: <code class="docutils literal"><span class="pre">[start-]end[/stride][:format]</span></code>.</p>
<p>Numerical values can be specified in decimal, hexadecimal (0x3f8) or octal (0600).
Negative numbers are not supported.  This works as follows:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>

  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>

    <span class="c1"># create groups</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;evens&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;odds&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

    <span class="c1"># create some test users</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">user</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
        <span class="l l-Scalar l-Scalar-Plain">groups</span><span class="p p-Indicator">:</span> <span class="s">&quot;evens&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=0 end=32 format=testuser%02x</span>

    <span class="c1"># create a series of directories with even numbers for some reason</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">file</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="s">&quot;/var/stuff/</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">start=4 end=16 stride=2</span>

    <span class="c1"># a simpler way to use the sequence plugin</span>
    <span class="c1"># create 4 groups</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;group</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
      <span class="l l-Scalar l-Scalar-Plain">with_sequence</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">count=4</span>
</pre></div>
</div>
</div>
<div class="section" id="random-choices">
<span id="random-choice"></span><h2><a class="toc-backref" href="#id22">Random Choices</a><a class="headerlink" href="#random-choices" title="Permalink to this headline">¶</a></h2>
<p>The &#8216;random_choice&#8217; feature can be used to pick something at random.  While it&#8217;s not a load balancer (there are modules
for those), it can somewhat be used as a poor man&#8217;s load balancer in a MacGyver like situation:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_random_choice</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;go</span><span class="nv"> </span><span class="s">through</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">door&quot;</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;drink</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">goblet&quot;</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;press</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">red</span><span class="nv"> </span><span class="s">button&quot;</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;do</span><span class="nv"> </span><span class="s">nothing&quot;</span>
</pre></div>
</div>
<p>One of the provided strings will be selected at random.</p>
<p>At a more basic level, they can be used to add chaos and excitement to otherwise predictable automation environments.</p>
</div>
<div class="section" id="do-until-loops">
<span id="id6"></span><h2><a class="toc-backref" href="#id23">Do-Until Loops</a><a class="headerlink" href="#do-until-loops" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.4.</span></p>
</div>
<p>Sometimes you would want to retry a task until a certain condition is met.  Here&#8217;s an example:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/foo</span>
  <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="l l-Scalar l-Scalar-Plain">until</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">result.stdout.find(&quot;all systems go&quot;) != -1</span>
  <span class="l l-Scalar l-Scalar-Plain">retries</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="l l-Scalar l-Scalar-Plain">delay</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
<p>The above example run the shell module recursively till the module&#8217;s result has &#8220;all systems go&#8221; in its stdout or the task has
been retried for 5 times with a delay of 10 seconds. The default value for &#8220;retries&#8221; is 3 and &#8220;delay&#8221; is 5.</p>
<p>The task returns the results returned by the last task run. The results of individual retries can be viewed by -vv option.
The registered variable will also have a new key &#8220;attempts&#8221; which will have the number of the retries for the task.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the &#8220;until&#8221; parameter isn&#8217;t defined, the value for the &#8220;retries&#8221; parameter is forced to 1.</p>
</div>
</div>
<div class="section" id="finding-first-matched-files">
<span id="with-first-found"></span><h2><a class="toc-backref" href="#id24">Finding First Matched Files</a><a class="headerlink" href="#finding-first-matched-files" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is an uncommon thing to want to do, but we&#8217;re documenting it for completeness.  You probably won&#8217;t be reaching for this one often.</p>
</div>
<p>This isn&#8217;t exactly a loop, but it&#8217;s close.  What if you want to use a reference to a file based on the first file found
that matches a given criteria, and some of the filenames are determined by variable names?  Yes, you can do that as follows:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">INTERFACES | Create Ansible header for /etc/network/interfaces</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="s">&quot;/etc/foo.conf&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_first_found</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">ansible_virtualization_type</span> <span class="cp">}}</span><span class="s">_foo.conf&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;default_foo.conf&quot;</span>
</pre></div>
</div>
<p>This tool also has a long form version that allows for configurable search paths.  Here&#8217;s an example:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some configuration template</span>
  <span class="l l-Scalar l-Scalar-Plain">template</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="s">&quot;/etc/file.cfg&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0444</span>
    <span class="l l-Scalar l-Scalar-Plain">owner</span><span class="p p-Indicator">:</span> <span class="s">&quot;root&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="s">&quot;root&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_first_found</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">files</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">inventory_hostname</span> <span class="cp">}}</span><span class="s">/etc/file.cfg&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">../../../templates.overwrites</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">../../../templates</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">files</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">etc/file.cfg</span>
      <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">templates</span>
</pre></div>
</div>
</div>
<div class="section" id="iterating-over-the-results-of-a-program-execution">
<span id="looping-over-the-results-of-a-program-execution"></span><h2><a class="toc-backref" href="#id25">Iterating Over The Results of a Program Execution</a><a class="headerlink" href="#iterating-over-the-results-of-a-program-execution" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is an uncommon thing to want to do, but we&#8217;re documenting it for completeness.  You probably won&#8217;t be reaching for this one often.</p>
</div>
<p>Sometimes you might want to execute a program, and based on the output of that program, loop over the results of that line by line.
Ansible provides a neat way to do that, though you should remember, this is always executed on the control machine, not the remote
machine:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Example of looping over a command result</span>
  <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="s">&quot;/usr/bin/frobnicate</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_lines</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;/usr/bin/frobnications_per_host</span><span class="nv"> </span><span class="s">--param</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">inventory_hostname</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>Ok, that was a bit arbitrary.  In fact, if you&#8217;re doing something that is inventory related you might just want to write a dynamic
inventory source instead (see <a class="reference internal" href="intro_dynamic_inventory.html"><span class="doc">Dynamic Inventory</span></a>), but this can be occasionally useful in quick-and-dirty implementations.</p>
<p>Should you ever need to execute a command remotely, you would not use the above method.  Instead do this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Example of looping over a REMOTE command result</span>
  <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="s">&quot;/usr/bin/something&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">command_result</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Do something with each result</span>
  <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="s">&quot;/usr/bin/something_else</span><span class="nv"> </span><span class="s">--param</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">command_result.stdout_lines</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="looping-over-a-list-with-an-index">
<span id="indexed-lists"></span><h2><a class="toc-backref" href="#id26">Looping Over A List With An Index</a><a class="headerlink" href="#looping-over-a-list-with-an-index" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is an uncommon thing to want to do, but we&#8217;re documenting it for completeness.  You probably won&#8217;t be reaching for this one often.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.3.</span></p>
</div>
<p>If you want to loop over an array and also get the numeric index of where you are in the array as you go, you can also do that.
It&#8217;s uncommonly used:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">indexed loop demo</span>
  <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;at</span><span class="nv"> </span><span class="s">array</span><span class="nv"> </span><span class="s">position</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item.0</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">there</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item.1</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_indexed_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">some_list</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-ini-file-with-a-loop">
<span id="using-ini-with-a-loop"></span><h2><a class="toc-backref" href="#id27">Using ini file with a loop</a><a class="headerlink" href="#using-ini-file-with-a-loop" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.0.</span></p>
</div>
<p>The ini plugin can use regexp to retrieve a set of keys. As a consequence, we can loop over this set. Here is the ini file we&#8217;ll use:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[section1]</span>
<span class="na">value1</span><span class="o">=</span><span class="s">section1/value1</span>
<span class="na">value2</span><span class="o">=</span><span class="s">section1/value2</span>

<span class="k">[section2]</span>
<span class="na">value1</span><span class="o">=</span><span class="s">section2/value1</span>
<span class="na">value2</span><span class="o">=</span><span class="s">section2/value2</span>
</pre></div>
</div>
<p>Here is an example of using <code class="docutils literal"><span class="pre">with_ini</span></code>:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_ini</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">value[1-2]</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">section</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">section1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">file</span><span class="p p-Indicator">:</span> <span class="s">&quot;lookup.ini&quot;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">re</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>And here is the returned value:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
      <span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span> <span class="nv">false</span><span class="p p-Indicator">,</span>
      <span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;All</span><span class="nv"> </span><span class="s">items</span><span class="nv"> </span><span class="s">completed&quot;</span><span class="p p-Indicator">,</span>
      <span class="s">&quot;results&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span>
          <span class="p p-Indicator">{</span>
              <span class="s">&quot;invocation&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
                  <span class="s">&quot;module_args&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;msg=\&quot;section1/value1\&quot;&quot;</span><span class="p p-Indicator">,</span>
                  <span class="s">&quot;module_name&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;debug&quot;</span>
              <span class="p p-Indicator">},</span>
              <span class="s">&quot;item&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;section1/value1&quot;</span><span class="p p-Indicator">,</span>
              <span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;section1/value1&quot;</span><span class="p p-Indicator">,</span>
              <span class="s">&quot;verbose_always&quot;</span><span class="p p-Indicator">:</span> <span class="nv">true</span>
          <span class="p p-Indicator">},</span>
          <span class="p p-Indicator">{</span>
              <span class="s">&quot;invocation&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
                  <span class="s">&quot;module_args&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;msg=\&quot;section1/value2\&quot;&quot;</span><span class="p p-Indicator">,</span>
                  <span class="s">&quot;module_name&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;debug&quot;</span>
              <span class="p p-Indicator">},</span>
              <span class="s">&quot;item&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;section1/value2&quot;</span><span class="p p-Indicator">,</span>
              <span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;section1/value2&quot;</span><span class="p p-Indicator">,</span>
              <span class="s">&quot;verbose_always&quot;</span><span class="p p-Indicator">:</span> <span class="nv">true</span>
          <span class="p p-Indicator">}</span>
      <span class="p p-Indicator">]</span>
  <span class="p p-Indicator">}</span>
</pre></div>
</div>
</div>
<div class="section" id="flattening-a-list">
<span id="id7"></span><h2><a class="toc-backref" href="#id28">Flattening A List</a><a class="headerlink" href="#flattening-a-list" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is an uncommon thing to want to do, but we&#8217;re documenting it for completeness.  You probably won&#8217;t be reaching for this one often.</p>
</div>
<p>In rare instances you might have several lists of lists, and you just want to iterate over every item in all of those lists.  Assume
a really crazy hypothetical datastructure:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">----</span>
<span class="l l-Scalar l-Scalar-Plain"># file</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">roles/foo/vars/main.yml</span>
<span class="l l-Scalar l-Scalar-Plain">packages_base</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span> <span class="s">&#39;foo-package&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;bar-package&#39;</span> <span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">packages_apps</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span> <span class="p p-Indicator">[</span><span class="s">&#39;one-package&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;two-package&#39;</span> <span class="p p-Indicator">]]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span> <span class="p p-Indicator">[</span><span class="s">&#39;red-package&#39;</span><span class="p p-Indicator">],</span> <span class="p p-Indicator">[</span><span class="s">&#39;blue-package&#39;</span><span class="p p-Indicator">]]</span>
</pre></div>
</div>
<p>As you can see the formatting of packages in these lists is all over the place.  How can we install all of the packages in both lists?:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">flattened loop demo</span>
  <span class="l l-Scalar l-Scalar-Plain">yum</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="l l-Scalar l-Scalar-Plain">with_flattened</span><span class="p p-Indicator">:</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">packages_base</span> <span class="cp">}}</span><span class="s">&quot;</span>
     <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">packages_apps</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>That&#8217;s how!</p>
</div>
<div class="section" id="using-register-with-a-loop">
<span id="id8"></span><h2><a class="toc-backref" href="#id29">Using register with a loop</a><a class="headerlink" href="#using-register-with-a-loop" title="Permalink to this headline">¶</a></h2>
<p>After using <code class="docutils literal"><span class="pre">register</span></code> with a loop, the data structure placed in the variable will contain a <code class="docutils literal"><span class="pre">results</span></code> attribute that is a list of all responses from the module.</p>
<p>Here is an example of using <code class="docutils literal"><span class="pre">register</span></code> with <code class="docutils literal"><span class="pre">with_items</span></code>:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;one&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;two&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo</span>
</pre></div>
</div>
<p>This differs from the data structure returned when using <code class="docutils literal"><span class="pre">register</span></code> without a loop:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
    <span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span> <span class="nv">true</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;msg&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;All</span><span class="nv"> </span><span class="s">items</span><span class="nv"> </span><span class="s">completed&quot;</span><span class="p p-Indicator">,</span>
    <span class="s">&quot;results&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span>
        <span class="p p-Indicator">{</span>
            <span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span> <span class="nv">true</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;cmd&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">\&quot;one\&quot;</span><span class="nv"> </span><span class="s">&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;delta&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;0:00:00.003110&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;end&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;2013-12-19</span><span class="nv"> </span><span class="s">12:00:05.187153&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;invocation&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
                <span class="s">&quot;module_args&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">\&quot;one\&quot;&quot;</span><span class="p p-Indicator">,</span>
                <span class="s">&quot;module_name&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;shell&quot;</span>
            <span class="p p-Indicator">},</span>
            <span class="s">&quot;item&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;one&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;rc&quot;</span><span class="p p-Indicator">:</span> <span class="nv">0</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;start&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;2013-12-19</span><span class="nv"> </span><span class="s">12:00:05.184043&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;stderr&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;stdout&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;one&quot;</span>
        <span class="p p-Indicator">},</span>
        <span class="p p-Indicator">{</span>
            <span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span> <span class="nv">true</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;cmd&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">\&quot;two\&quot;</span><span class="nv"> </span><span class="s">&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;delta&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;0:00:00.002920&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;end&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;2013-12-19</span><span class="nv"> </span><span class="s">12:00:05.245502&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;invocation&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
                <span class="s">&quot;module_args&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">\&quot;two\&quot;&quot;</span><span class="p p-Indicator">,</span>
                <span class="s">&quot;module_name&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;shell&quot;</span>
            <span class="p p-Indicator">},</span>
            <span class="s">&quot;item&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;two&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;rc&quot;</span><span class="p p-Indicator">:</span> <span class="nv">0</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;start&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;2013-12-19</span><span class="nv"> </span><span class="s">12:00:05.242582&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;stderr&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span><span class="p p-Indicator">,</span>
            <span class="s">&quot;stdout&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;two&quot;</span>
        <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">]</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Subsequent loops over the registered variable to inspect the results may look like:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Fail if return code is not 0</span>
  <span class="l l-Scalar l-Scalar-Plain">fail</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;The</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">(</span><span class="cp">{{</span> <span class="nv">item.cmd</span> <span class="cp">}}</span><span class="s">)</span><span class="nv"> </span><span class="s">did</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">code&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">item.rc != 0</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">echo.results</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>During iteration, the result of the current item will be placed in the variable:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">shell</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">one</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">two</span>
  <span class="l l-Scalar l-Scalar-Plain">register</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo</span>
  <span class="l l-Scalar l-Scalar-Plain">changed_when</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">echo.stdout != &quot;one&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="looping-over-the-inventory">
<span id="id9"></span><h2><a class="toc-backref" href="#id30">Looping over the inventory</a><a class="headerlink" href="#looping-over-the-inventory" title="Permalink to this headline">¶</a></h2>
<p>If you wish to loop over the inventory, or just a subset of it, there is multiple ways.
One can use a regular <code class="docutils literal"><span class="pre">with_items</span></code> with the <code class="docutils literal"><span class="pre">ansible_play_batch</span></code> or <code class="docutils literal"><span class="pre">groups</span></code> variables, like this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># show all the hosts in the inventory</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">groups</span><span class="o">[</span><span class="s1">&#39;all&#39;</span><span class="o">]</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="c1"># show all the hosts in the current play</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">ansible_play_batch</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>There is also a specific lookup plugin <code class="docutils literal"><span class="pre">inventory_hostnames</span></code> that can be used like this:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># show all the hosts in the inventory</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_inventory_hostnames</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">all</span>

<span class="c1"># show all the hosts matching the pattern, ie all but the group www</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_inventory_hostnames</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">all:!www</span>
</pre></div>
</div>
<p>More information on the patterns can be found on <a class="reference internal" href="intro_patterns.html"><span class="doc">Patterns</span></a></p>
</div>
<div class="section" id="loop-control">
<span id="id10"></span><h2><a class="toc-backref" href="#id31">Loop Control</a><a class="headerlink" href="#loop-control" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.1.</span></p>
</div>
<p>In 2.0 you are again able to use <cite>with_</cite> loops and task includes (but not playbook includes). This adds the ability to loop over the set of tasks in one shot.
Ansible by default sets the loop variable <cite>item</cite> for each loop, which causes these nested loops to overwrite the value of <cite>item</cite> from the &#8220;outer&#8221; loops.
As of Ansible 2.1, the <cite>loop_control</cite> option can be used to specify the name of the variable to be used for the loop:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># main.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include_tasks</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">inner.yml</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="l l-Scalar l-Scalar-Plain">loop_control</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">loop_var</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">outer_item</span>

<span class="c1"># inner.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;outer</span><span class="nv"> </span><span class="s">item=</span><span class="cp">{{</span> <span class="nv">outer_item</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">inner</span><span class="nv"> </span><span class="s">item=</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">a</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">b</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">c</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If Ansible detects that the current loop is using a variable which has already been defined, it will raise an error to fail the task.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.2.</span></p>
</div>
<p>When using complex data structures for looping the display might get a bit too &#8220;busy&#8221;, this is where the C(label) directive comes to help:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create servers</span>
  <span class="l l-Scalar l-Scalar-Plain">digital_ocean</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">server1</span>
      <span class="l l-Scalar l-Scalar-Plain">disks</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3gb</span>
      <span class="l l-Scalar l-Scalar-Plain">ram</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15Gb</span>
      <span class="l l-Scalar l-Scalar-Plain">network</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">nic01</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100Gb</span>
        <span class="l l-Scalar l-Scalar-Plain">nic02</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10Gb</span>
        <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">loop_control</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">label</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span><span class="nv">item.name</span><span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>This will now display just the &#8216;label&#8217; field instead of the whole structure per &#8216;item&#8217;, it defaults to &#8216;&#8221;{{item}}&#8221;&#8217; to display things as usual.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.2.</span></p>
</div>
<p>Another option to loop control is C(pause), which allows you to control the time (in seconds) between execution of items in a task loop.:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># main.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">create servers, pause 3s before creating next</span>
  <span class="l l-Scalar l-Scalar-Plain">digital_ocean</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">state</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">server2</span>
  <span class="l l-Scalar l-Scalar-Plain">loop_control</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">pause</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
</div>
<div class="section" id="loops-and-includes-in-2-0">
<span id="loops-and-includes-2-0"></span><h2><a class="toc-backref" href="#id32">Loops and Includes in 2.0</a><a class="headerlink" href="#loops-and-includes-in-2-0" title="Permalink to this headline">¶</a></h2>
<p>Because <cite>loop_control</cite> is not available in Ansible 2.0, when using an include with a loop you should use <cite>set_fact</cite> to save the &#8220;outer&#8221; loops value
for <cite>item</cite>:</p>
<div class="highlight-YAML+Jinja"><div class="highlight"><pre><span></span><span class="c1"># main.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">include_tasks</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">inner.yml</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="c1"># inner.yml</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">set_fact</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">outer_item</span><span class="p p-Indicator">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">debug</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">msg</span><span class="p p-Indicator">:</span> <span class="s">&quot;outer</span><span class="nv"> </span><span class="s">item=</span><span class="cp">{{</span> <span class="nv">outer_item</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">inner</span><span class="nv"> </span><span class="s">item=</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">with_items</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">a</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">b</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">c</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-your-own-iterators">
<span id="id11"></span><h2><a class="toc-backref" href="#id33">Writing Your Own Iterators</a><a class="headerlink" href="#writing-your-own-iterators" title="Permalink to this headline">¶</a></h2>
<p>While you ordinarily shouldn&#8217;t have to, should you wish to write your own ways to loop over arbitrary data structures, you can read <a class="reference internal" href="dev_guide/developing_plugins.html"><span class="doc">Developing Plugins</span></a> for some starter
information.  Each of the above features are implemented as plugins in ansible, so there are many implementations to reference.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="playbooks.html"><span class="doc">Playbooks</span></a></dt>
<dd>An introduction to playbooks</dd>
<dt><a class="reference internal" href="playbooks_reuse_roles.html"><span class="doc">Roles</span></a></dt>
<dd>Playbook organization by roles</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html"><span class="doc">Best Practices</span></a></dt>
<dd>Best practices in playbooks</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html"><span class="doc">Conditionals</span></a></dt>
<dd>Conditional statements in playbooks</dd>
<dt><a class="reference internal" href="playbooks_variables.html"><span class="doc">Variables</span></a></dt>
<dd>All about variables</dd>
<dt><a class="reference external" href="http://groups.google.com/group/ansible-devel">User Mailing List</a></dt>
<dd>Have a question?  Stop by the google group!</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt>
<dd>#ansible IRC chat channel</dd>
</dl>
</div>
</div>
</div>


          </div>
          <div id="search-results"><gcse:searchresults-only></div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="playbooks_blocks.html" class="btn btn-neutral float-right" title="Blocks"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="playbooks_conditionals.html" class="btn btn-neutral" title="Conditionals"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <p>
  Copyright © 2017 Red Hat, Inc.
  <br>
    Last updated on Oct 10, 2017.
  </p>
<p>
Ansible docs are generated from <a href="https://github.com/ansible/ansible">GitHub sources</a> using <a href="http://sphinx-doc.org/">Sphinx</a> using a theme provided by <a href="http://readthedocs.org">Read the Docs</a>. 
</p>
</footer>
        </div>
      </div>

    </section>

  </div>
  


<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
        (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
        n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
        e.parentNode.insertBefore(n, e);
        })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
_satellite.pageBottom();
}
</script>
</body>
</html>