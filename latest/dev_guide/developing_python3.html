

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="text/javascript" src="//www.redhat.com/dtm.js"></script>

  <!-- Google Tag Manager Data Layer -->
  <script>
   dataLayer = [];
  </script>
  <!-- End Google Tag Manager Data Layer -->




  
  <title>Ansible and Python 3 &mdash; Ansible Documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'2.4',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  false
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Ansible Documentation" href="../index.html"/>
        <link rel="up" title="Developer Information" href="index.html"/>
        <link rel="next" title="Python API" href="developing_api.html"/>
        <link rel="prev" title="Developing the Ansible Core Engine" href="developing_core.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  <style>
    .search-reset-start {
        color: #463E3F;
        float: right;
        position: relative;
        top: -25px;
        left: -10px;
        z-index: 10;
     }
     .search-reset-start:hover {
        cursor: pointer;
        color: #2980B9;
     }
     #search-box-id {
        padding-right: 25px;
     }
  </style>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300'
    rel='stylesheet' type='text/css'>

</head>

<body class="wy-body-for-nav">

  <!-- Google Tag Manager -->
  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
  <!-- End Google Tag Manager -->

    <div class="DocSite-globalNav ansibleNav">
        <ul>
            <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
            <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
            <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
            <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
            <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
        </ul>
    </div>

  <a class="DocSite-nav" href="/">
    <img class="DocSiteNav-logo"
      src="../_static/images/logo_invert.png"
      alt="Ansible Logo">
    <div class="DocSiteNav-title">
      Documentation
    </div>
  </a>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">

      <div style="background-color:#5bbdbf;height=80px;margin:'auto auto auto auto'">
        <a class="DocSiteProduct-header DocSiteProduct-header--core" href="/">
            <div class="DocSiteProduct-productName">
                <div class="DocSiteProduct-logoText">
                    Ansible  
                    <div class="DocSiteProduct-CurrentVersion" align="right">
                      v2.4
                  </div>
                </div>
            </div>
        </a>
        

          <div class="DocSiteProduct-CheckVersionPara">For previous versions, see the  <a class="DocSiteProduct-versionheader" href="/#coreversionselect">documentation archive.</a></div>
      </div>

      <div id="menu-id" class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro_installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_inventory.html">Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_dynamic_inventory.html">Dynamic Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_adhoc.html">Introduction To Ad-Hoc Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_configuration.html">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_bsd.html">BSD Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_windows.html">Windows Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro_networking.html">Networking Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Video</a></li>
<li class="toctree-l1"><a class="reference internal" href="../playbooks.html">Playbooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_intro.html">Intro to Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_reuse.html">Creating Reusable Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_templating.html">Templating (Jinja2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_loops.html">Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_strategies.html">Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_best_practices.html">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../playbooks_special_topics.html">Playbooks: Special Topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../become.html">Become (Privilege Escalation)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_acceleration.html">Accelerated Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_async.html">Asynchronous Actions and Polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_checkmode.html">Check Mode (&#8220;Dry Run&#8221;)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_debugger.html">Playbook Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_delegation.html">Delegation, Rolling Updates, and Local Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_environment.html">Setting the Environment (and Working With Proxies)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_environment.html#working-with-language-specific-version-managers">Working With Language-Specific Version Managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_error_handling.html">Error Handling In Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_lookups.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_prompts.html">Prompts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_tags.html">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_vault.html">Using Vault in playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_startnstep.html">Start and Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="../playbooks_keywords.html">Directives Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">About Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules_intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_return_values.html">Return Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules_support.html">Module Maintenance &amp; Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules_by_category.html">Module Index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../list_of_all_modules.html">All Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_cloud_modules.html">Cloud Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_clustering_modules.html">Clustering Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_commands_modules.html">Commands Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_crypto_modules.html">Crypto Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_database_modules.html">Database Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_files_modules.html">Files Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_identity_modules.html">Identity Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_inventory_modules.html">Inventory Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_messaging_modules.html">Messaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_monitoring_modules.html">Monitoring Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_net_tools_modules.html">Net Tools Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_network_modules.html">Network Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_notification_modules.html">Notification Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_packaging_modules.html">Packaging Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_remote_management_modules.html">Remote Management Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_source_control_modules.html">Source Control Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_storage_modules.html">Storage Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_system_modules.html">System Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_utilities_modules.html">Utilities Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_web_infrastructure_modules.html">Web Infrastructure Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../list_of_windows_modules.html">Windows Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vault.html">Ansible Vault</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#what-can-be-encrypted-with-vault">What Can Be Encrypted With Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#creating-encrypted-files">Creating Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#editing-encrypted-files">Editing Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#rekeying-encrypted-files">Rekeying Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#encrypting-unencrypted-files">Encrypting Unencrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#decrypting-encrypted-files">Decrypting Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#viewing-encrypted-files">Viewing Encrypted Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#use-encrypt-string-to-create-encrypted-variables-to-embed-in-yaml">Use encrypt_string to create encrypted variables to embed in yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#vault-ids-and-multiple-vault-passwords">Vault Ids and Multiple Vault Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#providing-vault-passwords">Providing Vault Passwords</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#speeding-up-vault-operations">Speeding Up Vault Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#vault-format">Vault Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vault.html#vault-payload-format-1-1">Vault Payload Format 1.1</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../command_line_tools.html">Command Line Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ansible.html">ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-playbook.html">ansible-playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-vault.html">ansible-vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-galaxy.html">ansible-galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-console.html">ansible-console</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-config.html">ansible-config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-doc.html">ansible-doc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-inventory.html">ansible-inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-pull.html">ansible-pull</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides.html">Detailed Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guide_aws.html">Amazon Web Services Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_azure.html">Getting Started with Azure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_rax.html">Rackspace Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_gce.html">Google Cloud Platform Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_cloudstack.html">CloudStack Cloud Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_vagrant.html">Using Vagrant and Ansible</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_rolling_upgrade.html">Continuous Delivery and Rolling Upgrades</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_docker.html">Getting Started with Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide_packet.html">Using Ansible with the Packet host</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Information</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#ansible-developer-guide">Ansible Developer Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tower.html">Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community Information &amp; Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../community.html#ansible-users">Ansible Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community.html#for-current-and-prospective-developers">For Current and Prospective Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community.html#other-topics">Other Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community.html#community-code-of-conduct">Community Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../community.html#contributors-license-agreement">Contributors License Agreement</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy.html">Ansible Galaxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../galaxy.html#the-website">The Website</a></li>
<li class="toctree-l2"><a class="reference internal" href="../galaxy.html#the-command-line-tool">The command line tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../test_strategies.html">Testing Strategies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#integrating-testing-with-ansible-playbooks">Integrating Testing With Ansible Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#the-right-level-of-testing">The Right Level of Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#check-mode-as-a-drift-test">Check Mode As A Drift Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#modules-that-are-useful-for-testing">Modules That Are Useful for Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#testing-lifecycle">Testing Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#integrating-testing-with-rolling-updates">Integrating Testing With Rolling Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#achieving-continuous-deployment">Achieving Continuous Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_strategies.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-can-i-set-the-path-or-any-other-environment-variable-for-a-task-or-entire-playbook">How can I set the PATH or any other environment variable for a task or entire playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-handle-different-machines-needing-different-user-accounts-or-ports-to-log-in-with">How do I handle different machines needing different user accounts or ports to log in with?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-get-ansible-to-reuse-connections-enable-kerberized-ssh-or-have-ansible-pay-attention-to-my-local-ssh-config-file">How do I get ansible to reuse connections, enable Kerberized SSH, or have Ansible pay attention to my local SSH config file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to">How do I configure a jump host to access servers that I have no direct access to?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-speed-up-management-inside-ec2">How do I speed up management inside EC2?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-handle-python-pathing-not-having-a-python-2-x-in-usr-bin-python-on-a-remote-machine">How do I handle python pathing not having a Python 2.X in /usr/bin/python on a remote machine?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#what-is-the-best-way-to-make-content-reusable-redistributable">What is the best way to make content reusable/redistributable?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#where-does-the-configuration-file-live-and-what-can-i-configure-in-it">Where does the configuration file live and what can I configure in it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-disable-cowsay">How do I disable cowsay?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-see-a-list-of-all-of-the-ansible-variables">How do I see a list of all of the ansible_ variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-see-all-the-inventory-vars-defined-for-my-host">How do I see all the inventory vars defined for my host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template">How do I loop over a list of hosts in a group, inside of a template?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-access-a-variable-name-programmatically">How do I access a variable name programmatically?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-access-a-variable-of-the-first-host-in-a-group">How do I access a variable of the first host in a group?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-copy-files-recursively-onto-a-target-host">How do I copy files recursively onto a target host?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-access-shell-environment-variables">How do I access shell environment variables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-generate-crypted-passwords-for-the-user-module">How do I generate crypted passwords for the user module?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#can-i-get-training-on-ansible">Can I get training on Ansible?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#is-there-a-web-interface-rest-api-etc">Is there a web interface / REST API / etc?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-submit-a-change-to-the-documentation">How do I submit a change to the documentation?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#how-do-i-keep-secret-data-in-my-playbook">How do I keep secret data in my playbook?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#when-should-i-use-also-how-to-interpolate-variables-or-dynamic-variable-names">When should I use {{ }}? Also, how to interpolate variables or dynamic variable names</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#why-don-t-you-ship-in-x-format">Why don&#8217;t you ship in X format?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#i-don-t-see-my-question-here">I don&#8217;t see my question here</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config.html#common-options">Common Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../YAMLSyntax.html">YAML Syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../YAMLSyntax.html#yaml-basics">YAML Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../YAMLSyntax.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides.html">Ansible Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_3_support.html">Python 3 Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../python_3_support.html#testing-python-3-with-commands-and-playbooks">Testing Python 3 with commands and playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_3_support.html#testing-python-3-module-support">Testing Python 3 module support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python_3_support.html#what-to-do-if-an-incompatibility-is-found">What to do if an incompatibility is found</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release_and_maintenance.html">Release and maintenance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../release_and_maintenance.html#release-cycle">Release cycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_and_maintenance.html#release-status">Release status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_and_maintenance.html#development-and-stable-version-maintenance-workflow">Development and stable version maintenance workflow</a></li>
</ul>
</li>
</ul>

        


    <div class="DocSite-sideNav ansibleNav">
       <ul class="">
       <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
       <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
       <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
       <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
       <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
       </ul>
     </div>

    <!-- changeable widget -->
    <div id="sideBanner">
    <br/>
    <a href="https://www.ansible.com/docs-left?utm_source=docs">
      <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
    </a>
    </div>


      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Ansible Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <!-- Banner ads
          <div class="DocSiteBanner">
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-left.png">
            </a>
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-right.png">
            </a>
        </div> -->

          <ul class="wy-breadcrumbs">
  <li><a href="../index.html">Docs</a> &raquo;</li>
  <li><a href="">Ansible and Python 3</a></li>
  
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/ansible/ansible/blob/devel/docs/docsite/rst/dev_guide/developing_python3.rst" class="icon icon-github"> Edit on GitHub</a>
    </li>
  
</ul>
<hr/>

          <div id="page-content">
          
  <div class="section" id="ansible-and-python-3">
<h1>Ansible and Python 3<a class="headerlink" href="#ansible-and-python-3" title="Permalink to this headline">¶</a></h1>
<p>Ansible is pursuing a strategy of having one code base that runs on both
Python-2 and Python-3 because we want Ansible to be able to manage a wide
variety of machines.  Contributors to Ansible should be aware of the tips in
this document so that they can write code that will run on the same versions
of Python as the rest of Ansible.</p>
<p>Ansible can be divided into three overlapping pieces for the purposes of
porting:</p>
<ol class="arabic simple">
<li>Controller-side code.  This is the code which runs on the machine where you
invoke <strong class="command">/usr/bin/ansible</strong></li>
<li>Modules.  This is the code which Ansible transmits over the wire and
invokes on the managed machine.</li>
<li>module_utils code.  This is code whose primary purpose is to be used by the
modules to perform tasks.  However, some controller-side code might use
generic functions from here.</li>
</ol>
<p>Much of the knowledge of porting code will be usable on all three of these
pieces but there are some special considerations for some of it as well.
Information that is generally applicable to all three places is located in the
controller-side section.</p>
<div class="section" id="minimum-version-of-python-3-x-and-python-2-x">
<h2>Minimum Version of Python-3.x and Python-2.x<a class="headerlink" href="#minimum-version-of-python-3-x-and-python-2-x" title="Permalink to this headline">¶</a></h2>
<p>In both controller side and module code, we support Python-3.5 or greater and Python-2.6 or
greater.  Python-3.5 was chosen as a minimum because it is the earliest Python-3 version
adopted as the default Python by a Long Term Support (LTS) Linux distribution (in this case, Ubuntu-16.04).
Previous LTS Linux distributions shipped with a Python-2 version which users can rely upon instead of the
Python-3 version.</p>
<p>For Python-2, the default is for modules to run on at least Python-2.6.  This allows
users with older distributions that are stuck on Python-2.6 to manage their
machines.  Modules are allowed to drop support for Python-2.6 when one of
their dependent libraries requires a higher version of Python.  This is not an
invitation to add unnecessary dependent libraries in order to force your
module to be usable only with a newer version of Python; instead it is an
acknowledgment that some libraries (for instance, boto3 and docker-py) will
only function with a newer version of Python.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Python-2.4 Module-side Support:</p>
<p class="last">Support for Python-2.4 and Python-2.5 was dropped in Ansible-2.4.  RHEL-5
(and its rebuilds like CentOS-5) were supported until April of 2017.
Ansible-2.3 was released in April of 2017 and was the last Ansible release
to support Python-2.4 on the module-side.</p>
</div>
</div>
<div class="section" id="porting-controller-code-to-python-3">
<h2>Porting Controller Code to Python 3<a class="headerlink" href="#porting-controller-code-to-python-3" title="Permalink to this headline">¶</a></h2>
<p>Most of the general tips for porting code to be used on both Python-2 and
Python-3 applies to porting controller code.  The best place to start learning
to port code is <a class="reference external" href="http://python3porting.com/">Lennart Regebro&#8217;s book: Porting to Python 3</a>.</p>
<p>The book describes several strategies for porting to Python 3.  The one we&#8217;re
using is <a class="reference external" href="http://python3porting.com/strategies.html#python-2-and-python-3-without-conversion">to support Python-2 and Python-3 from a single code base</a></p>
<div class="section" id="controller-string-strategy">
<h3>Controller String Strategy<a class="headerlink" href="#controller-string-strategy" title="Permalink to this headline">¶</a></h3>
<div class="section" id="background">
<h4>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h4>
<p>One of the most essential things to decide upon for porting code to Python-3
is what string model to use.  Strings can be an array of bytes (like in C) or
they can be an array of text.  Text is what we think of as letters, digits,
numbers, other printable symbols, and a small number of unprintable &#8220;symbols&#8221;
(control codes).</p>
<p>In Python-2, the two types for these (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">str</span></code></a> for bytes and
<code class="xref py py-class docutils literal"><span class="pre">unicode</span></code> for text) are often used interchangeably.  When dealing only
with ASCII characters, the strings can be combined, compared, and converted
from one type to another automatically.  When non-ASCII characters are
introduced, Python starts throwing exceptions due to not knowing what encoding
the non-ASCII characters should be in.</p>
<p>Python-3 changes this behavior by making the separation between bytes (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">bytes</span></code></a>)
and text (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">str</span></code></a>) more strict.  Python will throw an exception when
trying to combine and compare the two types.  The programmer has to explicitly
convert from one type to the other to mix values from each.</p>
<p>This change makes it immediately apparent to the programmer when code is
mixing the types inappropriately, rather than working until one of their users
causes an exception by entering non-ASCII input.  However, it forces the
programmer to proactively define a strategy for working with strings in their
program so that they don&#8217;t mix text and byte strings unintentionally.</p>
</div>
<div class="section" id="unicode-sandwich">
<h4>Unicode Sandwich<a class="headerlink" href="#unicode-sandwich" title="Permalink to this headline">¶</a></h4>
<p>In controller-side code we use a strategy known as the Unicode Sandwich (named
after Python-2&#8217;s <code class="xref py py-class docutils literal"><span class="pre">unicode</span></code> text type).  For Unicode Sandwich we know that
at the border of our code and the outside world (for example, file and network IO,
environment variables, and some library calls) we are going to receive bytes.
We need to transform these bytes into text and use that throughout the
internal portions of our code.  When we have to send those strings back out to
the outside world we first convert the text back into bytes.
To visualize this, imagine a &#8216;sandwich&#8217; consisting of a top and bottom layer
of bytes, a layer of conversion between, and all text type in the center.</p>
</div>
<div class="section" id="common-borders">
<h4>Common Borders<a class="headerlink" href="#common-borders" title="Permalink to this headline">¶</a></h4>
<p>This is a partial list of places where we have to convert to and from bytes.
It&#8217;s not exhaustive but gives you an idea of where to watch for problems.</p>
<div class="section" id="reading-and-writing-to-files">
<h5>Reading and writing to files<a class="headerlink" href="#reading-and-writing-to-files" title="Permalink to this headline">¶</a></h5>
<p>In Python-2, reading from files yields bytes.  In Python-3, it can yield text.
To make code that&#8217;s portable to both we don&#8217;t make use of Python-3&#8217;s ability
to yield text but instead do the conversion explicitly ourselves. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils._text</span> <span class="kn">import</span> <span class="n">to_text</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filename-with-utf8-data.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
    <span class="n">b_data</span> <span class="o">=</span> <span class="n">my_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">to_text</span><span class="p">(</span><span class="n">b_data</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogate_or_strict&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
        <span class="c1"># Handle the exception gracefully -- usually by displaying a good</span>
        <span class="c1"># user-centric error message that can be traced back to this piece</span>
        <span class="c1"># of code.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Much of Ansible assumes that all encoded text is UTF-8.  At some
point, if there is demand for other encodings we may change that, but for
now it is safe to assume that bytes are UTF-8.</p>
</div>
<p>Writing to files is the opposite process:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils._text</span> <span class="kn">import</span> <span class="n">to_bytes</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filename.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
    <span class="n">my_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">some_text_string</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that we don&#8217;t have to catch <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#UnicodeError" title="(in Python v3.6)"><code class="xref py py-exc docutils literal"><span class="pre">UnicodeError</span></code></a> here because we&#8217;re
transforming to UTF-8 and all text strings in Python can be transformed back
to UTF-8.</p>
</div>
<div class="section" id="filesystem-interaction">
<h5>Filesystem Interaction<a class="headerlink" href="#filesystem-interaction" title="Permalink to this headline">¶</a></h5>
<p>Dealing with filenames often involves dropping back to bytes because on UNIX-like
systems filenames are bytes.  On Python-2, if we pass a text string to these
functions, the text string will be converted to a byte string inside of the
function and a traceback will occur if non-ASCII characters are present.  In
Python-3, a traceback will only occur if the text string can&#8217;t be decoded in
the current locale, but it&#8217;s still good to be explicit and have code which
works on both versions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">from</span> <span class="nn">ansible.module_utils._text</span> <span class="kn">import</span> <span class="n">to_bytes</span>

<span class="n">filename</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;/var/tmp/くらとみ.txt&#39;</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
<span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<span class="n">b_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">)):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>When you are only manipulating a filename as a string without talking to the
filesystem (or a C library which talks to the filesystem) you can often get
away without converting to bytes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>

<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;/var/tmp/café&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;くらとみ&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;/var/tmp/café/くらとみ&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>On the other hand, if the code needs to manipulate the filename and also talk
to the filesystem, it can be more convenient to transform to bytes right away
and manipulate in bytes.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure all variables passed to a function are the same type.
If you&#8217;re working with something like <a class="reference external" href="https://docs.python.org/3/library/os.path.html#os.path.join" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">os.path.join()</span></code></a> which takes
multiple strings and uses them in combination, you need to make sure that
all the types are the same (either all bytes or all text).  Mixing
bytes and text will cause tracebacks.</p>
</div>
</div>
<div class="section" id="interacting-with-other-programs">
<h5>Interacting with Other Programs<a class="headerlink" href="#interacting-with-other-programs" title="Permalink to this headline">¶</a></h5>
<p>Interacting with other programs goes through the operating system and
C libraries and operates on things that the UNIX kernel defines.  These
interfaces are all byte-oriented so the Python interface is byte oriented as
well.  On both Python-2 and Python-3, byte strings should be given to Python&#8217;s
subprocess library and byte strings should be expected back from it.</p>
<p>One of the main places in Ansible&#8217;s controller code that we interact with
other programs is the connection plugins&#8217; <code class="docutils literal"><span class="pre">exec_command</span></code> methods.  These
methods transform any text strings they receive in the command (and arguments
to the command) to execute into bytes and return stdout and stderr as byte strings
Higher level functions (like action plugins&#8217; <code class="docutils literal"><span class="pre">_low_level_execute_command</span></code>)
transform the output into text strings.</p>
</div>
</div>
</div>
<div class="section" id="tips-tricks-and-idioms-to-adopt">
<h3>Tips, tricks, and idioms to adopt<a class="headerlink" href="#tips-tricks-and-idioms-to-adopt" title="Permalink to this headline">¶</a></h3>
<div class="section" id="forwards-compatibility-boilerplate">
<h4>Forwards Compatibility Boilerplate<a class="headerlink" href="#forwards-compatibility-boilerplate" title="Permalink to this headline">¶</a></h4>
<p>Use the following boilerplate code at the top of all controller-side modules
to make certain constructs act the same way on Python-2 and Python-3:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Make coding more python3-ish</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">)</span>
<span class="vm">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">__metaclass__</span> <span class="pre">=</span> <span class="pre">type</span></code> makes all classes defined in the file into new-style
classes without explicitly inheriting from <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">__future__</span></code> imports do the following:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">absolute_import:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">Makes imports look in <code class="xref py py-attr docutils literal"><span class="pre">sys.path</span></code> for the modules being
imported, skipping the directory in which the module doing the importing
lives.  If the code wants to use the directory in which the module doing
the importing, there&#8217;s a new dot notation to do so.</td>
</tr>
<tr class="field-even field"><th class="field-name">division:</th><td class="field-body">Makes division of integers always return a float.  If you need to
find the quotient use <code class="docutils literal"><span class="pre">x</span> <span class="pre">//</span> <span class="pre">y</span></code> instead of <code class="docutils literal"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">y</span></code>.</td>
</tr>
<tr class="field-odd field"><th class="field-name">print_function:</th><td class="field-body">Changes <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a> from a keyword into a function.</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-0328/#guido-s-decision">PEP 0328: Absolute Imports</a></li>
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-0238">PEP 0238: Division</a></li>
<li><a class="reference external" href="https://www.python.org/dev/peps/pep-3105">PEP 3105: Print function</a></li>
</ul>
</div>
</div>
<div class="section" id="prefix-byte-strings-with-b">
<h4>Prefix byte strings with &#8220;b_&#8221;<a class="headerlink" href="#prefix-byte-strings-with-b" title="Permalink to this headline">¶</a></h4>
<p>Since mixing text and bytes types leads to tracebacks we want to be clear
about what variables hold text and what variables hold bytes.  We do this by
prefixing any variable holding bytes with <code class="docutils literal"><span class="pre">b_</span></code>.  For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;/var/tmp/café.txt&#39;</span>
<span class="n">b_filename</span> <span class="o">=</span> <span class="n">to_bytes</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">b_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>We do not prefix the text strings instead because we only operate
on byte strings at the borders, so there are fewer variables that need bytes
than text.</p>
</div>
<div class="section" id="bundled-six">
<h4>Bundled six<a class="headerlink" href="#bundled-six" title="Permalink to this headline">¶</a></h4>
<p>The third-party <a class="reference external" href="https://pythonhosted.org/six/">python-six</a> library exists
to help projects create code that runs on both Python-2 and Python-3.  Ansible
includes a version of the library in module_utils so that other modules can use it
without requiring that it is installed on the remote system.  To make use of
it, import it like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils</span> <span class="kn">import</span> <span class="n">six</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Ansible can also use a system copy of six</p>
<p class="last">Ansible will use a system copy of six if the system copy is a later
version than the one Ansible bundles.</p>
</div>
</div>
<div class="section" id="exceptions">
<h4>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h4>
<p>In order for code to function on Python-2.6+ and Python-3, use the
new exception-catching syntax which uses the <code class="docutils literal"><span class="pre">as</span></code> keyword:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">0</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">module</span><span class="o">.</span><span class="n">fail_json</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Tried to divide by zero: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>Do <strong>not</strong> use the following syntax as it will fail on every version of Python-3:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>try:
    a = 2/0
except ValueError, e:
    module.fail_json(msg=&quot;Tried to divide by zero: %s&quot; % e)
</pre></div>
</div>
</div>
<div class="section" id="octal-numbers">
<h4>Octal numbers<a class="headerlink" href="#octal-numbers" title="Permalink to this headline">¶</a></h4>
<p>In Python-2.x, octal literals could be specified as <code class="docutils literal"><span class="pre">0755</span></code>.  In Python-3,
octals must be specified as <code class="docutils literal"><span class="pre">0o755</span></code>.</p>
</div>
<div class="section" id="string-formatting">
<h4>String formatting<a class="headerlink" href="#string-formatting" title="Permalink to this headline">¶</a></h4>
<div class="section" id="str-format-compatibility">
<h5>str.format() compatibility<a class="headerlink" href="#str-format-compatibility" title="Permalink to this headline">¶</a></h5>
<p>Starting in Python-2.6, strings gained a method called <code class="docutils literal"><span class="pre">format()</span></code> to put
strings together.  However, one commonly used feature of <code class="docutils literal"><span class="pre">format()</span></code> wasn&#8217;t
added until Python-2.7, so you need to remember not to use it in Ansible code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Does not work in Python-2.6!</span>
<span class="n">new_string</span> <span class="o">=</span> <span class="s2">&quot;Dear {}, Welcome to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>

<span class="c1"># Use this instead</span>
<span class="n">new_string</span> <span class="o">=</span> <span class="s2">&quot;Dear {0}, Welcome to {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
</pre></div>
</div>
<p>Both of the format strings above map positional arguments of the <code class="docutils literal"><span class="pre">format()</span></code>
method into the string.  However, the first version doesn&#8217;t work in
Python-2.6.  Always remember to put numbers into the placeholders so the code
is compatible with Python-2.6.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Python documentation on <a class="reference external" href="https://docs.python.org/2/library/string.html#formatstrings">format strings</a></p>
</div>
</div>
<div class="section" id="use-percent-format-with-byte-strings">
<h5>Use percent format with byte strings<a class="headerlink" href="#use-percent-format-with-byte-strings" title="Permalink to this headline">¶</a></h5>
<p>In Python-3.x, byte strings do not have a <code class="docutils literal"><span class="pre">format()</span></code> method.  However, it
does have support for the older, percent-formatting.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">b_command_line</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;ansible-playbook --become-user </span><span class="si">%s</span><span class="s1"> -K </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">playbook_file</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Percent formatting added in Python-3.5</p>
<p class="last">Percent formatting of byte strings was added back into Python3 in 3.5.
This isn&#8217;t a problem for us because Python-3.5 is our minimum version.
However, if you happen to be testing Ansible code with Python-3.4 or
earlier, you will find that the byte string formatting here won&#8217;t work.
Upgrade to Python-3.5 to test.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Python documentation on <a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#string-formatting">percent formatting</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="porting-modules-to-python-3">
<h2>Porting Modules to Python 3<a class="headerlink" href="#porting-modules-to-python-3" title="Permalink to this headline">¶</a></h2>
<p>Ansible modules are slightly harder to port than normal code from other
projects. A lot of mocking has to go into unit testing an Ansible module so
it&#8217;s harder to test that your porting has fixed everything or to to make sure
that later commits haven&#8217;t regressed the Python-3 support.</p>
<div class="section" id="module-string-strategy">
<h3>Module String Strategy<a class="headerlink" href="#module-string-strategy" title="Permalink to this headline">¶</a></h3>
<p>There are a large number of modules in Ansible.  Most of those are maintained
by the Ansible community at large, not by a centralized team.  To make life
easier on them, it was decided not to break backwards compatibility by
mandating that all strings inside of modules are text and converting between
text and bytes at the borders; instead, we&#8217;re using a native string strategy
for now.</p>
<p>Native strings refer to the type that Python uses when you specify a bare
string literal:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s2">&quot;This is a native string&quot;</span>
</pre></div>
</div>
<p>In Python-2, these are byte strings.  In Python-3 these are text strings.  The
module_utils shipped with Ansible attempts to accept native strings as input
to its functions and emit native strings as their output.  Modules should be
coded to expect bytes on Python-2 and text on Python-3.</p>
</div>
<div class="section" id="id1">
<h3>Tips, tricks, and idioms to adopt<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="python-2-4-compatible-exception-syntax">
<h4>Python-2.4 Compatible Exception Syntax<a class="headerlink" href="#python-2-4-compatible-exception-syntax" title="Permalink to this headline">¶</a></h4>
<p>Until Ansible-2.4, modules needed to be compatible with Python-2.4 as
well.  Python-2.4 did not understand the new exception-catching syntax so
we had to write a compatibility function that could work with both
Python-2 and Python-3.  You may still see this used in some modules:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible.module_utils.pycompat24</span> <span class="kn">import</span> <span class="n">get_exception</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">0</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">get_exception</span><span class="p">()</span>
    <span class="n">module</span><span class="o">.</span><span class="n">fail_json</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Tried to divide by zero: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>Unless a change is going to be backported to Ansible-2.3, you should not
have to use this in new code.</p>
</div>
<div class="section" id="python-2-4-octal-workaround">
<h4>Python 2.4 octal workaround<a class="headerlink" href="#python-2-4-octal-workaround" title="Permalink to this headline">¶</a></h4>
<p>Before Ansible-2.4, modules had to be compatible with Python-2.4.
Python-2.4 did not understand the new syntax for octal literals so we used
the following workaround to specify octal values:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Can&#39;t use 0755 on Python-3 and can&#39;t use 0o755 on Python-2.4</span>
<span class="n">EXECUTABLE_PERMS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;0755&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>Unless a change is going to be backported to Ansible-2.3, you should not
have to use this in new code.</p>
</div>
</div>
</div>
<div class="section" id="porting-module-utils-code-to-python-3">
<h2>Porting module_utils code to Python 3<a class="headerlink" href="#porting-module-utils-code-to-python-3" title="Permalink to this headline">¶</a></h2>
<p>module_utils code is largely like module code.  However, some pieces of it are
used by the controller as well.  Because of this, it needs to be usable with
the controller&#8217;s assumptions.  This is most notable in the string strategy.</p>
<div class="section" id="module-utils-string-strategy">
<h3>Module_utils String Strategy<a class="headerlink" href="#module-utils-string-strategy" title="Permalink to this headline">¶</a></h3>
<p>Module_utils <strong>must</strong> use the Native String Strategy.  Functions in
module_utils receive either text strings or byte strings and may emit either
the same type as they were given or the native string for the Python version
they are run on depending on which makes the most sense for that function.
Functions which return strings <strong>must</strong> document whether they return text,
byte, or native strings. Module-utils functions are therefore often very
defensive in nature, converting from potential text or bytes at the
beginning of a function and converting to the native string type at the end.</p>
</div>
</div>
</div>


          </div>
          <div id="search-results"><gcse:searchresults-only></div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="developing_api.html" class="btn btn-neutral float-right" title="Python API"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="developing_core.html" class="btn btn-neutral" title="Developing the Ansible Core Engine"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <p>
  Copyright © 2017 Red Hat, Inc.
  <br>
    Last updated on Oct 10, 2017.
  </p>
<p>
Ansible docs are generated from <a href="https://github.com/ansible/ansible">GitHub sources</a> using <a href="http://sphinx-doc.org/">Sphinx</a> using a theme provided by <a href="http://readthedocs.org">Read the Docs</a>. 
</p>
</footer>
        </div>
      </div>

    </section>

  </div>
  


<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
        (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
        n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
        e.parentNode.insertBefore(n, e);
        })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
_satellite.pageBottom();
}
</script>
</body>
</html>