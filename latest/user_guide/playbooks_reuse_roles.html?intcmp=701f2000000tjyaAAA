

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Roles &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Including and importing" href="playbooks_reuse_includes.html" />
    <link rel="prev" title="Re-using Ansible artifacts" href="playbooks_reuse.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="2.10">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                2.10
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "2.10" ) {
              option.selected = true;
            }
            if (current_url.search("2.10") > -1) {
              option.value = current_url.replace("2.10","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.9";
            if ( "2.9" == "2.10" ) {
              option.selected = true;
            }
            if (current_url.search("2.10") > -1) {
              option.value = current_url.replace("2.10","2.9");
            } else {
              option.value = current_url.replace("latest","2.9");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.9_ja";
            if ( "2.9_ja" == "2.10" ) {
              option.selected = true;
            }
            if (current_url.search("2.10") > -1) {
              option.value = current_url.replace("2.10","2.9_ja");
            } else {
              option.value = current_url.replace("latest","2.9_ja");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "2.10" ) {
              option.selected = true;
            }
            if (current_url.search("2.10") > -1) {
              option.value = current_url.replace("2.10","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "2.10" ) {
              option.selected = true;
            }
            if (current_url.search("2.10") > -1) {
              option.value = current_url.replace("2.10","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#getting-started">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tasks-plays-and-playbooks">Writing tasks, plays, and playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-inventory">Working with inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interacting-with-data">Interacting with data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#executing-playbooks">Executing playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-features-and-reference">Advanced features and reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#traditional-table-of-contents">Traditional Table of Contents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="quickstart.html">Ansible Quickstart Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_concepts.html">Ansible concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_adhoc.html">Introduction to ad-hoc commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks.html">Working with playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_intro.html">Intro to playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_best_practices.html">Tips and tricks</a></li>
<li class="toctree-l3"><a class="reference internal" href="become.html">Understanding privilege escalation: become</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_delegation.html">Controlling where tasks run: delegation and local actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tests.html">Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_handlers.html">Handlers: running operations on change</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_error_handling.html">Error handling in playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html">Setting the remote environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html#working-with-language-specific-version-managers">Working with language-specific version managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse.html">Re-using Ansible artifacts</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Roles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#role-directory-structure">Role directory structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#storing-and-finding-roles">Storing and finding roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-roles">Using roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-a-role-multiple-times-in-one-playbook">Running a role multiple times in one playbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-role-dependencies">Using role dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#embedding-modules-and-plugins-in-roles">Embedding modules and plugins in roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sharing-roles-ansible-galaxy">Sharing roles: Ansible Galaxy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse_includes.html">Including and importing</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tags.html">Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_inventory.html">How to build your inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_dynamic_inventory.html">Working with dynamic inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_patterns.html">Patterns: targeting hosts and groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="connection_details.html">Connection methods and details</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_tools.html">Working with command line tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_variables.html">Using Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_vars_facts.html">Discovering variables: facts and magic variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="vault.html">Encrypting content with Ansible Vault</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_filters.html">Using filters to manipulate data</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_prompts.html">Interactive input: prompts</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_module_defaults.html">Module defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_checkmode.html">Validating tasks: check mode and diff mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_startnstep.html">Executing playbooks for troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_debugger.html">Debugging tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_strategies.html">Controlling playbook execution: strategies and more</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_async.html">Asynchronous actions and polling</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="complex_data_manipulation.html">Data manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_filtering_config.html">Blacklisting modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample_setup.html">Sample Ansible setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html">Working With Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/plugins.html">Working With Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_bsd.html">Ansible and BSD</a></li>
<li class="toctree-l3"><a class="reference internal" href="windows.html">Windows Guides</a></li>
<li class="toctree-l3"><a class="reference internal" href="collections_using.html">Using collections</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html">Collection Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
      <li>Roles</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/user_guide/playbooks_reuse_roles.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    startsWith = function(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      document.write('<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>');
      document.write('</div>');
    }
    
      // Create a banner if we're not the latest version
      current_url_path = window.location.pathname;
      if (startsWith(current_url_path, "/ansible/latest/") || startsWith(current_url_path, "/ansible/2.10/")) {
        document.write('<div id="banner_id" class="admonition caution">');
        document.write('<p>You are reading the latest community version of the Ansible documentation. Red Hat subscribers, select <b>2.9</b> in the version selection to the left for the most recent Red Hat release.</p>');
        document.write('</div>');

        /* temp banner to advertise AnsibleFest
        document.write('<div id="banner_id" class="admonition important">');
        document.write('<p><a href="https://www.ansible.com/ansiblefest?sc_cid=7013a000002gyPxAAI">AnsibleFest</a> is going virtual with two days of expert speakers, live demos and hands-on labs Oct 13-14!</p>');
        document.write('</div>'); */
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        document.write('<div id="banner_id" class="admonition caution">');
        document.write('<p>You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this, or select any version in version selection to the left, including <b>latest</b> for the most recent community version.</p>');
        document.write('</div>');
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        document.write('<div id="banner_id" class="admonition caution">');
        document.write('<p>You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.</p>');
        document.write('</div>');
      } else {
        document.write('<div id="banner_id" class="admonition caution">');
        document.write('<p>You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.</p>');
        document.write('</div>');
      }
    
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="roles">
<span id="playbooks-reuse-roles"></span><h1>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h1>
<p>Roles let you automatically load related vars_files, tasks, handlers, and other Ansible artifacts based on a known file structure. Once you group your content in roles, you can easily reuse them and share them with other users.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#role-directory-structure" id="id2">Role directory structure</a></p></li>
<li><p><a class="reference internal" href="#storing-and-finding-roles" id="id3">Storing and finding roles</a></p></li>
<li><p><a class="reference internal" href="#using-roles" id="id4">Using roles</a></p>
<ul>
<li><p><a class="reference internal" href="#using-roles-at-the-play-level" id="id5">Using roles at the play level</a></p></li>
<li><p><a class="reference internal" href="#including-roles-dynamic-reuse" id="id6">Including roles: dynamic reuse</a></p></li>
<li><p><a class="reference internal" href="#importing-roles-static-reuse" id="id7">Importing roles: static reuse</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-a-role-multiple-times-in-one-playbook" id="id8">Running a role multiple times in one playbook</a></p>
<ul>
<li><p><a class="reference internal" href="#passing-different-parameters" id="id9">Passing different parameters</a></p></li>
<li><p><a class="reference internal" href="#using-allow-duplicates-true" id="id10">Using <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-role-dependencies" id="id11">Using role dependencies</a></p>
<ul>
<li><p><a class="reference internal" href="#running-role-dependencies-multiple-times-in-one-playbook" id="id12">Running role dependencies multiple times in one playbook</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#embedding-modules-and-plugins-in-roles" id="id13">Embedding modules and plugins in roles</a></p></li>
<li><p><a class="reference internal" href="#sharing-roles-ansible-galaxy" id="id14">Sharing roles: Ansible Galaxy</a></p></li>
</ul>
</div>
<div class="section" id="role-directory-structure">
<h2><a class="toc-backref" href="#id2">Role directory structure</a><a class="headerlink" href="#role-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>An Ansible role has a defined directory structure with seven main standard directories. You must include at least one of these directories in each role. You can omit any directories the role does not use. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># playbooks
site.yml
webservers.yml
fooservers.yml
roles/
    common/
        tasks/
        handlers/
        library/
        files/
        templates/
        vars/
        defaults/
        meta/
    webservers/
        tasks/
        defaults/
        meta/
</pre></div>
</div>
<p>By default Ansible will look in each directory within a role for a <code class="docutils literal notranslate"><span class="pre">main.yml</span></code> file for relevant content (also <code class="docutils literal notranslate"><span class="pre">main.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">main</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tasks/main.yml</span></code> - the main list of tasks that the role executes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handlers/main.yml</span></code> - handlers, which may be used within or outside this role.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">library/my_module.py</span></code> - modules, which may be used within this role (see <a class="reference internal" href="#embedding-modules-and-plugins-in-roles"><span class="std std-ref">Embedding modules and plugins in roles</span></a> for more information).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defaults/main.yml</span></code> - default variables for the role (see <a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for more information). These variables have the lowest priority of any variables available, and can be easily overridden by any other variable, including inventory variables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vars/main.yml</span></code> - other variables for the role (see <a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for more information).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">files/main.yml</span></code> - files that the role deploys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">templates/main.yml</span></code> - templates that the role deploys.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> - metadata for the role, including role dependencies.</p></li>
</ul>
<p>You can add other YAML files in some directories. For example, you can place platform-specific tasks in separate files and refer to them in the <code class="docutils literal notranslate"><span class="pre">tasks/main.yml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># roles/example/tasks/main.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install the correct web server for RHEL</span>
  <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">redhat.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;]|lower == &#39;redhat&#39;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install the correct web server for Debian</span>
  <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">debian.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;]|lower == &#39;debian&#39;</span>

<span class="c1"># roles/example/tasks/redhat.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install web server</span>
  <span class="nt">ansible.builtin.yum</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;httpd&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="c1"># roles/example/tasks/debian.yml</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install web server</span>
  <span class="nt">ansible.builtin.apt</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;apache2&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>
</div>
<p>Roles may also include modules and other plugin types in a directory called <code class="docutils literal notranslate"><span class="pre">library</span></code>. For more information, please refer to <a class="reference internal" href="#embedding-modules-and-plugins-in-roles"><span class="std std-ref">Embedding modules and plugins in roles</span></a> below.</p>
</div>
<div class="section" id="storing-and-finding-roles">
<span id="role-search-path"></span><h2><a class="toc-backref" href="#id3">Storing and finding roles</a><a class="headerlink" href="#storing-and-finding-roles" title="Permalink to this headline">¶</a></h2>
<p>By default, Ansible looks for roles in two locations:</p>
<ul class="simple">
<li><p>in a directory called <code class="docutils literal notranslate"><span class="pre">roles/</span></code>, relative to the playbook file</p></li>
<li><p>in <code class="docutils literal notranslate"><span class="pre">/etc/ansible/roles</span></code></p></li>
</ul>
<p>If you store your roles in a different location, set the <a class="reference internal" href="../reference_appendices/config.html#default-roles-path"><span class="std std-ref">roles_path</span></a> configuration option so Ansible can find your roles. Checking shared roles into a single location makes them easier to use in multiple playbooks. See <a class="reference internal" href="../installation_guide/intro_configuration.html#intro-configuration"><span class="std std-ref">Configuring Ansible</span></a> for details about managing settings in ansible.cfg.</p>
<p>Alternatively, you can call a role with a fully qualified path:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="s">&#39;/path/to/my/roles/common&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-roles">
<h2><a class="toc-backref" href="#id4">Using roles</a><a class="headerlink" href="#using-roles" title="Permalink to this headline">¶</a></h2>
<p>You can use roles in three ways:</p>
<ul class="simple">
<li><p>at the play level with the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option: This is the classic way of using roles in a play.</p></li>
<li><p>at the tasks level with <code class="docutils literal notranslate"><span class="pre">include_role</span></code>: You can reuse roles dynamically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">include_role</span></code>.</p></li>
<li><p>at the tasks level with <code class="docutils literal notranslate"><span class="pre">import_role</span></code>: You can reuse roles statically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">import_role</span></code>.</p></li>
</ul>
<div class="section" id="using-roles-at-the-play-level">
<span id="roles-keyword"></span><h3><a class="toc-backref" href="#id5">Using roles at the play level</a><a class="headerlink" href="#using-roles-at-the-play-level" title="Permalink to this headline">¶</a></h3>
<p>The classic (original) way to use roles is with the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option for a given play:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">common</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
</pre></div>
</div>
<p>When you use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option at the play level, for each role ‘x’:</p>
<ul class="simple">
<li><p>If roles/x/tasks/main.yml exists, Ansible adds the tasks in that file to the play.</p></li>
<li><p>If roles/x/handlers/main.yml exists, Ansible adds the handlers in that file to the play.</p></li>
<li><p>If roles/x/vars/main.yml exists, Ansible adds the variables in that file to the play.</p></li>
<li><p>If roles/x/defaults/main.yml exists, Ansible adds the variables in that file to the play.</p></li>
<li><p>If roles/x/meta/main.yml exists, Ansible adds any role dependencies in that file to the list of roles.</p></li>
<li><p>Any copy, script, template or include tasks (in the role) can reference files in roles/x/{files,templates,tasks}/ (dir depends on task) without having to path them relatively or absolutely.</p></li>
</ul>
<p>When you use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option at the play level, Ansible treats the roles as static imports and processes them during playbook parsing. Ansible executes your playbook in this order:</p>
<ul class="simple">
<li><p>Any <code class="docutils literal notranslate"><span class="pre">pre_tasks</span></code> defined in the play.</p></li>
<li><p>Any handlers triggered by pre_tasks.</p></li>
<li><p>Each role listed in <code class="docutils literal notranslate"><span class="pre">roles:</span></code>, in the order listed. Any role dependencies defined in the role’s <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> run first, subject to tag filtering and conditionals. See <a class="reference internal" href="#role-dependencies"><span class="std std-ref">Using role dependencies</span></a> for more details.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">tasks</span></code> defined in the play.</p></li>
<li><p>Any handlers triggered by the roles or tasks.</p></li>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">post_tasks</span></code> defined in the play.</p></li>
<li><p>Any handlers triggered by post_tasks.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If using tags with tasks in a role, be sure to also tag your pre_tasks, post_tasks, and role dependencies and pass those along as well, especially if the pre/post tasks and role dependencies are used for monitoring outage window control or load balancing. See <a class="reference internal" href="playbooks_tags.html#tags"><span class="std std-ref">Tags</span></a> for details on adding and using tags.</p>
</div>
<p>You can pass other keywords to the <code class="docutils literal notranslate"><span class="pre">roles</span></code> option:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">common</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">dir</span><span class="p">:</span> <span class="s">&#39;/opt/a&#39;</span>
        <span class="nt">app_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5000</span>
      <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">typeA</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">dir</span><span class="p">:</span> <span class="s">&#39;/opt/b&#39;</span>
        <span class="nt">app_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5001</span>
      <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">typeB</span>
</pre></div>
</div>
<p>When you add a tag to the <code class="docutils literal notranslate"><span class="pre">role</span></code> option, Ansible applies the tag to ALL tasks within the role.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">vars:</span></code> within the <code class="docutils literal notranslate"><span class="pre">roles:</span></code> section of a playbook, the variables are added to the play variables, making them available to all tasks within the play before and after the role. This behavior can be changed by <a class="reference internal" href="../reference_appendices/config.html#default-private-role-vars"><span class="std std-ref">DEFAULT_PRIVATE_ROLE_VARS</span></a>.</p>
</div>
<div class="section" id="including-roles-dynamic-reuse">
<h3><a class="toc-backref" href="#id6">Including roles: dynamic reuse</a><a class="headerlink" href="#including-roles-dynamic-reuse" title="Permalink to this headline">¶</a></h3>
<p>You can reuse roles dynamically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">include_role</span></code>. While roles added in a <code class="docutils literal notranslate"><span class="pre">roles</span></code> section run before any other tasks in a playbook, included roles run in the order they are defined. If there are other tasks before an <code class="docutils literal notranslate"><span class="pre">include_role</span></code> task, the other tasks will run first.</p>
<p>To include a role:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Print a message</span>
      <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">runs</span><span class="nv"> </span><span class="s">before</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">role&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include the example role</span>
      <span class="nt">include_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Print a message</span>
      <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;this</span><span class="nv"> </span><span class="s">task</span><span class="nv"> </span><span class="s">runs</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">role&quot;</span>
</pre></div>
</div>
<p>You can pass other keywords, including variables and tags, when including roles:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include the foo_app_instance role</span>
      <span class="nt">include_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">dir</span><span class="p">:</span> <span class="s">&#39;/opt/a&#39;</span>
        <span class="nt">app_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5000</span>
      <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">typeA</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>When you add a <a class="reference internal" href="playbooks_tags.html#tags"><span class="std std-ref">tag</span></a> to an <code class="docutils literal notranslate"><span class="pre">include_role</span></code> task, Ansible applies the tag <cite>only</cite> to the include itself. This means you can pass <code class="docutils literal notranslate"><span class="pre">--tags</span></code> to run only selected tasks from the role, if those tasks themselves have the same tag as the include statement. See <a class="reference internal" href="playbooks_tags.html#selective-reuse"><span class="std std-ref">Selectively running tagged tasks in re-usable files</span></a> for details.</p>
<p>You can conditionally include a role:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include the some_role role</span>
      <span class="nt">include_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_role</span>
      <span class="nt">when</span><span class="p">:</span> <span class="s">&quot;ansible_facts[&#39;os_family&#39;]</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;RedHat&#39;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="importing-roles-static-reuse">
<h3><a class="toc-backref" href="#id7">Importing roles: static reuse</a><a class="headerlink" href="#importing-roles-static-reuse" title="Permalink to this headline">¶</a></h3>
<p>You can reuse roles statically anywhere in the <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section of a play using <code class="docutils literal notranslate"><span class="pre">import_role</span></code>. The behavior is the same as using the <code class="docutils literal notranslate"><span class="pre">roles</span></code> keyword. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Print a message</span>
      <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;before</span><span class="nv"> </span><span class="s">we</span><span class="nv"> </span><span class="s">run</span><span class="nv"> </span><span class="s">our</span><span class="nv"> </span><span class="s">role&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Import the example role</span>
      <span class="nt">import_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Print a message</span>
      <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;after</span><span class="nv"> </span><span class="s">we</span><span class="nv"> </span><span class="s">ran</span><span class="nv"> </span><span class="s">our</span><span class="nv"> </span><span class="s">role&quot;</span>
</pre></div>
</div>
<p>You can pass other keywords, including variables and tags, when importing roles:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Import the foo_app_instance role</span>
      <span class="nt">import_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo_app_instance</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">dir</span><span class="p">:</span> <span class="s">&#39;/opt/a&#39;</span>
        <span class="nt">app_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5000</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>When you add a tag to an <code class="docutils literal notranslate"><span class="pre">import_role</span></code> statement, Ansible applies the tag to <cite>all</cite> tasks within the role. See <a class="reference internal" href="playbooks_tags.html#tag-inheritance"><span class="std std-ref">Tag inheritance: adding tags to multiple tasks</span></a> for details.</p>
</div>
</div>
<div class="section" id="running-a-role-multiple-times-in-one-playbook">
<span id="run-role-twice"></span><h2><a class="toc-backref" href="#id8">Running a role multiple times in one playbook</a><a class="headerlink" href="#running-a-role-multiple-times-in-one-playbook" title="Permalink to this headline">¶</a></h2>
<p>Ansible only executes each role once, even if you define it multiple times, unless the parameters defined on the role are different for each definition. For example, Ansible only runs the role <code class="docutils literal notranslate"><span class="pre">foo</span></code> once in a play like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
</pre></div>
</div>
<p>You have two options to force Ansible to run a role more than once.</p>
<div class="section" id="passing-different-parameters">
<h3><a class="toc-backref" href="#id9">Passing different parameters</a><a class="headerlink" href="#passing-different-parameters" title="Permalink to this headline">¶</a></h3>
<p>You can pass different parameters in each role definition as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt"> role</span><span class="p">:</span> <span class="nv">foo</span><span class="p p-Indicator">,</span><span class="nt"> vars</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> message</span><span class="p">:</span> <span class="s">&quot;first&quot;</span> <span class="p p-Indicator">}</span> <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt"> role</span><span class="p">:</span> <span class="nv">foo</span><span class="p p-Indicator">,</span><span class="nt"> vars</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> message</span><span class="p">:</span> <span class="s">&quot;second&quot;</span> <span class="p p-Indicator">}</span> <span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">message</span><span class="p">:</span> <span class="s">&quot;first&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">message</span><span class="p">:</span> <span class="s">&quot;second&quot;</span>
</pre></div>
</div>
<p>In this example, because each role definition has different parameters, Ansible runs <code class="docutils literal notranslate"><span class="pre">foo</span></code> twice.</p>
</div>
<div class="section" id="using-allow-duplicates-true">
<h3><a class="toc-backref" href="#id10">Using <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code></a><a class="headerlink" href="#using-allow-duplicates-true" title="Permalink to this headline">¶</a></h3>
<p>Add <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> to the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> file for the role:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>

<span class="c1"># roles/foo/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">allow_duplicates</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>In this example, Ansible runs <code class="docutils literal notranslate"><span class="pre">foo</span></code> twice because we have explicitly enabled it to do so.</p>
</div>
</div>
<div class="section" id="using-role-dependencies">
<span id="role-dependencies"></span><h2><a class="toc-backref" href="#id11">Using role dependencies</a><a class="headerlink" href="#using-role-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Role dependencies let you automatically pull in other roles when using a role. Ansible does not execute role dependencies when you include or import a role. You must use the <code class="docutils literal notranslate"><span class="pre">roles</span></code> keyword if you want Ansible to execute role dependencies.</p>
<p>Role dependencies are stored in the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> file within the role directory. This file should contain a list of roles and parameters to insert before the specified role. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># roles/myapp/meta/main.yml</span>
<span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">common</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">some_parameter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apache</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">apache_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">dbname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blarg</span>
      <span class="nt">other_parameter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
</pre></div>
</div>
<p>Ansible always executes role dependencies before the role that includes them. Ansible executes recursive role dependencies as well. If one role depends on a second role, and the second role depends on a third role, Ansible executes the third role, then the second role, then the first role.</p>
<div class="section" id="running-role-dependencies-multiple-times-in-one-playbook">
<h3><a class="toc-backref" href="#id12">Running role dependencies multiple times in one playbook</a><a class="headerlink" href="#running-role-dependencies-multiple-times-in-one-playbook" title="Permalink to this headline">¶</a></h3>
<p>Ansible treats duplicate role dependencies like duplicate roles listed under <code class="docutils literal notranslate"><span class="pre">roles:</span></code>: Ansible only executes role dependencies once, even if defined multiple times, unless the parameters, tags, or when clause defined on the role are different for each definition. If two roles in a playbook both list a third role as a dependency, Ansible only runs that role dependency once, unless you pass different parameters, tags, when clause, or use <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> in the dependent (third) role. See <a class="reference internal" href="../galaxy/user_guide.html#galaxy-dependencies"><span class="std std-ref">Galaxy role dependencies</span></a> for more details.</p>
<p>For example, a role named <code class="docutils literal notranslate"><span class="pre">car</span></code> depends on a role named <code class="docutils literal notranslate"><span class="pre">wheel</span></code> as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">n</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">n</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">n</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">n</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
</pre></div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">wheel</span></code> role depends on two roles: <code class="docutils literal notranslate"><span class="pre">tire</span></code> and <code class="docutils literal notranslate"><span class="pre">brake</span></code>. The <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> for wheel would then contain the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">dependencies</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tire</span>
  <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">brake</span>
</pre></div>
</div>
<p>And the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> for <code class="docutils literal notranslate"><span class="pre">tire</span></code> and <code class="docutils literal notranslate"><span class="pre">brake</span></code> would contain the following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">allow_duplicates</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>The resulting order of execution would be as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>tire(n=1)
brake(n=1)
wheel(n=1)
tire(n=2)
brake(n=2)
wheel(n=2)
...
car
</pre></div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> with role dependencies, you must specify it for the dependent role, not for the parent role. In the example above, <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code> appears in the <code class="docutils literal notranslate"><span class="pre">meta/main.yml</span></code> of the <code class="docutils literal notranslate"><span class="pre">tire</span></code> and <code class="docutils literal notranslate"><span class="pre">brake</span></code> roles. The <code class="docutils literal notranslate"><span class="pre">wheel</span></code> role does not require <code class="docutils literal notranslate"><span class="pre">allow_duplicates:</span> <span class="pre">true</span></code>, because each instance defined by <code class="docutils literal notranslate"><span class="pre">car</span></code> uses different parameter values.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a> for details on how Ansible chooses among variable values defined in different places (variable inheritance and scope).</p>
</div>
</div>
</div>
<div class="section" id="embedding-modules-and-plugins-in-roles">
<span id="id1"></span><h2><a class="toc-backref" href="#id13">Embedding modules and plugins in roles</a><a class="headerlink" href="#embedding-modules-and-plugins-in-roles" title="Permalink to this headline">¶</a></h2>
<p>If you write a custom module (see <a class="reference internal" href="../dev_guide/developing_modules.html#developing-modules"><span class="std std-ref">Should you develop a module?</span></a>) or a plugin (see <a class="reference internal" href="../dev_guide/developing_plugins.html#developing-plugins"><span class="std std-ref">Developing plugins</span></a>), you might wish to distribute it as part of a role. For example, if you write a module that helps configure your company’s internal software, and you want other people in your organization to use this module, but you do not want to tell everyone how to configure their Ansible library path, you can include the module in your internal_config role.</p>
<p>To add a module or a plugin to a role:
Alongside the ‘tasks’ and ‘handlers’ structure of a role, add a directory named ‘library’ and then include the module directly inside the ‘library’ directory.</p>
<p>Assuming you had this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>roles/
    my_custom_modules/
        library/
            module1
            module2
</pre></div>
</div>
<p>The module will be usable in the role itself, as well as any roles that are called <em>after</em> this role, as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">my_custom_modules</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">some_other_role_using_my_custom_modules</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yet_another_role_using_my_custom_modules</span>
</pre></div>
</div>
<p>If necessary, you can also embed a module in a role to modify a module in Ansible’s core distribution. For example, you can use the development version of a particular module before it is released in production releases by copying the module and embedding the copy in a role. Use this approach with caution, as API signatures may change in core components, and this workaround is not guaranteed to work.</p>
<p>The same mechanism can be used to embed and distribute plugins in a role, using the same schema. For example, for a filter plugin:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>roles/
    my_custom_filter/
        filter_plugins
            filter1
            filter2
</pre></div>
</div>
<p>These filters can then be used in a Jinja template in any role called after ‘my_custom_filter’.</p>
</div>
<div class="section" id="sharing-roles-ansible-galaxy">
<h2><a class="toc-backref" href="#id14">Sharing roles: Ansible Galaxy</a><a class="headerlink" href="#sharing-roles-ansible-galaxy" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://galaxy.ansible.com">Ansible Galaxy</a> is a free site for finding, downloading, rating, and reviewing all kinds of community-developed Ansible roles and can be a great way to get a jumpstart on your automation projects.</p>
<p>The client <code class="docutils literal notranslate"><span class="pre">ansible-galaxy</span></code> is included in Ansible. The Galaxy client allows you to download roles from Ansible Galaxy, and also provides an excellent default framework for creating your own roles.</p>
<p>Read the <a class="reference external" href="https://galaxy.ansible.com/docs/">Ansible Galaxy documentation</a> page for more information</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="../galaxy/user_guide.html#ansible-galaxy"><span class="std std-ref">Galaxy User Guide</span></a></dt><dd><p>How to create new roles, share roles on Galaxy, role management</p>
</dd>
<dt><a class="reference internal" href="../reference_appendices/YAMLSyntax.html#yaml-syntax"><span class="std std-ref">YAML Syntax</span></a></dt><dd><p>Learn about YAML syntax</p>
</dd>
<dt><a class="reference internal" href="playbooks.html#working-with-playbooks"><span class="std std-ref">Working with playbooks</span></a></dt><dd><p>Review the basic Playbook language features</p>
</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html#playbooks-best-practices"><span class="std std-ref">Tips and tricks</span></a></dt><dd><p>Tips and tricks for playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a></dt><dd><p>Variables in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html#playbooks-conditionals"><span class="std std-ref">Conditionals</span></a></dt><dd><p>Conditionals in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_loops.html#playbooks-loops"><span class="std std-ref">Loops</span></a></dt><dd><p>Loops in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_tags.html#tags"><span class="std std-ref">Tags</span></a></dt><dd><p>Using tags to select or skip roles/tasks in long playbooks</p>
</dd>
<dt><a class="reference internal" href="../collections/index.html#list-of-collections"><span class="std std-ref">Collection Index</span></a></dt><dd><p>Browse existing collections, modules, and plugins</p>
</dd>
<dt><a class="reference internal" href="../dev_guide/developing_modules.html#developing-modules"><span class="std std-ref">Should you develop a module?</span></a></dt><dd><p>Extending Ansible by writing your own modules</p>
</dd>
<dt><a class="reference external" href="https://github.com/ansible/ansible-examples">GitHub Ansible examples</a></dt><dd><p>Complete playbook files from the GitHub project source</p>
</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-project">Mailing List</a></dt><dd><p>Questions? Help? Ideas?  Stop by the list on Google Groups</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="playbooks_reuse_includes.html" class="btn btn-neutral float-right" title="Including and importing"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="playbooks_reuse.html" class="btn btn-neutral" title="Re-using Ansible artifacts"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on Dec 02, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>