<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using filters to manipulate data &mdash; Ansible Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/ansible.css" type="text/css" />
      <link rel="stylesheet" href="../_static/antsibull-minimal.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/rtd-ethical-ads.css" type="text/css" />
    <link rel="shortcut icon" href="_static/images/Ansible-Mark-RGB_Black.svg"/>
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tests" href="playbooks_tests.html" />
    <link rel="prev" title="Templating (Jinja2)" href="playbooks_templating.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->
<script src="https://www.redhat.com/dtm.js"></script>


<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="6">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->



<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','https://s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
    <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
    <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
    <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/Ansible-Mark-RGB_White.svg"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Documentation</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ansible
          </a>
              <div class="version">
                6
              </div><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <script>
        function switchVersionTo(slug) {
          var current_url_path = window.location.pathname;
          var url_version = current_url_path.search("/6/") > -1
            ? "/6/"
            : "/latest/";
          var new_version_url = current_url_path.replace(url_version, "/" + slug + "/");
          window.location.replace(new_version_url);
        }
      </script>
      <select
          class="version-list"
          id="version-list"
          onchange="switchVersionTo(this.value);"
      >
        
        <option
            value="latest"
            
        >
            latest
        </option>
        
        <option
            value="2.9"
            
        >
            2.9
        </option>
        
        <option
            value="devel"
            
        >
            devel
        </option>
        
      </select>
    </div>
  
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Ansible getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting started with Ansible</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tasks-plays-and-playbooks">Writing tasks, plays, and playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-inventory">Working with inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interacting-with-data">Interacting with data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#executing-playbooks">Executing playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-features-and-reference">Advanced features and reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#table-of-contents">Table of contents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic_concepts.html">Ansible concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_adhoc.html">Introduction to ad hoc commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheatsheet.html">Ansible CLI cheatsheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_intro.html">Intro to playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks.html">Working with playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_best_practices.html">Tips and tricks</a></li>
<li class="toctree-l3"><a class="reference internal" href="become.html">Understanding privilege escalation: become</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_delegation.html">Controlling where tasks run: delegation and local actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tests.html">Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_handlers.html">Handlers: running operations on change</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_error_handling.html">Error handling in playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html">Setting the remote environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html#working-with-language-specific-version-managers">Working with language-specific version managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse.html">Re-using Ansible artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse_roles.html">Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse_includes.html">Including and importing</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tags.html">Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_inventory.html">How to build your inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_dynamic_inventory.html">Working with dynamic inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_patterns.html">Patterns: targeting hosts and groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="connection_details.html">Connection methods and details</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_tools.html">Working with command line tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_variables.html">Using Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_vars_facts.html">Discovering variables: facts and magic variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="vault.html">Encrypting content with Ansible Vault</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using filters to manipulate data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#handling-undefined-variables">Handling undefined variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-different-values-for-true-false-null-ternary">Defining different values for true/false/null (ternary)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#managing-data-types">Managing data types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#formatting-data-yaml-and-json">Formatting data: YAML and JSON</a></li>
<li class="toctree-l4"><a class="reference internal" href="#combining-and-selecting-data">Combining and selecting data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#randomizing-data">Randomizing data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#managing-list-variables">Managing list variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#selecting-from-sets-or-lists-set-theory">Selecting from sets or lists (set theory)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#calculating-numbers-math">Calculating numbers (math)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#managing-network-interactions">Managing network interactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hashing-and-encrypting-strings-and-passwords">Hashing and encrypting strings and passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manipulating-text">Manipulating text</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manipulating-strings">Manipulating strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#managing-uuids">Managing UUIDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-dates-and-times">Handling dates and times</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-kubernetes-resource-names">Getting Kubernetes resource names</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_prompts.html">Interactive input: prompts</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_module_defaults.html">Module defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_checkmode.html">Validating tasks: check mode and diff mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_startnstep.html">Executing playbooks for troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_debugger.html">Debugging tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_strategies.html">Controlling playbook execution: strategies and more</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_async.html">Asynchronous actions and polling</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="complex_data_manipulation.html">Data manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_filtering_config.html">Rejecting modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample_setup.html">Sample Ansible setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html">Working With Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/plugins.html">Working with plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_bsd.html">Ansible and BSD</a></li>
<li class="toctree-l3"><a class="reference internal" href="windows.html">Windows Guides</a></li>
<li class="toctree-l3"><a class="reference internal" href="collections_using.html">Using collections</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions_collections.html">Ansible Collections Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions.html">ansible-core Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/advanced_index.html">Advanced Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/style_guide/index.html">Ansible documentation style guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Legacy Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html">Collection Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections/all_plugins.html">Indexes of all modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Releases and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Automation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_roadmap_index.html">Ansible Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_core_roadmap_index.html">ansible-core Roadmaps</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">User Guide</a> &raquo;</li>
          <li><a href="playbooks.html">Working with playbooks</a> &raquo;</li>
          <li><a href="playbooks_templating.html">Templating (Jinja2)</a> &raquo;</li>
      <li>Using filters to manipulate data</li>
  <li class="wy-breadcrumbs-aside">
          <!-- Ansible-specific additions for modules etc -->
            
              <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/user_guide/playbooks_filters.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
            
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script>
    function startsWith(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    function startsWithOneOf(str, needles) {
      return needles.some(function (needle) {
        return startsWith(str, needle);
      });
    }
    var banner = '';
      var extra_banner = '';
    /*use extra_banner for when marketing wants something extra, like a survey or AnsibleFest notice
    var extra_banner =
      '<div id="latest_extra_banner_id" class="admonition important">' +
      '<br>' +
      '<p>' +
        'You\'re invited to AnsibleFest 2021! ' +
      '<p>' +
        'Explore ways to automate, innovate, and accelerate with our free virtual event September 29-30. ' +
      '<pr>' +
        '<a href="https://reg.ansiblefest.redhat.com/flow/redhat/ansible21/regGenAttendee/login?sc_cid=7013a000002pemAAAQ">Register now!</a> ' +
      '</p>' +
      '<br>' +
      '</div>'; */
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">' +
                     '<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>' +
                     '</div>');
    }
    
      // Create a banner
      current_url_path = window.location.pathname;

      var important = false;
      var msg = '<p>';
      if (startsWith(current_url_path, "/ansible-core/")) {
        msg += 'You are reading documentation for Ansible Core, which contains no plugins except for those in ansible.builtin. For documentation of the Ansible package, go to <a href="/ansible/latest">the latest documentation</a>.';
      } else if (startsWithOneOf(current_url_path, ["/ansible/latest/", "/ansible/6/"])) {
        /* temp extra banner to advertise AnsibeFest2021 */
        banner += extra_banner;

        msg += 'You are reading the <b>latest</b> (stable) community version of the Ansible documentation. Red Hat subscribers, select <b>2.9</b> in the version selection to the left for the most recent Red Hat release.';
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        msg += 'You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this version, or select <b>latest</b> from the version selector to the left for the most recent community version.';
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        /* temp extra banner to advertise AnsibleFest2021 */
        banner += extra_banner;

        /* temp banner to advertise survey
        important = true;
        msg += 'Please take our <a href="https://www.surveymonkey.co.uk/r/B9V3CDY">Docs survey</a> before December 31 to help us improve Ansible documentation.';
        */

        msg += 'You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      } else {
        msg += 'You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      }
      msg += '</p>';

      banner += '<div id="banner_id" class="admonition ';
      banner += important ? 'important' : 'caution';
      banner += '">';
      banner += important ? '<br>' : '';
      banner += msg;
      banner += important ? '<br>' : '';
      banner += '</div>';
      document.write(banner);
    
  </script>


  
           <div itemprop="articleBody">
             
  <section id="using-filters-to-manipulate-data">
<span id="playbooks-filters"></span><h1>Using filters to manipulate data<a class="headerlink" href="#using-filters-to-manipulate-data" title="Permalink to this headline"></a></h1>
<p>Filters let you transform JSON data into YAML data, split a URL to extract the hostname, get the SHA1 hash of a string, add or multiply integers, and much more. You can use the Ansible-specific filters documented here to manipulate your data, or use any of the standard filters shipped with Jinja2 - see the list of <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#builtin-filters" title="(in Jinja v3.1.x)"><span class="xref std std-ref">built-in filters</span></a> in the official Jinja2 template documentation. You can also use <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#python-methods" title="(in Jinja v3.1.x)"><span class="xref std std-ref">Python methods</span></a> to transform data. You can <a class="reference internal" href="../dev_guide/developing_plugins.html#developing-filter-plugins"><span class="std std-ref">create custom Ansible filters as plugins</span></a>, though we generally welcome new filters into the ansible-core repo so everyone can use them.</p>
<p>Because templating happens on the Ansible controller, <strong>not</strong> on the target host, filters execute on the controller and transform data locally.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#handling-undefined-variables" id="id2">Handling undefined variables</a></p>
<ul>
<li><p><a class="reference internal" href="#providing-default-values" id="id3">Providing default values</a></p></li>
<li><p><a class="reference internal" href="#making-variables-optional" id="id4">Making variables optional</a></p></li>
<li><p><a class="reference internal" href="#defining-mandatory-values" id="id5">Defining mandatory values</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#defining-different-values-for-true-false-null-ternary" id="id6">Defining different values for true/false/null (ternary)</a></p></li>
<li><p><a class="reference internal" href="#managing-data-types" id="id7">Managing data types</a></p>
<ul>
<li><p><a class="reference internal" href="#discovering-the-data-type" id="id8">Discovering the data type</a></p></li>
<li><p><a class="reference internal" href="#transforming-dictionaries-into-lists" id="id9">Transforming dictionaries into lists</a></p></li>
<li><p><a class="reference internal" href="#transforming-lists-into-dictionaries" id="id10">Transforming lists into dictionaries</a></p></li>
<li><p><a class="reference internal" href="#forcing-the-data-type" id="id11">Forcing the data type</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#formatting-data-yaml-and-json" id="id12">Formatting data: YAML and JSON</a></p>
<ul>
<li><p><a class="reference internal" href="#filter-to-json-and-unicode-support" id="id13">Filter <cite>to_json</cite> and Unicode support</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#combining-and-selecting-data" id="id14">Combining and selecting data</a></p>
<ul>
<li><p><a class="reference internal" href="#combining-items-from-multiple-lists-zip-and-zip-longest" id="id15">Combining items from multiple lists: zip and zip_longest</a></p></li>
<li><p><a class="reference internal" href="#combining-objects-and-subelements" id="id16">Combining objects and subelements</a></p></li>
<li><p><a class="reference internal" href="#combining-hashes-dictionaries" id="id17">Combining hashes/dictionaries</a></p></li>
<li><p><a class="reference internal" href="#selecting-values-from-arrays-or-hashtables" id="id18">Selecting values from arrays or hashtables</a></p></li>
<li><p><a class="reference internal" href="#combining-lists" id="id19">Combining lists</a></p>
<ul>
<li><p><a class="reference internal" href="#permutations" id="id20">permutations</a></p></li>
<li><p><a class="reference internal" href="#combinations" id="id21">combinations</a></p></li>
<li><p><a class="reference internal" href="#products" id="id22">products</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#selecting-json-data-json-queries" id="id23">Selecting JSON data: JSON queries</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#randomizing-data" id="id24">Randomizing data</a></p>
<ul>
<li><p><a class="reference internal" href="#random-mac-addresses" id="id25">Random MAC addresses</a></p></li>
<li><p><a class="reference internal" href="#random-items-or-numbers" id="id26">Random items or numbers</a></p></li>
<li><p><a class="reference internal" href="#shuffling-a-list" id="id27">Shuffling a list</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#managing-list-variables" id="id28">Managing list variables</a></p></li>
<li><p><a class="reference internal" href="#selecting-from-sets-or-lists-set-theory" id="id29">Selecting from sets or lists (set theory)</a></p></li>
<li><p><a class="reference internal" href="#calculating-numbers-math" id="id30">Calculating numbers (math)</a></p></li>
<li><p><a class="reference internal" href="#managing-network-interactions" id="id31">Managing network interactions</a></p>
<ul>
<li><p><a class="reference internal" href="#ip-address-filters" id="id32">IP address filters</a></p></li>
<li><p><a class="reference internal" href="#network-cli-filters" id="id33">Network CLI filters</a></p></li>
<li><p><a class="reference internal" href="#network-xml-filters" id="id34">Network XML filters</a></p></li>
<li><p><a class="reference internal" href="#network-vlan-filters" id="id35">Network VLAN filters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#hashing-and-encrypting-strings-and-passwords" id="id36">Hashing and encrypting strings and passwords</a></p></li>
<li><p><a class="reference internal" href="#manipulating-text" id="id37">Manipulating text</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-comments-to-files" id="id38">Adding comments to files</a></p></li>
<li><p><a class="reference internal" href="#urlencode-variables" id="id39">URLEncode Variables</a></p></li>
<li><p><a class="reference internal" href="#splitting-urls" id="id40">Splitting URLs</a></p></li>
<li><p><a class="reference internal" href="#searching-strings-with-regular-expressions" id="id41">Searching strings with regular expressions</a></p></li>
<li><p><a class="reference internal" href="#managing-file-names-and-path-names" id="id42">Managing file names and path names</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#manipulating-strings" id="id43">Manipulating strings</a></p></li>
<li><p><a class="reference internal" href="#managing-uuids" id="id44">Managing UUIDs</a></p></li>
<li><p><a class="reference internal" href="#handling-dates-and-times" id="id45">Handling dates and times</a></p></li>
<li><p><a class="reference internal" href="#getting-kubernetes-resource-names" id="id46">Getting Kubernetes resource names</a></p></li>
</ul>
</div>
<section id="handling-undefined-variables">
<h2><a class="toc-backref" href="#id2">Handling undefined variables</a><a class="headerlink" href="#handling-undefined-variables" title="Permalink to this headline"></a></h2>
<p>Filters can help you manage missing or undefined variables by providing defaults or making some variables optional. If you configure Ansible to ignore most undefined variables, you can mark some variables as requiring values with the <code class="docutils literal notranslate"><span class="pre">mandatory</span></code> filter.</p>
<section id="providing-default-values">
<span id="defaulting-undefined-variables"></span><h3><a class="toc-backref" href="#id3">Providing default values</a><a class="headerlink" href="#providing-default-values" title="Permalink to this headline"></a></h3>
<p>You can provide default values for variables directly in your templates using the Jinja2 ‘default’ filter. This is often a better approach than failing if a variable is not defined:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>In the above example, if the variable ‘some_variable’ is not defined, Ansible uses the default value 5, rather than raising an “undefined variable” error and failing. If you are working within a role, you can also add a <code class="docutils literal notranslate"><span class="pre">defaults/main.yml</span></code> to define the default values for variables in your role.</p>
<p>Beginning in version 2.8, attempting to access an attribute of an Undefined value in Jinja will return another Undefined value, rather than throwing an error immediately. This means that you can now simply use
a default with a value in a nested data structure (in other words, <code class="code docutils literal notranslate"><span class="pre">{{</span> <span class="pre">foo.bar.baz</span> <span class="pre">|</span> <span class="pre">default('DEFAULT')</span> <span class="pre">}}</span></code>) when you do not know if the intermediate values are defined.</p>
<p>If you want to use the default value when variables evaluate to false or an empty string you have to set the second parameter to <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">&#39;env&#39;</span><span class="o">,</span> <span class="s1">&#39;MY_USER&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="s1">&#39;admin&#39;</span><span class="o">,</span> <span class="kp">true</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="making-variables-optional">
<span id="omitting-undefined-variables"></span><h3><a class="toc-backref" href="#id4">Making variables optional</a><a class="headerlink" href="#making-variables-optional" title="Permalink to this headline"></a></h3>
<p>By default Ansible requires values for all variables in a templated expression. However, you can make specific variables optional. For example, you might want to use a system default for some items and control the value for others. To make a variable optional, set the default value to the special variable <code class="docutils literal notranslate"><span class="pre">omit</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Touch files with an optional mode</span>
  <span class="nt">ansible.builtin.file</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.path</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">touch</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.mode</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="nv">omit</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="nt">loop</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/foo</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bar</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/baz</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0444&quot;</span>
</pre></div>
</div>
<p>In this example, the default mode for the files <code class="docutils literal notranslate"><span class="pre">/tmp/foo</span></code> and <code class="docutils literal notranslate"><span class="pre">/tmp/bar</span></code> is determined by the umask of the system. Ansible does not send a value for <code class="docutils literal notranslate"><span class="pre">mode</span></code>. Only the third file, <code class="docutils literal notranslate"><span class="pre">/tmp/baz</span></code>, receives the <cite>mode=0444</cite> option.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are “chaining” additional filters after the <code class="docutils literal notranslate"><span class="pre">default(omit)</span></code> filter, you should instead do something like this:
<code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">foo</span> <span class="pre">|</span> <span class="pre">default(None)</span> <span class="pre">|</span> <span class="pre">some_filter</span> <span class="pre">or</span> <span class="pre">omit</span> <span class="pre">}}&quot;</span></code>. In this example, the default <code class="docutils literal notranslate"><span class="pre">None</span></code> (Python null) value will cause the later filters to fail, which will trigger the <code class="docutils literal notranslate"><span class="pre">or</span> <span class="pre">omit</span></code> portion of the logic. Using <code class="docutils literal notranslate"><span class="pre">omit</span></code> in this manner is very specific to the later filters you are chaining though, so be prepared for some trial and error if you do this.</p>
</div>
</section>
<section id="defining-mandatory-values">
<span id="forcing-variables-to-be-defined"></span><h3><a class="toc-backref" href="#id5">Defining mandatory values</a><a class="headerlink" href="#defining-mandatory-values" title="Permalink to this headline"></a></h3>
<p>If you configure Ansible to ignore undefined variables, you may want to define some values as mandatory. By default, Ansible fails if a variable in your playbook or command is undefined. You can configure Ansible to allow undefined variables by setting <a class="reference internal" href="../reference_appendices/config.html#default-undefined-var-behavior"><span class="std std-ref">DEFAULT_UNDEFINED_VAR_BEHAVIOR</span></a> to <code class="docutils literal notranslate"><span class="pre">false</span></code>. In that case, you may want to require some variables to be defined. You can do this with:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">variable</span> <span class="o">|</span> <span class="nf">mandatory</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The variable value will be used as is, but the template evaluation will raise an error if it is undefined.</p>
<p>A convenient way of requiring a variable to be overridden is to give it an undefined value using the <code class="docutils literal notranslate"><span class="pre">undef</span></code> keyword. This can be useful in a role’s defaults.</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">galaxy_url</span><span class="p">:</span> <span class="s">&quot;https://galaxy.ansible.com&quot;</span>
<span class="nt">galaxy_api_key</span><span class="p">:</span> <span class="cp">{{</span> <span class="nv">undef</span><span class="o">(</span><span class="nv">hint</span><span class="o">=</span><span class="s2">&quot;You must specify your Galaxy API key&quot;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
</section>
<section id="defining-different-values-for-true-false-null-ternary">
<h2><a class="toc-backref" href="#id6">Defining different values for true/false/null (ternary)</a><a class="headerlink" href="#defining-different-values-for-true-false-null-ternary" title="Permalink to this headline"></a></h2>
<p>You can create a test, then define one value to use when the test returns true and another when the test returns false (new in version 1.9):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">(</span><span class="nv">status</span> <span class="o">==</span> <span class="s1">&#39;needs_restart&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ternary</span><span class="o">(</span><span class="s1">&#39;restart&#39;</span><span class="o">,</span> <span class="s1">&#39;continue&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>In addition, you can define a one value to use on true, one value on false and a third value on null (new in version 2.8):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">enabled</span> <span class="o">|</span> <span class="nf">ternary</span><span class="o">(</span><span class="s1">&#39;no shutdown&#39;</span><span class="o">,</span> <span class="s1">&#39;shutdown&#39;</span><span class="o">,</span> <span class="nv">omit</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="managing-data-types">
<h2><a class="toc-backref" href="#id7">Managing data types</a><a class="headerlink" href="#managing-data-types" title="Permalink to this headline"></a></h2>
<p>You might need to know, change, or set the data type on a variable. For example, a registered variable might contain a dictionary when your next task needs a list, or a user <a class="reference internal" href="playbooks_prompts.html#playbooks-prompts"><span class="std std-ref">prompt</span></a> might return a string when your playbook needs a boolean value. Use the <code class="docutils literal notranslate"><span class="pre">type_debug</span></code>, <code class="docutils literal notranslate"><span class="pre">dict2items</span></code>, and <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filters to manage data types. You can also use the data type itself to cast a value as a specific data type.</p>
<section id="discovering-the-data-type">
<h3><a class="toc-backref" href="#id8">Discovering the data type</a><a class="headerlink" href="#discovering-the-data-type" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<p>If you are unsure of the underlying Python type of a variable, you can use the <code class="docutils literal notranslate"><span class="pre">type_debug</span></code> filter to display it. This is useful in debugging when you need a particular type of variable:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">type_debug</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>You should note that, while this may seem like a useful filter for checking that you have the right type of data in a variable, you should often prefer <a class="reference internal" href="playbooks_tests.html#type-tests"><span class="std std-ref">type tests</span></a>, which will allow you to test for specific data types.</p>
</section>
<section id="transforming-dictionaries-into-lists">
<span id="dict-filter"></span><h3><a class="toc-backref" href="#id9">Transforming dictionaries into lists</a><a class="headerlink" href="#transforming-dictionaries-into-lists" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.6.</span></p>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter to transform a dictionary into a list of items suitable for <a class="reference internal" href="playbooks_loops.html#playbooks-loops"><span class="std std-ref">looping</span></a>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">dict</span> <span class="o">|</span> <span class="nf">dict2items</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Dictionary data (before applying the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tags</span><span class="p">:</span>
  <span class="nt">Application</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">payment</span>
  <span class="nt">Environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
</pre></div>
</div>
<p>List data (after applying the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">payment</span>
<span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Environment</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.8.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter is the reverse of the <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filter.</p>
<p>If you want to configure the names of the keys, the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter accepts 2 keyword arguments. Pass the <code class="docutils literal notranslate"><span class="pre">key_name</span></code> and <code class="docutils literal notranslate"><span class="pre">value_name</span></code> arguments to configure the names of the keys in the list output:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">files</span> <span class="o">|</span> <span class="nf">dict2items</span><span class="o">(</span><span class="nv">key_name</span><span class="o">=</span><span class="s1">&#39;file&#39;</span><span class="o">,</span> <span class="nv">value_name</span><span class="o">=</span><span class="s1">&#39;path&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Dictionary data (before applying the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">files</span><span class="p">:</span>
  <span class="nt">users</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/passwd</span>
  <span class="nt">groups</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/group</span>
</pre></div>
</div>
<p>List data (after applying the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">users</span>
  <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/passwd</span>
<span class="p p-Indicator">-</span> <span class="nt">file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">groups</span>
  <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/group</span>
</pre></div>
</div>
</section>
<section id="transforming-lists-into-dictionaries">
<h3><a class="toc-backref" href="#id10">Transforming lists into dictionaries</a><a class="headerlink" href="#transforming-lists-into-dictionaries" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.7.</span></p>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filter to transform a list into a dictionary, mapping the content into <code class="docutils literal notranslate"><span class="pre">key:</span> <span class="pre">value</span></code> pairs:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">tags</span> <span class="o">|</span> <span class="nf">items2dict</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>List data (before applying the <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tags</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
    <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">payment</span>
  <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Environment</span>
    <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
</pre></div>
</div>
<p>Dictionary data (after applying the <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filter):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Application: payment
Environment: dev
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filter is the reverse of the <code class="docutils literal notranslate"><span class="pre">dict2items</span></code> filter.</p>
<p>Not all lists use <code class="docutils literal notranslate"><span class="pre">key</span></code> to designate keys and <code class="docutils literal notranslate"><span class="pre">value</span></code> to designate values. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">fruits</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">fruit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apple</span>
    <span class="nt">color</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">red</span>
  <span class="p p-Indicator">-</span> <span class="nt">fruit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pear</span>
    <span class="nt">color</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yellow</span>
  <span class="p p-Indicator">-</span> <span class="nt">fruit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grapefruit</span>
    <span class="nt">color</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yellow</span>
</pre></div>
</div>
<p>In this example, you must pass the <code class="docutils literal notranslate"><span class="pre">key_name</span></code> and <code class="docutils literal notranslate"><span class="pre">value_name</span></code> arguments to configure the transformation. For example:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">tags</span> <span class="o">|</span> <span class="nf">items2dict</span><span class="o">(</span><span class="nv">key_name</span><span class="o">=</span><span class="s1">&#39;fruit&#39;</span><span class="o">,</span> <span class="nv">value_name</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>If you do not pass these arguments, or do not pass the correct values for your list, you will see <code class="docutils literal notranslate"><span class="pre">KeyError:</span> <span class="pre">key</span></code> or <code class="docutils literal notranslate"><span class="pre">KeyError:</span> <span class="pre">my_typo</span></code>.</p>
</section>
<section id="forcing-the-data-type">
<h3><a class="toc-backref" href="#id11">Forcing the data type</a><a class="headerlink" href="#forcing-the-data-type" title="Permalink to this headline"></a></h3>
<p>You can cast values as certain types. For example, if you expect the input “True” from a <a class="reference internal" href="playbooks_prompts.html#playbooks-prompts"><span class="std std-ref">vars_prompt</span></a> and you want Ansible to recognize it as a boolean value instead of a string:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
     <span class="nt">msg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_string_value | bool</span>
</pre></div>
</div>
<p>If you want to perform a mathematical comparison on a fact and you want Ansible to recognize it as an integer instead of a string:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &quot;only on Red Hat 6, derivatives, and later&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;os_family&#39;] == &quot;RedHat&quot; and ansible_facts[&#39;lsb&#39;][&#39;major_release&#39;] | int &gt;= 6</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.</span></p>
</div>
</section>
</section>
<section id="formatting-data-yaml-and-json">
<span id="filters-for-formatting-data"></span><h2><a class="toc-backref" href="#id12">Formatting data: YAML and JSON</a><a class="headerlink" href="#formatting-data-yaml-and-json" title="Permalink to this headline"></a></h2>
<p>You can switch a data structure in a template from or to JSON or YAML format, with options for formatting, indenting, and loading data. The basic filters are occasionally useful for debugging:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_json</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_yaml</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>For human readable output, you can use:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_nice_json</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_nice_yaml</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>You can change the indentation of either format:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_nice_json</span><span class="o">(</span><span class="nv">indent</span><span class="o">=</span><span class="m">2</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_nice_yaml</span><span class="o">(</span><span class="nv">indent</span><span class="o">=</span><span class="m">8</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">to_yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">to_nice_yaml</span></code> filters use the <a class="reference external" href="https://pyyaml.org/">PyYAML library</a> which has a default 80 symbol string length limit. That causes unexpected line break after 80th symbol (if there is a space after 80th symbol)
To avoid such behavior and generate long lines, use the <code class="docutils literal notranslate"><span class="pre">width</span></code> option. You must use a hardcoded number to define the width, instead of a construction like <code class="docutils literal notranslate"><span class="pre">float(&quot;inf&quot;)</span></code>, because the filter does not support proxying Python functions. For example:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_yaml</span><span class="o">(</span><span class="nv">indent</span><span class="o">=</span><span class="m">8</span><span class="o">,</span> <span class="nv">width</span><span class="o">=</span><span class="m">1337</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">to_nice_yaml</span><span class="o">(</span><span class="nv">indent</span><span class="o">=</span><span class="m">8</span><span class="o">,</span> <span class="nv">width</span><span class="o">=</span><span class="m">1337</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The filter does support passing through other YAML parameters. For a full list, see the <a class="reference external" href="https://pyyaml.org/wiki/PyYAMLDocumentation">PyYAML documentation</a> for <code class="docutils literal notranslate"><span class="pre">dump()</span></code>.</p>
<p>If you are reading in some already formatted data:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">from_json</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">some_variable</span> <span class="o">|</span> <span class="nf">from_yaml</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>for example:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Register JSON output as a variable</span>
    <span class="nt">ansible.builtin.shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat /some/path/to/file.json</span>
    <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set a variable</span>
    <span class="nt">ansible.builtin.set_fact</span><span class="p">:</span>
      <span class="nt">myvar</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">result.stdout</span> <span class="o">|</span> <span class="nf">from_json</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<section id="filter-to-json-and-unicode-support">
<h3><a class="toc-backref" href="#id13">Filter <cite>to_json</cite> and Unicode support</a><a class="headerlink" href="#filter-to-json-and-unicode-support" title="Permalink to this headline"></a></h3>
<p>By default <cite>to_json</cite> and <cite>to_nice_json</cite> will convert data received to ASCII, so:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;München&#39;</span><span class="o">|</span> <span class="nf">to_json</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>will return:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&#39;M\u00fcnchen&#39;
</pre></div>
</div>
<p>To keep Unicode characters, pass the parameter <cite>ensure_ascii=False</cite> to the filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;München&#39;</span><span class="o">|</span> <span class="nf">to_json</span><span class="o">(</span><span class="nv">ensure_ascii</span><span class="o">=</span><span class="kp">False</span><span class="o">)</span> <span class="cp">}}</span>

<span class="s">&#39;München&#39;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.7.</span></p>
</div>
<p>To parse multi-document YAML strings, the <code class="docutils literal notranslate"><span class="pre">from_yaml_all</span></code> filter is provided.
The <code class="docutils literal notranslate"><span class="pre">from_yaml_all</span></code> filter will return a generator of parsed YAML documents.</p>
<p>for example:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Register a file content as a variable</span>
    <span class="nt">ansible.builtin.shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat /some/path/to/multidoc-file.yaml</span>
    <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Print the transformed variable</span>
    <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
      <span class="nt">msg</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">loop</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">result.stdout</span> <span class="o">|</span> <span class="nf">from_yaml_all</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="combining-and-selecting-data">
<h2><a class="toc-backref" href="#id14">Combining and selecting data</a><a class="headerlink" href="#combining-and-selecting-data" title="Permalink to this headline"></a></h2>
<p>You can combine data from multiple sources and types, and select values from large data structures, giving you precise control over complex data.</p>
<section id="combining-items-from-multiple-lists-zip-and-zip-longest">
<span id="zip-filter"></span><h3><a class="toc-backref" href="#id15">Combining items from multiple lists: zip and zip_longest</a><a class="headerlink" href="#combining-items-from-multiple-lists-zip-and-zip-longest" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.3.</span></p>
</div>
<p>To get a list combining the elements of other lists use <code class="docutils literal notranslate"><span class="pre">zip</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Give me list combo of two lists</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">,</span><span class="m">4</span><span class="o">,</span><span class="m">5</span><span class="o">,</span><span class="m">6</span><span class="o">]</span> <span class="o">|</span> <span class="nf">zip</span><span class="o">([</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">,</span><span class="s1">&#39;d&#39;</span><span class="o">,</span><span class="s1">&#39;e&#39;</span><span class="o">,</span><span class="s1">&#39;f&#39;</span><span class="o">])</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="c1"># =&gt; [[1, &quot;a&quot;], [2, &quot;b&quot;], [3, &quot;c&quot;], [4, &quot;d&quot;], [5, &quot;e&quot;], [6, &quot;f&quot;]]</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Give me shortest combo of two lists</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">]</span> <span class="o">|</span> <span class="nf">zip</span><span class="o">([</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">,</span><span class="s1">&#39;d&#39;</span><span class="o">,</span><span class="s1">&#39;e&#39;</span><span class="o">,</span><span class="s1">&#39;f&#39;</span><span class="o">])</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="c1"># =&gt; [[1, &quot;a&quot;], [2, &quot;b&quot;], [3, &quot;c&quot;]]</span>
</pre></div>
</div>
<p>To always exhaust all lists use <code class="docutils literal notranslate"><span class="pre">zip_longest</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Give me longest combo of three lists , fill with X</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">]</span> <span class="o">|</span> <span class="nf">zip_longest</span><span class="o">([</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">,</span><span class="s1">&#39;d&#39;</span><span class="o">,</span><span class="s1">&#39;e&#39;</span><span class="o">,</span><span class="s1">&#39;f&#39;</span><span class="o">],</span> <span class="o">[</span><span class="m">21</span><span class="o">,</span> <span class="m">22</span><span class="o">,</span> <span class="m">23</span><span class="o">],</span> <span class="nv">fillvalue</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="c1"># =&gt; [[1, &quot;a&quot;, 21], [2, &quot;b&quot;, 22], [3, &quot;c&quot;, 23], [&quot;X&quot;, &quot;d&quot;, &quot;X&quot;], [&quot;X&quot;, &quot;e&quot;, &quot;X&quot;], [&quot;X&quot;, &quot;f&quot;, &quot;X&quot;]]</span>
</pre></div>
</div>
<p>Similarly to the output of the <code class="docutils literal notranslate"><span class="pre">items2dict</span></code> filter mentioned above, these filters can be used to construct a <code class="docutils literal notranslate"><span class="pre">dict</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">dict</span><span class="o">(</span><span class="nv">keys_list</span> <span class="o">|</span> <span class="nf">zip</span><span class="o">(</span><span class="nv">values_list</span><span class="o">))</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>List data (before applying the <code class="docutils literal notranslate"><span class="pre">zip</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">keys_list</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">one</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">two</span>
<span class="nt">values_list</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apple</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">orange</span>
</pre></div>
</div>
<p>Dictionary data (after applying the <code class="docutils literal notranslate"><span class="pre">zip</span></code> filter):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">one</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apple</span>
<span class="nt">two</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">orange</span>
</pre></div>
</div>
</section>
<section id="combining-objects-and-subelements">
<h3><a class="toc-backref" href="#id16">Combining objects and subelements</a><a class="headerlink" href="#combining-objects-and-subelements" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.7.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">subelements</span></code> filter produces a product of an object and the subelement values of that object, similar to the <code class="docutils literal notranslate"><span class="pre">subelements</span></code> lookup. This lets you specify individual subelements to use in a template. For example, this expression:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">users</span> <span class="o">|</span> <span class="nf">subelements</span><span class="o">(</span><span class="s1">&#39;groups&#39;</span><span class="o">,</span> <span class="nv">skip_missing</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Data before applying the <code class="docutils literal notranslate"><span class="pre">subelements</span></code> filter:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">users</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
  <span class="nt">authorized</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
  <span class="nt">groups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
  <span class="nt">authorized</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bob/id_rsa.pub</span>
  <span class="nt">groups</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
</pre></div>
</div>
<p>Data after applying the <code class="docutils literal notranslate"><span class="pre">subelements</span></code> filter:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
    <span class="nt">groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
    <span class="nt">authorized</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="p p-Indicator">-</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
    <span class="nt">groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
    <span class="nt">authorized</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
<span class="p p-Indicator">-</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
    <span class="nt">authorized</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bob/id_rsa.pub</span>
    <span class="nt">groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
</pre></div>
</div>
<p>You can use the transformed data with <code class="docutils literal notranslate"><span class="pre">loop</span></code> to iterate over the same subelement for multiple objects:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set authorized ssh key, extracting just that data from &#39;users&#39;</span>
  <span class="nt">ansible.posix.authorized_key</span><span class="p">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">item.0.name</span> <span class="cp">}}</span><span class="s">&quot;</span>
    <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">&#39;file&#39;</span><span class="o">,</span> <span class="nv">item.1</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">users</span> <span class="o">|</span> <span class="nf">subelements</span><span class="o">(</span><span class="s1">&#39;authorized&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</section>
<section id="combining-hashes-dictionaries">
<span id="combine-filter"></span><h3><a class="toc-backref" href="#id17">Combining hashes/dictionaries</a><a class="headerlink" href="#combining-hashes-dictionaries" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">combine</span></code> filter allows hashes to be merged. For example, the following would override keys in one hash:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">{</span><span class="s1">&#39;a&#39;</span><span class="o">:</span><span class="m">1</span><span class="o">,</span> <span class="s1">&#39;b&#39;</span><span class="o">:</span><span class="m">2</span><span class="o">}</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">({</span><span class="s1">&#39;b&#39;</span><span class="o">:</span><span class="m">3</span><span class="o">})</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The resulting hash would be:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&#39;a&#39;:1, &#39;b&#39;:3}
</pre></div>
</div>
<p>The filter can also take multiple arguments to merge:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">a</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">b</span><span class="o">,</span> <span class="nv">c</span><span class="o">,</span> <span class="nv">d</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="o">[</span><span class="nv">a</span><span class="o">,</span> <span class="nv">b</span><span class="o">,</span> <span class="nv">c</span><span class="o">,</span> <span class="nv">d</span><span class="o">]</span> <span class="o">|</span> <span class="nf">combine</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>In this case, keys in <code class="docutils literal notranslate"><span class="pre">d</span></code> would override those in <code class="docutils literal notranslate"><span class="pre">c</span></code>, which would override those in <code class="docutils literal notranslate"><span class="pre">b</span></code>, and so on.</p>
<p>The filter also accepts two optional parameters: <code class="docutils literal notranslate"><span class="pre">recursive</span></code> and <code class="docutils literal notranslate"><span class="pre">list_merge</span></code>.</p>
<dl class="simple">
<dt>recursive</dt><dd><p>Is a boolean, default to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
Should the <code class="docutils literal notranslate"><span class="pre">combine</span></code> recursively merge nested hashes.
Note: It does <strong>not</strong> depend on the value of the <code class="docutils literal notranslate"><span class="pre">hash_behaviour</span></code> setting in <code class="docutils literal notranslate"><span class="pre">ansible.cfg</span></code>.</p>
</dd>
<dt>list_merge</dt><dd><p>Is a string, its possible values are <code class="docutils literal notranslate"><span class="pre">replace</span></code> (default), <code class="docutils literal notranslate"><span class="pre">keep</span></code>, <code class="docutils literal notranslate"><span class="pre">append</span></code>, <code class="docutils literal notranslate"><span class="pre">prepend</span></code>, <code class="docutils literal notranslate"><span class="pre">append_rp</span></code> or <code class="docutils literal notranslate"><span class="pre">prepend_rp</span></code>.
It modifies the behaviour of <code class="docutils literal notranslate"><span class="pre">combine</span></code> when the hashes to merge contain arrays/lists.</p>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">default</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
    <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">b</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">c</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">patch</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
    <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
  <span class="nt">b</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">recursive=False</span></code> (the default), nested hash aren’t merged:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
  <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
<span class="nt">b</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
<span class="nt">c</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">recursive=True</span></code>, recurse into nested hash and merge their keys:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="k">recursive</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
  <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
<span class="nt">b</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
<span class="nt">c</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">list_merge='replace'</span></code> (the default), arrays from the right hash will “replace” the ones in the left hash:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">default</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">patch</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
</pre></div>
</div>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">list_merge='keep'</span></code>, arrays from the left hash will be kept:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="nv">list_merge</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">list_merge='append'</span></code>, arrays from the right hash will be appended to the ones in the left hash:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="nv">list_merge</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">list_merge='prepend'</span></code>, arrays from the right hash will be prepended to the ones in the left hash:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="nv">list_merge</span><span class="o">=</span><span class="s1">&#39;prepend&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">list_merge='append_rp'</span></code>, arrays from the right hash will be appended to the ones in the left hash. Elements of arrays in the left hash that are also in the corresponding array of the right hash will be removed (“rp” stands for “remove present”). Duplicate elements that aren’t in both hashes are kept:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">default</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nt">patch</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="nv">list_merge</span><span class="o">=</span><span class="s1">&#39;append_rp&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">list_merge='prepend_rp'</span></code>, the behavior is similar to the one for <code class="docutils literal notranslate"><span class="pre">append_rp</span></code>, but elements of arrays in the right hash are prepended:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="nv">list_merge</span><span class="o">=</span><span class="s1">&#39;prepend_rp&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">recursive</span></code> and <code class="docutils literal notranslate"><span class="pre">list_merge</span></code> can be used together:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">default</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">a&#39;</span><span class="p p-Indicator">:</span>
      <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default_value</span>
      <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default_value</span>
      <span class="nt">list</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default_value</span>
  <span class="nt">b</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nt">patch</span><span class="p">:</span>
  <span class="nt">a</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">a&#39;</span><span class="p p-Indicator">:</span>
      <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch_value</span>
      <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch_value</span>
      <span class="nt">list</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch_value</span>
  <span class="nt">b</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
</pre></div>
</div>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">default</span> <span class="o">|</span> <span class="nf">combine</span><span class="o">(</span><span class="nv">patch</span><span class="o">,</span> <span class="k">recursive</span><span class="o">=</span><span class="kp">True</span><span class="o">,</span> <span class="nv">list_merge</span><span class="o">=</span><span class="s1">&#39;append_rp&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">a</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">a&#39;</span><span class="p p-Indicator">:</span>
    <span class="nt">x</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default_value</span>
    <span class="nt">y</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch_value</span>
    <span class="nt">z</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">patch_value</span>
    <span class="nt">list</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default_value</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">patch_value</span>
<span class="nt">b</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
  <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value</span>
</pre></div>
</div>
</section>
<section id="selecting-values-from-arrays-or-hashtables">
<span id="extract-filter"></span><h3><a class="toc-backref" href="#id18">Selecting values from arrays or hashtables</a><a class="headerlink" href="#selecting-values-from-arrays-or-hashtables" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.1.</span></p>
</div>
<p>The <cite>extract</cite> filter is used to map from a list of indices to a list of values from a container (hash or array):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="m">0</span><span class="o">,</span><span class="m">2</span><span class="o">]</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;extract&#39;</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;x&#39;</span><span class="o">,</span><span class="s1">&#39;y&#39;</span><span class="o">,</span><span class="s1">&#39;z&#39;</span><span class="o">])</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;x&#39;</span><span class="o">,</span><span class="s1">&#39;y&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;extract&#39;</span><span class="o">,</span> <span class="o">{</span><span class="s1">&#39;x&#39;</span><span class="o">:</span> <span class="m">42</span><span class="o">,</span> <span class="s1">&#39;y&#39;</span><span class="o">:</span> <span class="m">31</span><span class="o">})</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The results of the above expressions would be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;x&#39;, &#39;z&#39;]
[42, 31]
</pre></div>
</div>
<p>The filter can take another argument:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">groups</span><span class="o">[</span><span class="s1">&#39;x&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;extract&#39;</span><span class="o">,</span> <span class="nv">hostvars</span><span class="o">,</span> <span class="s1">&#39;ec2_ip_address&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This takes the list of hosts in group ‘x’, looks them up in <cite>hostvars</cite>, and then looks up the <cite>ec2_ip_address</cite> of the result. The final result is a list of IP addresses for the hosts in group ‘x’.</p>
<p>The third argument to the filter can also be a list, for a recursive lookup inside the container:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;extract&#39;</span><span class="o">,</span> <span class="nv">b</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;x&#39;</span><span class="o">,</span><span class="s1">&#39;y&#39;</span><span class="o">])</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This would return a list containing the value of <cite>b[‘a’][‘x’][‘y’]</cite>.</p>
</section>
<section id="combining-lists">
<h3><a class="toc-backref" href="#id19">Combining lists</a><a class="headerlink" href="#combining-lists" title="Permalink to this headline"></a></h3>
<p>This set of filters returns a list of combined lists.</p>
<section id="permutations">
<h4><a class="toc-backref" href="#id20">permutations</a><a class="headerlink" href="#permutations" title="Permalink to this headline"></a></h4>
<p>To get permutations of a list:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Give me largest permutations (order matters)</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">,</span><span class="m">4</span><span class="o">,</span><span class="m">5</span><span class="o">]</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.builtin.permutations</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Give me permutations of sets of three</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">,</span><span class="m">4</span><span class="o">,</span><span class="m">5</span><span class="o">]</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.builtin.permutations</span><span class="o">(</span><span class="m">3</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</section>
<section id="combinations">
<h4><a class="toc-backref" href="#id21">combinations</a><a class="headerlink" href="#combinations" title="Permalink to this headline"></a></h4>
<p>Combinations always require a set size:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Give me combinations for sets of two</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">,</span><span class="m">3</span><span class="o">,</span><span class="m">4</span><span class="o">,</span><span class="m">5</span><span class="o">]</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.builtin.combinations</span><span class="o">(</span><span class="m">2</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>Also see the <a class="reference internal" href="#zip-filter"><span class="std std-ref">Combining items from multiple lists: zip and zip_longest</span></a></p>
</section>
<section id="products">
<h4><a class="toc-backref" href="#id22">products</a><a class="headerlink" href="#products" title="Permalink to this headline"></a></h4>
<p>The product filter returns the <a class="reference external" href="https://docs.python.org/3/library/itertools.html#itertools.product">cartesian product</a> of the input iterables. This is roughly equivalent to nested for-loops in a generator expression.</p>
<p>For example:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Generate multiple hostnames</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">,</span> <span class="s1">&#39;bar&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">product</span><span class="o">([</span><span class="s1">&#39;com&#39;</span><span class="o">])</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;join&#39;</span><span class="o">,</span> <span class="s1">&#39;.&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s1">&#39;,&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>This would result in:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="nt">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;foo.com,bar.com&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="selecting-json-data-json-queries">
<h3><a class="toc-backref" href="#id23">Selecting JSON data: JSON queries</a><a class="headerlink" href="#selecting-json-data-json-queries" title="Permalink to this headline"></a></h3>
<p>To select a single element or a data subset from a complex data structure in JSON format (for example, Ansible facts), use the <code class="docutils literal notranslate"><span class="pre">json_query</span></code> filter.  The <code class="docutils literal notranslate"><span class="pre">json_query</span></code> filter lets you query a complex JSON structure and iterate over it using a loop structure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This filter has migrated to the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general</a> collection. Follow the installation instructions to install that collection.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must manually install the <strong>jmespath</strong> dependency on the Ansible controller before using this filter. This filter is built upon <strong>jmespath</strong>, and you can use the same syntax. For examples, see <a class="reference external" href="https://jmespath.org/examples.html">jmespath examples</a>.</p>
</div>
<p>Consider this data structure:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;domain_definition&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;domain&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster1&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster2&quot;</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="nt">&quot;server&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;server11&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;8080&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;server12&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;8090&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;server21&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster2&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;9080&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;server22&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;cluster&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster2&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;9090&quot;</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="nt">&quot;library&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lib1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster1&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lib2&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;cluster2&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To extract all clusters from this structure, you can use the following query:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all cluster names</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="s1">&#39;domain.cluster[*].name&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>To extract all server names:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all server names</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="s1">&#39;domain.server[*].name&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>To extract ports from cluster1:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all ports from cluster1</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="nv">server_name_cluster1_query</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">server_name_cluster1_query</span><span class="p">:</span> <span class="s">&quot;domain.server[?cluster==&#39;cluster1&#39;].port&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use a variable to make the query more readable.</p>
</div>
<p>To print out the ports from cluster1 in a comma separated string:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all ports from cluster1 as a string</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="s1">&#39;domain.server[?cluster==`cluster1`].port&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s1">&#39;, &#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the example above, quoting literals using backticks avoids escaping quotes and maintains readability.</p>
</div>
<p>You can use YAML <a class="reference external" href="https://yaml.org/spec/current.html#id2534365">single quote escaping</a>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all ports from cluster1</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="s1">&#39;domain.server[?cluster==&#39;&#39;cluster1&#39;&#39;].port&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Escaping single quotes within single quotes in YAML is done by doubling the single quote.</p>
</div>
<p>To get a hash map with all ports and names of a cluster:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all server ports and names from cluster1</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="nv">server_name_cluster1_query</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">server_name_cluster1_query</span><span class="p">:</span> <span class="s">&quot;domain.server[?cluster==&#39;cluster2&#39;].{name:</span><span class="nv"> </span><span class="s">name,</span><span class="nv"> </span><span class="s">port:</span><span class="nv"> </span><span class="s">port}&quot;</span>
</pre></div>
</div>
<p>To extract ports from all clusters with name starting with ‘server1’:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all ports from cluster1</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">to_json</span> <span class="o">|</span> <span class="nf">from_json</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="nv">server_name_query</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">server_name_query</span><span class="p">:</span> <span class="s">&quot;domain.server[?starts_with(name,&#39;server1&#39;)].port&quot;</span>
</pre></div>
</div>
<p>To extract ports from all clusters with name containing ‘server1’:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Display all ports from cluster1</span>
  <span class="nt">ansible.builtin.debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">domain_definition</span> <span class="o">|</span> <span class="nf">to_json</span> <span class="o">|</span> <span class="nf">from_json</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.json_query</span><span class="o">(</span><span class="nv">server_name_query</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">server_name_query</span><span class="p">:</span> <span class="s">&quot;domain.server[?contains(name,&#39;server1&#39;)].port&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>while using <code class="docutils literal notranslate"><span class="pre">starts_with</span></code> and <code class="docutils literal notranslate"><span class="pre">contains</span></code>, you have to use `` to_json | from_json `` filter for correct parsing of data structure.</p>
</div>
</section>
</section>
<section id="randomizing-data">
<h2><a class="toc-backref" href="#id24">Randomizing data</a><a class="headerlink" href="#randomizing-data" title="Permalink to this headline"></a></h2>
<p>When you need a randomly generated value, use one of these filters.</p>
<section id="random-mac-addresses">
<span id="random-mac-filter"></span><h3><a class="toc-backref" href="#id25">Random MAC addresses</a><a class="headerlink" href="#random-mac-addresses" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.6.</span></p>
</div>
<p>This filter can be used to generate a random MAC address from a string prefix.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This filter has migrated to the <a class="reference external" href="https://galaxy.ansible.com/community/general">community.general</a> collection. Follow the installation instructions to install that collection.</p>
</div>
<p>To get a random MAC address from a string prefix starting with ‘52:54:00’:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;</span><span class="cp">{{</span> <span class="s1">&#39;52:54:00&#39;</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.random_mac</span> <span class="cp">}}</span><span class="s">&quot;</span>
<span class="c1"># =&gt; &#39;52:54:00:ef:1c:03&#39;</span>
</pre></div>
</div>
<p>Note that if anything is wrong with the prefix string, the filter will issue an error.</p>
<blockquote>
<div><div class="versionadded">
<p><span class="versionmodified added">New in version 2.9.</span></p>
</div>
</div></blockquote>
<p>As of Ansible version 2.9, you can also initialize the random number generator from a seed to create random-but-idempotent MAC addresses:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;</span><span class="cp">{{</span> <span class="s1">&#39;52:54:00&#39;</span> <span class="o">|</span> <span class="nf">community</span><span class="nv">.general.random_mac</span><span class="o">(</span><span class="nv">seed</span><span class="o">=</span><span class="nv">inventory_hostname</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
</pre></div>
</div>
</section>
<section id="random-items-or-numbers">
<span id="random-filter"></span><h3><a class="toc-backref" href="#id26">Random items or numbers</a><a class="headerlink" href="#random-items-or-numbers" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">random</span></code> filter in Ansible is an extension of the default Jinja2 random filter, and can be used to return a random item from a sequence of items or to generate a random number based on a range.</p>
<p>To get a random item from a list:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;</span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">random</span> <span class="cp">}}</span><span class="s">&quot;</span>
<span class="c1"># =&gt; &#39;c&#39;</span>
</pre></div>
</div>
<p>To get a random number between 0 (inclusive) and a specified integer (exclusive):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;</span><span class="cp">{{</span> <span class="m">60</span> <span class="o">|</span> <span class="nf">random</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">root</span><span class="nv"> </span><span class="s">/script/from/cron&quot;</span>
<span class="c1"># =&gt; &#39;21 * * * * root /script/from/cron&#39;</span>
</pre></div>
</div>
<p>To get a random number from 0 to 100 but in steps of 10:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">101</span> <span class="o">|</span> <span class="nf">random</span><span class="o">(</span><span class="nv">step</span><span class="o">=</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 70</span>
</pre></div>
</div>
<p>To get a random number from 1 to 100 but in steps of 10:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">101</span> <span class="o">|</span> <span class="nf">random</span><span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 31</span>
<span class="cp">{{</span> <span class="m">101</span> <span class="o">|</span> <span class="nf">random</span><span class="o">(</span><span class="nv">start</span><span class="o">=</span><span class="m">1</span><span class="o">,</span> <span class="nv">step</span><span class="o">=</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 51</span>
</pre></div>
</div>
<p>You can initialize the random number generator from a seed to create random-but-idempotent numbers:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;</span><span class="cp">{{</span> <span class="m">60</span> <span class="o">|</span> <span class="nf">random</span><span class="o">(</span><span class="nv">seed</span><span class="o">=</span><span class="nv">inventory_hostname</span><span class="o">)</span> <span class="cp">}}</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">root</span><span class="nv"> </span><span class="s">/script/from/cron&quot;</span>
</pre></div>
</div>
</section>
<section id="shuffling-a-list">
<h3><a class="toc-backref" href="#id27">Shuffling a list</a><a class="headerlink" href="#shuffling-a-list" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">shuffle</span></code> filter randomizes an existing list, giving a different order every invocation.</p>
<p>To get a random list from an existing  list:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">shuffle</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;c&#39;,&#39;a&#39;,&#39;b&#39;]</span>
<span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">shuffle</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;b&#39;,&#39;c&#39;,&#39;a&#39;]</span>
</pre></div>
</div>
<p>You can initialize the shuffle generator from a seed to generate a random-but-idempotent order:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">,</span><span class="s1">&#39;b&#39;</span><span class="o">,</span><span class="s1">&#39;c&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">shuffle</span><span class="o">(</span><span class="nv">seed</span><span class="o">=</span><span class="nv">inventory_hostname</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;b&#39;,&#39;a&#39;,&#39;c&#39;]</span>
</pre></div>
</div>
<p>The shuffle filter returns a list whenever possible. If you use it with a non ‘listable’ item, the filter does nothing.</p>
</section>
</section>
<section id="managing-list-variables">
<span id="list-filters"></span><h2><a class="toc-backref" href="#id28">Managing list variables</a><a class="headerlink" href="#managing-list-variables" title="Permalink to this headline"></a></h2>
<p>You can search for the minimum or maximum value in a list, or flatten a multi-level list.</p>
<p>To get the minimum value from list of numbers:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">list1</span> <span class="o">|</span> <span class="nf">min</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.11.</span></p>
</div>
<p>To get the minimum value in a list of objects:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[{</span><span class="s1">&#39;val&#39;</span><span class="o">:</span> <span class="m">1</span><span class="o">},</span> <span class="o">{</span><span class="s1">&#39;val&#39;</span><span class="o">:</span> <span class="m">2</span><span class="o">}]</span> <span class="o">|</span> <span class="nf">min</span><span class="o">(</span><span class="nv">attribute</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the maximum value from a list of numbers:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="m">3</span><span class="o">,</span> <span class="m">4</span><span class="o">,</span> <span class="m">2</span><span class="o">]</span> <span class="o">|</span> <span class="nf">max</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.11.</span></p>
</div>
<p>To get the maximum value in a list of objects:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[{</span><span class="s1">&#39;val&#39;</span><span class="o">:</span> <span class="m">1</span><span class="o">},</span> <span class="o">{</span><span class="s1">&#39;val&#39;</span><span class="o">:</span> <span class="m">2</span><span class="o">}]</span> <span class="o">|</span> <span class="nf">max</span><span class="o">(</span><span class="nv">attribute</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.5.</span></p>
</div>
<p>Flatten a list (same thing the <cite>flatten</cite> lookup does):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="m">3</span><span class="o">,</span> <span class="o">[</span><span class="m">4</span><span class="o">,</span> <span class="m">2</span><span class="o">]</span> <span class="o">]</span> <span class="o">|</span> <span class="nf">flatten</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [3, 4, 2]</span>
</pre></div>
</div>
<p>Flatten only the first level of a list (akin to the <cite>items</cite> lookup):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="m">3</span><span class="o">,</span> <span class="o">[</span><span class="m">4</span><span class="o">,</span> <span class="o">[</span><span class="m">2</span><span class="o">]]</span> <span class="o">]</span> <span class="o">|</span> <span class="nf">flatten</span><span class="o">(</span><span class="nv">levels</span><span class="o">=</span><span class="m">1</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [3, 4, [2]]</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.11.</span></p>
</div>
<p>Preserve nulls in a list, by default flatten removes them. :</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="m">3</span><span class="o">,</span> <span class="kp">None</span><span class="o">,</span> <span class="o">[</span><span class="m">4</span><span class="o">,</span> <span class="o">[</span><span class="m">2</span><span class="o">]]</span> <span class="o">]</span> <span class="o">|</span> <span class="nf">flatten</span><span class="o">(</span><span class="nv">levels</span><span class="o">=</span><span class="m">1</span><span class="o">,</span> <span class="nv">skip_nulls</span><span class="o">=</span><span class="kp">False</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [3, None, 4, [2]]</span>
</pre></div>
</div>
</section>
<section id="selecting-from-sets-or-lists-set-theory">
<span id="set-theory-filters"></span><h2><a class="toc-backref" href="#id29">Selecting from sets or lists (set theory)</a><a class="headerlink" href="#selecting-from-sets-or-lists-set-theory" title="Permalink to this headline"></a></h2>
<p>You can select or combine items from sets or lists.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<p>To get a unique set from a list:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># list1: [1, 2, 5, 1, 3, 4, 10]</span>
<span class="cp">{{</span> <span class="nv">list1</span> <span class="o">|</span> <span class="nf">unique</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [1, 2, 5, 3, 4, 10]</span>
</pre></div>
</div>
<p>To get a union of two lists:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># list1: [1, 2, 5, 1, 3, 4, 10]</span>
<span class="c1"># list2: [1, 2, 3, 4, 5, 11, 99]</span>
<span class="cp">{{</span> <span class="nv">list1</span> <span class="o">|</span> <span class="nf">union</span><span class="o">(</span><span class="nv">list2</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [1, 2, 5, 1, 3, 4, 10, 11, 99]</span>
</pre></div>
</div>
<p>To get the intersection of 2 lists (unique list of all items in both):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># list1: [1, 2, 5, 3, 4, 10]</span>
<span class="c1"># list2: [1, 2, 3, 4, 5, 11, 99]</span>
<span class="cp">{{</span> <span class="nv">list1</span> <span class="o">|</span> <span class="nf">intersect</span><span class="o">(</span><span class="nv">list2</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [1, 2, 5, 3, 4]</span>
</pre></div>
</div>
<p>To get the difference of 2 lists (items in 1 that don’t exist in 2):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># list1: [1, 2, 5, 1, 3, 4, 10]</span>
<span class="c1"># list2: [1, 2, 3, 4, 5, 11, 99]</span>
<span class="cp">{{</span> <span class="nv">list1</span> <span class="o">|</span> <span class="nf">difference</span><span class="o">(</span><span class="nv">list2</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [10]</span>
</pre></div>
</div>
<p>To get the symmetric difference of 2 lists (items exclusive to each list):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># list1: [1, 2, 5, 1, 3, 4, 10]</span>
<span class="c1"># list2: [1, 2, 3, 4, 5, 11, 99]</span>
<span class="cp">{{</span> <span class="nv">list1</span> <span class="o">|</span> <span class="nf">symmetric_difference</span><span class="o">(</span><span class="nv">list2</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [10, 11, 99]</span>
</pre></div>
</div>
</section>
<section id="calculating-numbers-math">
<span id="math-stuff"></span><h2><a class="toc-backref" href="#id30">Calculating numbers (math)</a><a class="headerlink" href="#calculating-numbers-math" title="Permalink to this headline"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.9.</span></p>
</div>
<p>You can calculate logs, powers, and roots of numbers with Ansible filters. Jinja2 provides other mathematical functions like abs() and round().</p>
<p>Get the logarithm (default is e):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">8</span> <span class="o">|</span> <span class="nf">log</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 2.0794415416798357</span>
</pre></div>
</div>
<p>Get the base 10 logarithm:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">8</span> <span class="o">|</span> <span class="nf">log</span><span class="o">(</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 0.9030899869919435</span>
</pre></div>
</div>
<p>Give me the power of 2! (or 5):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">8</span> <span class="o">|</span> <span class="nf">pow</span><span class="o">(</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 32768.0</span>
</pre></div>
</div>
<p>Square root, or the 5th:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="m">8</span> <span class="o">|</span> <span class="nf">root</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 2.8284271247461903</span>

<span class="cp">{{</span> <span class="m">8</span> <span class="o">|</span> <span class="nf">root</span><span class="o">(</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 1.5157165665103982</span>
</pre></div>
</div>
</section>
<section id="managing-network-interactions">
<h2><a class="toc-backref" href="#id31">Managing network interactions</a><a class="headerlink" href="#managing-network-interactions" title="Permalink to this headline"></a></h2>
<p>These filters help you with common network tasks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These filters have migrated to the <a class="reference external" href="https://galaxy.ansible.com/ansible/netcommon">ansible.netcommon</a> collection. Follow the installation instructions to install that collection.</p>
</div>
<section id="ip-address-filters">
<span id="ipaddr-filter"></span><h3><a class="toc-backref" href="#id32">IP address filters</a><a class="headerlink" href="#ip-address-filters" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.9.</span></p>
</div>
<p>To test if a string is a valid IP address:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.ipaddr</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>You can also require a specific IP protocol version:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.ipv4</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.ipv6</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>IP address filter can also be used to extract specific information from an IP
address. For example, to get the IP address itself from a CIDR, you can use:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;192.0.2.1/24&#39;</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.ipaddr</span><span class="o">(</span><span class="s1">&#39;address&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; 192.0.2.1</span>
</pre></div>
</div>
<p>More information about <code class="docutils literal notranslate"><span class="pre">ipaddr</span></code> filter and complete usage guide can be found
in <a class="reference internal" href="playbooks_filters_ipaddr.html#playbooks-filters-ipaddr"><span class="std std-ref">ipaddr filter</span></a>.</p>
</section>
<section id="network-cli-filters">
<span id="network-filters"></span><h3><a class="toc-backref" href="#id33">Network CLI filters</a><a class="headerlink" href="#network-cli-filters" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.4.</span></p>
</div>
<p>To convert the output of a network device CLI command into structured JSON
output, use the <code class="docutils literal notranslate"><span class="pre">parse_cli</span></code> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">output</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.parse_cli</span><span class="o">(</span><span class="s1">&#39;path/to/spec&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">parse_cli</span></code> filter will load the spec file and pass the command output
through it, returning JSON output. The YAML spec file defines how to parse the CLI output.</p>
<p>The spec file should be valid formatted YAML.  It defines how to parse the CLI
output and return JSON data.  Below is an example of a valid spec file that
will parse the output from the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">vlan</span></code> command.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">vlan</span><span class="p">:</span>
    <span class="nt">vlan_id</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&#39;act/lshut&#39;</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="nt">keys</span><span class="p">:</span>
  <span class="nt">vlans</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vlan</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">items</span><span class="p">:</span> <span class="s">&quot;^(?P&lt;vlan_id&gt;\\d+)\\s+(?P&lt;name&gt;\\w+)\\s+(?P&lt;state&gt;active|act/lshut|suspended)&quot;</span>
  <span class="nt">state_static</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>
</div>
<p>The spec file above will return a JSON data structure that is a list of hashes
with the parsed VLAN information.</p>
<p>The same command could be parsed into a hash by using the key and values
directives.  Here is an example of how to parse the output into a hash
value using the same <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">vlan</span></code> command.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">vlan</span><span class="p">:</span>
    <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">values</span><span class="p">:</span>
      <span class="nt">vlan_id</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&#39;act/lshut&#39;</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="nt">keys</span><span class="p">:</span>
  <span class="nt">vlans</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vlan</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">items</span><span class="p">:</span> <span class="s">&quot;^(?P&lt;vlan_id&gt;\\d+)\\s+(?P&lt;name&gt;\\w+)\\s+(?P&lt;state&gt;active|act/lshut|suspended)&quot;</span>
  <span class="nt">state_static</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>
</div>
<p>Another common use case for parsing CLI commands is to break a large command
into blocks that can be parsed.  This can be done using the <code class="docutils literal notranslate"><span class="pre">start_block</span></code> and
<code class="docutils literal notranslate"><span class="pre">end_block</span></code> directives to break the command into blocks that can be parsed.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">interface</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item[0].match[0]</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item[1].state</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item[2].match[0]</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="nt">keys</span><span class="p">:</span>
  <span class="nt">interfaces</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">interface</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">start_block</span><span class="p">:</span> <span class="s">&quot;^Ethernet.*$&quot;</span>
    <span class="nt">end_block</span><span class="p">:</span> <span class="s">&quot;^$&quot;</span>
    <span class="nt">items</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;^(?P&lt;name&gt;Ethernet\\d\\/\\d*)&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;admin</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">(?P&lt;state&gt;.+),&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;Port</span><span class="nv"> </span><span class="s">mode</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">(.+)&quot;</span>
</pre></div>
</div>
<p>The example above will parse the output of <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">interface</span></code> into a list of
hashes.</p>
<p>The network filters also support parsing the output of a CLI command using the
TextFSM library.  To parse the CLI output with TextFSM use the following
filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">output.stdout</span><span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.parse_cli_textfsm</span><span class="o">(</span><span class="s1">&#39;path/to/fsm&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Use of the TextFSM filter requires the TextFSM library to be installed.</p>
</section>
<section id="network-xml-filters">
<h3><a class="toc-backref" href="#id34">Network XML filters</a><a class="headerlink" href="#network-xml-filters" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.5.</span></p>
</div>
<p>To convert the XML output of a network device command into structured JSON
output, use the <code class="docutils literal notranslate"><span class="pre">parse_xml</span></code> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">output</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.parse_xml</span><span class="o">(</span><span class="s1">&#39;path/to/spec&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">parse_xml</span></code> filter will load the spec file and pass the command output
through formatted as JSON.</p>
<p>The spec file should be valid formatted YAML. It defines how to parse the XML
output and return JSON data.</p>
<p>Below is an example of a valid spec file that
will parse the output from the <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">vlan</span> <span class="pre">|</span> <span class="pre">display</span> <span class="pre">xml</span></code> command.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">vlan</span><span class="p">:</span>
    <span class="nt">vlan_id</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">desc</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.desc</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state.get(&#39;inactive&#39;)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&#39;inactive&#39;</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{%</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">item.state.get(&#39;inactive&#39;)</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;inactive&#39;%}</span><span class="nv"> </span><span class="s">inactive</span><span class="nv"> </span><span class="s">{%</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">%}</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">{%</span><span class="nv"> </span><span class="s">endif</span><span class="nv"> </span><span class="s">%}&quot;</span>

<span class="nt">keys</span><span class="p">:</span>
  <span class="nt">vlans</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vlan</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">top</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">configuration/vlans/vlan</span>
    <span class="nt">items</span><span class="p">:</span>
      <span class="nt">vlan_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan-id</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
      <span class="nt">desc</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">description</span>
      <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;.[@inactive=&#39;inactive&#39;]&quot;</span>
</pre></div>
</div>
<p>The spec file above will return a JSON data structure that is a list of hashes
with the parsed VLAN information.</p>
<p>The same command could be parsed into a hash by using the key and values
directives.  Here is an example of how to parse the output into a hash
value using the same <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">vlan</span> <span class="pre">|</span> <span class="pre">display</span> <span class="pre">xml</span></code> command.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">vlan</span><span class="p">:</span>
    <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">values</span><span class="p">:</span>
        <span class="nt">vlan_id</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">desc</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.desc</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state.get(&#39;inactive&#39;)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&#39;inactive&#39;</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{%</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">item.state.get(&#39;inactive&#39;)</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;inactive&#39;%}</span><span class="nv"> </span><span class="s">inactive</span><span class="nv"> </span><span class="s">{%</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">%}</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">{%</span><span class="nv"> </span><span class="s">endif</span><span class="nv"> </span><span class="s">%}&quot;</span>

<span class="nt">keys</span><span class="p">:</span>
  <span class="nt">vlans</span><span class="p">:</span>
    <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vlan</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">top</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">configuration/vlans/vlan</span>
    <span class="nt">items</span><span class="p">:</span>
      <span class="nt">vlan_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan-id</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">name</span>
      <span class="nt">desc</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">description</span>
      <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;.[@inactive=&#39;inactive&#39;]&quot;</span>
</pre></div>
</div>
<p>The value of <code class="docutils literal notranslate"><span class="pre">top</span></code> is the XPath relative to the XML root node.
In the example XML output given below, the value of <code class="docutils literal notranslate"><span class="pre">top</span></code> is <code class="docutils literal notranslate"><span class="pre">configuration/vlans/vlan</span></code>,
which is an XPath expression relative to the root node (&lt;rpc-reply&gt;).
<code class="docutils literal notranslate"><span class="pre">configuration</span></code> in the value of <code class="docutils literal notranslate"><span class="pre">top</span></code> is the outer most container node, and <code class="docutils literal notranslate"><span class="pre">vlan</span></code>
is the inner-most container node.</p>
<p><code class="docutils literal notranslate"><span class="pre">items</span></code> is a dictionary of key-value pairs that map user-defined names to XPath expressions
that select elements. The Xpath expression is relative to the value of the XPath value contained in <code class="docutils literal notranslate"><span class="pre">top</span></code>.
For example, the <code class="docutils literal notranslate"><span class="pre">vlan_id</span></code> in the spec file is a user defined name and its value <code class="docutils literal notranslate"><span class="pre">vlan-id</span></code> is the
relative to the value of XPath in <code class="docutils literal notranslate"><span class="pre">top</span></code></p>
<p>Attributes of XML tags can be extracted using XPath expressions. The value of <code class="docutils literal notranslate"><span class="pre">state</span></code> in the spec
is an XPath expression used to get the attributes of the <code class="docutils literal notranslate"><span class="pre">vlan</span></code> tag in output XML.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;rpc-reply&gt;
  &lt;configuration&gt;
    &lt;vlans&gt;
      &lt;vlan inactive=&quot;inactive&quot;&gt;
       &lt;name&gt;vlan-1&lt;/name&gt;
       &lt;vlan-id&gt;200&lt;/vlan-id&gt;
       &lt;description&gt;This is vlan-1&lt;/description&gt;
      &lt;/vlan&gt;
    &lt;/vlans&gt;
  &lt;/configuration&gt;
&lt;/rpc-reply&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information on supported XPath expressions, see <a class="reference external" href="https://docs.python.org/3/library/xml.etree.elementtree.html#xpath-support">XPath Support</a>.</p>
</div>
</section>
<section id="network-vlan-filters">
<h3><a class="toc-backref" href="#id35">Network VLAN filters</a><a class="headerlink" href="#network-vlan-filters" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.8.</span></p>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">vlan_parser</span></code> filter to transform an unsorted list of VLAN integers into a
sorted string list of integers according to IOS-like VLAN list rules. This list has the following properties:</p>
<ul class="simple">
<li><p>Vlans are listed in ascending order.</p></li>
<li><p>Three or more consecutive VLANs are listed with a dash.</p></li>
<li><p>The first line of the list can be first_line_len characters long.</p></li>
<li><p>Subsequent list lines can be other_line_len characters.</p></li>
</ul>
<p>To sort a VLAN list:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="m">3003</span><span class="o">,</span> <span class="m">3004</span><span class="o">,</span> <span class="m">3005</span><span class="o">,</span> <span class="m">100</span><span class="o">,</span> <span class="m">1688</span><span class="o">,</span> <span class="m">3002</span><span class="o">,</span> <span class="m">3999</span><span class="o">]</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.vlan_parser</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This example renders the following sorted list:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[&#39;100,1688,3002-3005,3999&#39;]
</pre></div>
</div>
<p>Another example Jinja template:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">set</span> <span class="nv">parsed_vlans</span> <span class="o">=</span> <span class="nv">vlans</span> <span class="o">|</span> <span class="nf">ansible</span><span class="nv">.netcommon.vlan_parser</span> <span class="cp">%}</span>
<span class="l l-Scalar l-Scalar-Plain">switchport trunk allowed vlan</span> <span class="cp">{{</span> <span class="nv">parsed_vlans</span><span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">i</span> <span class="k">in</span> <span class="nv">range</span> <span class="o">(</span><span class="m">1</span><span class="o">,</span> <span class="nv">parsed_vlans</span> <span class="o">|</span> <span class="nf">count</span><span class="o">)</span> <span class="cp">%}</span>
<span class="l l-Scalar l-Scalar-Plain">switchport trunk allowed vlan add</span> <span class="cp">{{</span> <span class="nv">parsed_vlans</span><span class="o">[</span><span class="nv">i</span><span class="o">]</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>This allows for dynamic generation of VLAN lists on a Cisco IOS tagged interface. You can store an exhaustive raw list of the exact VLANs required for an interface and then compare that to the parsed IOS output that would actually be generated for the configuration.</p>
</section>
</section>
<section id="hashing-and-encrypting-strings-and-passwords">
<span id="hash-filters"></span><h2><a class="toc-backref" href="#id36">Hashing and encrypting strings and passwords</a><a class="headerlink" href="#hashing-and-encrypting-strings-and-passwords" title="Permalink to this headline"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.9.</span></p>
</div>
<p>To get the sha1 hash of a string:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;test1&#39;</span> <span class="o">|</span> <span class="nf">hash</span><span class="o">(</span><span class="s1">&#39;sha1&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;b444ac06613fc8d63795be9ad0beaf55011936ac&quot;</span>
</pre></div>
</div>
<p>To get the md5 hash of a string:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;test1&#39;</span> <span class="o">|</span> <span class="nf">hash</span><span class="o">(</span><span class="s1">&#39;md5&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;5a105e8b9d40e1329780d62ea2265d8a&quot;</span>
</pre></div>
</div>
<p>Get a string checksum:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;test2&#39;</span> <span class="o">|</span> <span class="nf">checksum</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f&quot;</span>
</pre></div>
</div>
<p>Other hashes (platform dependent):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;test2&#39;</span> <span class="o">|</span> <span class="nf">hash</span><span class="o">(</span><span class="s1">&#39;blowfish&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get a sha512 password hash (random salt):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;passwordsaresecret&#39;</span> <span class="o">|</span> <span class="nf">password_hash</span><span class="o">(</span><span class="s1">&#39;sha512&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;$6$UIv3676O/ilZzWEE$ktEfFF19NQPF2zyxqxGkAceTnbEgpEKuGBtk6MlU4v2ZorWaVQUMyurgmHCh2Fr4wpmQ/Y.AlXMJkRnIS4RfH/&quot;</span>
</pre></div>
</div>
<p>To get a sha256 password hash with a specific salt:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;secretpassword&#39;</span> <span class="o">|</span> <span class="nf">password_hash</span><span class="o">(</span><span class="s1">&#39;sha256&#39;</span><span class="o">,</span> <span class="s1">&#39;mysecretsalt&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;$5$mysecretsalt$ReKNyDYjkKNqRVwouShhsEqZ3VOE8eoVO4exihOfvG4&quot;</span>
</pre></div>
</div>
<p>An idempotent method to generate unique hashes per system is to use a salt that is consistent between runs:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;secretpassword&#39;</span> <span class="o">|</span> <span class="nf">password_hash</span><span class="o">(</span><span class="s1">&#39;sha512&#39;</span><span class="o">,</span> <span class="m">65534</span> <span class="o">|</span> <span class="nf">random</span><span class="o">(</span><span class="nv">seed</span><span class="o">=</span><span class="nv">inventory_hostname</span><span class="o">)</span> <span class="o">|</span> <span class="nf">string</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;$6$43927$lQxPKz2M2X.NWO.gK.t7phLwOKQMcSq72XxDZQ0XzYV6DlL1OD72h417aj16OnHTGxNzhftXJQBcjbunLEepM0&quot;</span>
</pre></div>
</div>
<p>Hash types available depend on the control system running Ansible, ‘hash’ depends on <a class="reference external" href="https://docs.python.org/3.8/library/hashlib.html">hashlib</a>, password_hash depends on <a class="reference external" href="https://passlib.readthedocs.io/en/stable/lib/passlib.hash.html">passlib</a>. The <a class="reference external" href="https://docs.python.org/3.8/library/crypt.html">crypt</a> is used as a fallback if <code class="docutils literal notranslate"><span class="pre">passlib</span></code> is not installed.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.7.</span></p>
</div>
<p>Some hash types allow providing a rounds parameter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;secretpassword&#39;</span> <span class="o">|</span> <span class="nf">password_hash</span><span class="o">(</span><span class="s1">&#39;sha256&#39;</span><span class="o">,</span> <span class="s1">&#39;mysecretsalt&#39;</span><span class="o">,</span> <span class="nv">rounds</span><span class="o">=</span><span class="m">10000</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;$5$rounds=10000$mysecretsalt$Tkm80llAxD4YHll6AgNIztKn0vzAACsuuEfYeGP7tm7&quot;</span>
</pre></div>
</div>
<p>The filter <cite>password_hash</cite> produces different results depending on whether you installed <cite>passlib</cite> or not.</p>
<p>To ensure idempotency, specify <cite>rounds</cite> to be neither <cite>crypt</cite>’s nor <cite>passlib</cite>’s default, which is <cite>5000</cite> for <cite>crypt</cite> and a variable value (<cite>535000</cite> for sha256, <cite>656000</cite> for sha512) for <cite>passlib</cite>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;secretpassword&#39;</span> <span class="o">|</span> <span class="nf">password_hash</span><span class="o">(</span><span class="s1">&#39;sha256&#39;</span><span class="o">,</span> <span class="s1">&#39;mysecretsalt&#39;</span><span class="o">,</span> <span class="nv">rounds</span><span class="o">=</span><span class="m">5001</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;$5$rounds=5001$mysecretsalt$wXcTWWXbfcR8er5IVf7NuquLvnUA6s8/qdtOhAZ.xN.&quot;</span>
</pre></div>
</div>
<p>Hash type ‘blowfish’ (BCrypt) provides the facility to specify the version of the BCrypt algorithm.</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;secretpassword&#39;</span> <span class="o">|</span> <span class="nf">password_hash</span><span class="o">(</span><span class="s1">&#39;blowfish&#39;</span><span class="o">,</span> <span class="s1">&#39;1234567890123456789012&#39;</span><span class="o">,</span> <span class="nv">ident</span><span class="o">=</span><span class="s1">&#39;2b&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;$2b$12$123456789012345678901uuJ4qFdej6xnWjOQT.FStqfdoY8dYUPC&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameter is only available for <a class="reference external" href="https://passlib.readthedocs.io/en/stable/lib/passlib.hash.bcrypt.html#passlib.hash.bcrypt">blowfish (BCrypt)</a>.
Other hash types will simply ignore this parameter.
Valid values for this parameter are: [‘2’, ‘2a’, ‘2y’, ‘2b’]</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.12.</span></p>
</div>
<p>You can also use the Ansible <a class="reference internal" href="vault.html#vault"><span class="std std-ref">vault</span></a> filter to encrypt data:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># simply encrypt my key in a vault</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">myvaultedkey</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">keyrawdata</span><span class="o">|</span><span class="nf">vault</span><span class="o">(</span><span class="nv">passphrase</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">save templated vaulted data</span>
  <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src=dump_template_data.j2 dest=/some/key/vault.txt</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">mysalt</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="m">2</span><span class="o">**</span><span class="m">256</span><span class="o">|</span><span class="nf">random</span><span class="o">(</span><span class="nv">seed</span><span class="o">=</span><span class="nv">inventory_hostname</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">template_data</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">secretdata</span><span class="o">|</span><span class="nf">vault</span><span class="o">(</span><span class="nv">vaultsecret</span><span class="o">,</span> <span class="nv">salt</span><span class="o">=</span><span class="nv">mysalt</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>And then decrypt it using the unvault filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># simply decrypt my key from a vault</span>
<span class="nt">vars</span><span class="p">:</span>
  <span class="nt">mykey</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">myvaultedkey</span><span class="o">|</span><span class="nf">unvault</span><span class="o">(</span><span class="nv">passphrase</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">save templated unvaulted data</span>
  <span class="nt">template</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src=dump_template_data.j2 dest=/some/key/clear.txt</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">template_data</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">secretdata</span><span class="o">|</span><span class="nf">unvault</span><span class="o">(</span><span class="nv">vaultsecret</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&#39;</span>
</pre></div>
</div>
</section>
<section id="manipulating-text">
<span id="other-useful-filters"></span><h2><a class="toc-backref" href="#id37">Manipulating text</a><a class="headerlink" href="#manipulating-text" title="Permalink to this headline"></a></h2>
<p>Several filters work with text, including URLs, file names, and path names.</p>
<section id="adding-comments-to-files">
<span id="comment-filter"></span><h3><a class="toc-backref" href="#id38">Adding comments to files</a><a class="headerlink" href="#adding-comments-to-files" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">comment</span></code> filter lets you create comments in a file from text in a template, with a variety of comment styles. By default Ansible uses <code class="docutils literal notranslate"><span class="pre">#</span></code> to start a comment line and adds a blank comment line above and below your comment text. For example the following:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s2">&quot;Plain style (default)&quot;</span> <span class="o">|</span> <span class="nf">comment</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>produces this output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#
# Plain style (default)
#
</pre></div>
</div>
<p>Ansible offers styles for comments in C (<code class="docutils literal notranslate"><span class="pre">//...</span></code>), C block
(<code class="docutils literal notranslate"><span class="pre">/*...*/</span></code>), Erlang (<code class="docutils literal notranslate"><span class="pre">%...</span></code>) and XML (<code class="docutils literal notranslate"><span class="pre">&lt;!--...--&gt;</span></code>):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s2">&quot;C style&quot;</span> <span class="o">|</span> <span class="nf">comment</span><span class="o">(</span><span class="s1">&#39;c&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="s2">&quot;C block style&quot;</span> <span class="o">|</span> <span class="nf">comment</span><span class="o">(</span><span class="s1">&#39;cblock&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="s2">&quot;Erlang style&quot;</span> <span class="o">|</span> <span class="nf">comment</span><span class="o">(</span><span class="s1">&#39;erlang&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="s2">&quot;XML style&quot;</span> <span class="o">|</span> <span class="nf">comment</span><span class="o">(</span><span class="s1">&#39;xml&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>You can define a custom comment character. This filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s2">&quot;My Special Case&quot;</span> <span class="o">|</span> <span class="nf">comment</span><span class="o">(</span><span class="nv">decoration</span><span class="o">=</span><span class="s2">&quot;! &quot;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>produces:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>!
! My Special Case
!
</pre></div>
</div>
<p>You can fully customize the comment style:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s2">&quot;Custom style&quot;</span> <span class="o">|</span> <span class="nf">comment</span><span class="o">(</span><span class="s1">&#39;plain&#39;</span><span class="o">,</span> <span class="nv">prefix</span><span class="o">=</span><span class="s1">&#39;#######\n#&#39;</span><span class="o">,</span> <span class="nv">postfix</span><span class="o">=</span><span class="s1">&#39;#\n#######\n   ###\n    #&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>That creates the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>#######
#
# Custom style
#
#######
   ###
    #
</pre></div>
</div>
<p>The filter can also be applied to any Ansible variable. For example to
make the output of the <code class="docutils literal notranslate"><span class="pre">ansible_managed</span></code> variable more readable, we can
change the definition in the <code class="docutils literal notranslate"><span class="pre">ansible.cfg</span></code> file to this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[defaults]</span>

<span class="na">ansible_managed</span> <span class="o">=</span> <span class="s">This file is managed by Ansible.%n</span>
  <span class="na">template: {file}</span>
  <span class="na">date: %Y-%m-%d %H:%M:%S</span>
  <span class="na">user: {uid}</span>
  <span class="na">host: {host}</span>
</pre></div>
</div>
<p>and then use the variable with the <cite>comment</cite> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">ansible_managed</span> <span class="o">|</span> <span class="nf">comment</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>which produces this output:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># This file is managed by Ansible.</span>
<span class="c1">#</span>
<span class="c1"># template: /home/ansible/env/dev/ansible_managed/roles/role1/templates/test.j2</span>
<span class="c1"># date: 2015-09-10 11:02:58</span>
<span class="c1"># user: ansible</span>
<span class="c1"># host: myhost</span>
<span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="urlencode-variables">
<h3><a class="toc-backref" href="#id39">URLEncode Variables</a><a class="headerlink" href="#urlencode-variables" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">urlencode</span></code> filter quotes data for use in a URL path or query using UTF-8:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;Trollhättan&#39;</span> <span class="o">|</span> <span class="nf">urlencode</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;Trollh%C3%A4ttan&#39;</span>
</pre></div>
</div>
</section>
<section id="splitting-urls">
<h3><a class="toc-backref" href="#id40">Splitting URLs</a><a class="headerlink" href="#splitting-urls" title="Permalink to this headline"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.4.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">urlsplit</span></code> filter extracts the fragment, hostname, netloc, password, path, port, query, scheme, and username from an URL. With no arguments, returns a dictionary of all the fields:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6212031111150d1006221515154c03010f074c010d0f">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;hostname&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;www.acme.com&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="fa8a9b89898d95889eba8d8d8dd49b99979fd4999597">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;netloc&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2555445656524a5741655252520b444648400b464a48">[email&#160;protected]</a>:9000&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4a3a2b39393d25382e0a3d3d3d642b29272f64292527">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;username&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;user&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="83f3e2f0f0f4ecf1e7c3f4f4f4ade2e0eee6ade0ecee">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;password&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;password&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3040514343475f4254704747471e51535d551e535f5d">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;path&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;/dir/index.html&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3e4e5f4d4d49514c5a7e494949105f5d535b105d5153">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;port&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;9000&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d7a7b6a4a4a0b8a5b397a0a0a0f9b6b4bab2f9b4b8ba">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;scheme&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;http&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="176776646460786573576060603976747a723974787a">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;query&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;query=term&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6919081a1a1e061b0d291e1e1e47080a040c470a0604">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span><span class="o">(</span><span class="s1">&#39;fragment&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;fragment&#39;</span>

<span class="cp">{{</span> <span class="s2">&quot;http://user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2a5a4b59595d45584e6a5d5d5d044b49474f04494547">[email&#160;protected]</a>:9000/dir/index.html?query=term#fragment&quot;</span> <span class="o">|</span> <span class="nf">urlsplit</span> <span class="cp">}}</span>
<span class="c1"># =&gt;</span>
<span class="c1">#   {</span>
<span class="c1">#       &quot;fragment&quot;: &quot;fragment&quot;,</span>
<span class="c1">#       &quot;hostname&quot;: &quot;www.acme.com&quot;,</span>
<span class="c1">#       &quot;netloc&quot;: &quot;user:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6f1f0e1c1c18001d0b2f181818410e0c020a410c0002">[email&#160;protected]</a>:9000&quot;,</span>
<span class="c1">#       &quot;password&quot;: &quot;password&quot;,</span>
<span class="c1">#       &quot;path&quot;: &quot;/dir/index.html&quot;,</span>
<span class="c1">#       &quot;port&quot;: 9000,</span>
<span class="c1">#       &quot;query&quot;: &quot;query=term&quot;,</span>
<span class="c1">#       &quot;scheme&quot;: &quot;http&quot;,</span>
<span class="c1">#       &quot;username&quot;: &quot;user&quot;</span>
<span class="c1">#   }</span>
</pre></div>
</div>
</section>
<section id="searching-strings-with-regular-expressions">
<h3><a class="toc-backref" href="#id41">Searching strings with regular expressions</a><a class="headerlink" href="#searching-strings-with-regular-expressions" title="Permalink to this headline"></a></h3>
<p>To search in a string or extract parts of a string with a regular expression, use the <code class="docutils literal notranslate"><span class="pre">regex_search</span></code> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extracts the database name from a string</span>
<span class="cp">{{</span> <span class="s1">&#39;server1/database42&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;database[0-9]+&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;database42&#39;</span>

<span class="c1"># Example for a case insensitive search in multiline mode</span>
<span class="cp">{{</span> <span class="s1">&#39;foo\nBAR&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;^bar&#39;</span><span class="o">,</span> <span class="nv">multiline</span><span class="o">=</span><span class="kp">True</span><span class="o">,</span> <span class="nv">ignorecase</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;BAR&#39;</span>

<span class="c1"># Extracts server and database id from a string</span>
<span class="cp">{{</span> <span class="s1">&#39;server1/database42&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;server([0-9]+)/database([0-9]+)&#39;</span><span class="o">,</span> <span class="s1">&#39;\\1&#39;</span><span class="o">,</span> <span class="s1">&#39;\\2&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;1&#39;, &#39;42&#39;]</span>

<span class="c1"># Extracts dividend and divisor from a division</span>
<span class="cp">{{</span> <span class="s1">&#39;21/42&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;(?P&lt;dividend&gt;[0-9]+)/(?P&lt;divisor&gt;[0-9]+)&#39;</span><span class="o">,</span> <span class="s1">&#39;\\g&lt;dividend&gt;&#39;</span><span class="o">,</span> <span class="s1">&#39;\\g&lt;divisor&gt;&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;21&#39;, &#39;42&#39;]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">regex_search</span></code> filter returns an empty string if it cannot find a match:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;ansible&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;foobar&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">regex_search</span></code> filter returns <code class="docutils literal notranslate"><span class="pre">None</span></code> when used in a Jinja expression (for example in conjunction with operators, other filters, and so on). See the two examples below.</p>
<div class="highlight-Jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="s1">&#39;ansible&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;foobar&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="cp">}}</span><span class="x"></span>
<span class="x"># =&gt; False</span>
<span class="cp">{{</span> <span class="s1">&#39;ansible&#39;</span> <span class="o">|</span> <span class="nf">regex_search</span><span class="o">(</span><span class="s1">&#39;foobar&#39;</span><span class="o">)</span> <span class="k">is</span> <span class="nf">none</span> <span class="cp">}}</span><span class="x"></span>
<span class="x"># =&gt; True</span>
</pre></div>
</div>
<p>This is due to historic behavior and the custom re-implementation of some of the Jinja internals in Ansible. Enable the <code class="docutils literal notranslate"><span class="pre">jinja2_native</span></code> setting if you want the <code class="docutils literal notranslate"><span class="pre">regex_search</span></code> filter to always return <code class="docutils literal notranslate"><span class="pre">None</span></code> if it cannot find a match. See <a class="reference internal" href="../reference_appendices/faq.html#jinja2-faqs"><span class="std std-ref">Why does the regex_search filter return None instead of an empty string?</span></a> for details.</p>
</div>
<p>To extract all occurrences of regex matches in a string, use the <code class="docutils literal notranslate"><span class="pre">regex_findall</span></code> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a list of all IPv4 addresses in the string</span>
<span class="cp">{{</span> <span class="s1">&#39;Some DNS servers are 8.8.8.8 and 8.8.4.4&#39;</span> <span class="o">|</span> <span class="nf">regex_findall</span><span class="o">(</span><span class="s1">&#39;\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;8.8.8.8&#39;, &#39;8.8.4.4&#39;]</span>

<span class="c1"># Returns all lines that end with &quot;ar&quot;</span>
<span class="cp">{{</span> <span class="s1">&#39;CAR\ntar\nfoo\nbar\n&#39;</span> <span class="o">|</span> <span class="nf">regex_findall</span><span class="o">(</span><span class="s1">&#39;^.ar$&#39;</span><span class="o">,</span> <span class="nv">multiline</span><span class="o">=</span><span class="kp">True</span><span class="o">,</span> <span class="nv">ignorecase</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;CAR&#39;, &#39;tar&#39;, &#39;bar&#39;]</span>
</pre></div>
</div>
<p>To replace text in a string with regex, use the <code class="docutils literal notranslate"><span class="pre">regex_replace</span></code> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert &quot;ansible&quot; to &quot;able&quot;</span>
<span class="cp">{{</span> <span class="s1">&#39;ansible&#39;</span> <span class="o">|</span> <span class="nf">regex_replace</span><span class="o">(</span><span class="s1">&#39;^a.*i(.*)$&#39;</span><span class="o">,</span> <span class="s1">&#39;a\\1&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;able&#39;</span>

<span class="c1"># Convert &quot;foobar&quot; to &quot;bar&quot;</span>
<span class="cp">{{</span> <span class="s1">&#39;foobar&#39;</span> <span class="o">|</span> <span class="nf">regex_replace</span><span class="o">(</span><span class="s1">&#39;^f.*o(.*)$&#39;</span><span class="o">,</span> <span class="s1">&#39;\\1&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;bar&#39;</span>

<span class="c1"># Convert &quot;localhost:80&quot; to &quot;localhost, 80&quot; using named groups</span>
<span class="cp">{{</span> <span class="s1">&#39;localhost:80&#39;</span> <span class="o">|</span> <span class="nf">regex_replace</span><span class="o">(</span><span class="s1">&#39;^(?P&lt;host&gt;.+):(?P&lt;port&gt;\\d+)$&#39;</span><span class="o">,</span> <span class="s1">&#39;\\g&lt;host&gt;, \\g&lt;port&gt;&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;localhost, 80&#39;</span>

<span class="c1"># Convert &quot;localhost:80&quot; to &quot;localhost&quot;</span>
<span class="cp">{{</span> <span class="s1">&#39;localhost:80&#39;</span> <span class="o">|</span> <span class="nf">regex_replace</span><span class="o">(</span><span class="s1">&#39;:80&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;localhost&#39;</span>

<span class="c1"># Comment all lines that end with &quot;ar&quot;</span>
<span class="cp">{{</span> <span class="s1">&#39;CAR\ntar\nfoo\nbar\n&#39;</span> <span class="o">|</span> <span class="nf">regex_replace</span><span class="o">(</span><span class="s1">&#39;^(.ar)$&#39;</span><span class="o">,</span> <span class="s1">&#39;#\\1&#39;</span><span class="o">,</span> <span class="nv">multiline</span><span class="o">=</span><span class="kp">True</span><span class="o">,</span> <span class="nv">ignorecase</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;#CAR\n#tar\nfoo\n#bar\n&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to match the whole string and you are using <code class="docutils literal notranslate"><span class="pre">*</span></code> make sure to always wraparound your regular expression with the start/end anchors. For example <code class="docutils literal notranslate"><span class="pre">^(.*)$</span></code> will always match only one result, while <code class="docutils literal notranslate"><span class="pre">(.*)</span></code> on some Python versions will match the whole string and an empty string at the end, which means it will make two replacements:</p>
</div>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># add &quot;https://&quot; prefix to each item in a list</span>
<span class="nt">GOOD</span><span class="p">:</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;^(.*)$&#39;</span><span class="o">,</span> <span class="s1">&#39;https://\\1&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;(.+)&#39;</span><span class="o">,</span> <span class="s1">&#39;https://\\1&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;^&#39;</span><span class="o">,</span> <span class="s1">&#39;https://&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>

<span class="nt">BAD</span><span class="p">:</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;(.*)&#39;</span><span class="o">,</span> <span class="s1">&#39;https://\\1&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>

<span class="c1"># append &#39;:80&#39; to each item in a list</span>
<span class="nt">GOOD</span><span class="p">:</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;^(.*)$&#39;</span><span class="o">,</span> <span class="s1">&#39;\\1:80&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;(.+)&#39;</span><span class="o">,</span> <span class="s1">&#39;\\1:80&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;$&#39;</span><span class="o">,</span> <span class="s1">&#39;:80&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>

<span class="nt">BAD</span><span class="p">:</span>
<span class="cp">{{</span> <span class="nv">hosts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="s1">&#39;regex_replace&#39;</span><span class="o">,</span> <span class="s1">&#39;(.*)&#39;</span><span class="o">,</span> <span class="s1">&#39;\\1:80&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">list</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to ansible 2.0, if <code class="docutils literal notranslate"><span class="pre">regex_replace</span></code> filter was used with variables inside YAML arguments (as opposed to simpler ‘key=value’ arguments), then you needed to escape backreferences (for example, <code class="docutils literal notranslate"><span class="pre">\\1</span></code>) with 4 backslashes (<code class="docutils literal notranslate"><span class="pre">\\\\</span></code>) instead of 2 (<code class="docutils literal notranslate"><span class="pre">\\</span></code>).</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.0.</span></p>
</div>
<p>To escape special characters within a standard Python regex, use the <code class="docutils literal notranslate"><span class="pre">regex_escape</span></code> filter (using the default <code class="docutils literal notranslate"><span class="pre">re_type='python'</span></code> option):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert &#39;^f.*o(.*)$&#39; to &#39;\^f\.\*o\(\.\*\)\$&#39;</span>
<span class="cp">{{</span> <span class="s1">&#39;^f.*o(.*)$&#39;</span> <span class="o">|</span> <span class="nf">regex_escape</span><span class="o">()</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.8.</span></p>
</div>
<p>To escape special characters within a POSIX basic regex, use the <code class="docutils literal notranslate"><span class="pre">regex_escape</span></code> filter with the <code class="docutils literal notranslate"><span class="pre">re_type='posix_basic'</span></code> option:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert &#39;^f.*o(.*)$&#39; to &#39;\^f\.\*o(\.\*)\$&#39;</span>
<span class="cp">{{</span> <span class="s1">&#39;^f.*o(.*)$&#39;</span> <span class="o">|</span> <span class="nf">regex_escape</span><span class="o">(</span><span class="s1">&#39;posix_basic&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="managing-file-names-and-path-names">
<h3><a class="toc-backref" href="#id42">Managing file names and path names</a><a class="headerlink" href="#managing-file-names-and-path-names" title="Permalink to this headline"></a></h3>
<p>To get the last name of a file path, like ‘foo.txt’ out of ‘/etc/asdf/foo.txt’:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">basename</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the last name of a windows style file path (new in version 2.0):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">win_basename</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To separate the windows drive letter from the rest of a file path (new in version 2.0):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">win_splitdrive</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get only the windows drive letter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">win_splitdrive</span> <span class="o">|</span> <span class="nf">first</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the rest of the path without the drive letter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">win_splitdrive</span> <span class="o">|</span> <span class="nf">last</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the directory from a path:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">dirname</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the directory from a windows path (new version 2.0):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">win_dirname</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To expand a path containing a tilde (<cite>~</cite>) character (new in version 1.5):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">expanduser</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To expand a path containing environment variables:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">expandvars</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>expandvars</cite> expands local variables; using it on remote paths can lead to errors.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.6.</span></p>
</div>
<p>To get the real path of a link (new in version 1.8):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">realpath</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the relative path of a link, from a start point (new in version 1.7):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">relpath</span><span class="o">(</span><span class="s1">&#39;/etc&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To get the root and extension of a path or file name (new in version 2.0):</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># with path == &#39;nginx.conf&#39; the return would be (&#39;nginx&#39;, &#39;.conf&#39;)</span>
<span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">splitext</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">splitext</span></code> filter always returns a pair of strings. The individual components can be accessed by using the <code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> filters:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># with path == &#39;nginx.conf&#39; the return would be &#39;nginx&#39;</span>
<span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">splitext</span> <span class="o">|</span> <span class="nf">first</span> <span class="cp">}}</span>

<span class="c1"># with path == &#39;nginx.conf&#39; the return would be &#39;.conf&#39;</span>
<span class="cp">{{</span> <span class="nv">path</span> <span class="o">|</span> <span class="nf">splitext</span> <span class="o">|</span> <span class="nf">last</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To join one or more path components:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">(</span><span class="s1">&#39;/etc&#39;</span><span class="o">,</span> <span class="nv">path</span><span class="o">,</span> <span class="s1">&#39;subdir&#39;</span><span class="o">,</span> <span class="nv">file</span><span class="o">)</span> <span class="o">|</span> <span class="nf">path_join</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.10.</span></p>
</div>
</section>
</section>
<section id="manipulating-strings">
<h2><a class="toc-backref" href="#id43">Manipulating strings</a><a class="headerlink" href="#manipulating-strings" title="Permalink to this headline"></a></h2>
<p>To add quotes for shell usage:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a shell command</span>
  <span class="nt">ansible.builtin.shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo</span> <span class="cp">{{</span> <span class="nv">string_value</span> <span class="o">|</span> <span class="nf">quote</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To concatenate a list into a string:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">list</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s2">&quot; &quot;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>To split a string into a list:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">csv_string</span> <span class="o">|</span> <span class="nf">split</span><span class="o">(</span><span class="s2">&quot;,&quot;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.11.</span></p>
</div>
<p>To work with Base64 encoded strings:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">encoded</span> <span class="o">|</span> <span class="nf">b64decode</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">decoded</span> <span class="o">|</span> <span class="nf">string</span> <span class="o">|</span> <span class="nf">b64encode</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>As of version 2.6, you can define the type of encoding to use, the default is <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">encoded</span> <span class="o">|</span> <span class="nf">b64decode</span><span class="o">(</span><span class="nv">encoding</span><span class="o">=</span><span class="s1">&#39;utf-16-le&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="cp">{{</span> <span class="nv">decoded</span> <span class="o">|</span> <span class="nf">string</span> <span class="o">|</span> <span class="nf">b64encode</span><span class="o">(</span><span class="nv">encoding</span><span class="o">=</span><span class="s1">&#39;utf-16-le&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">string</span></code> filter is only required for Python 2 and ensures that text to encode is a unicode string. Without that filter before b64encode the wrong value will be encoded.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.6.</span></p>
</div>
</section>
<section id="managing-uuids">
<h2><a class="toc-backref" href="#id44">Managing UUIDs</a><a class="headerlink" href="#managing-uuids" title="Permalink to this headline"></a></h2>
<p>To create a namespaced UUIDv5:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">string</span> <span class="o">|</span> <span class="nf">to_uuid</span><span class="o">(</span><span class="nv">namespace</span><span class="o">=</span><span class="s1">&#39;11111111-2222-3333-4444-555555555555&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.10.</span></p>
</div>
<p>To create a namespaced UUIDv5 using the default Ansible namespace ‘361E6D51-FAEC-444A-9079-341386DA8E2E’:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">string</span> <span class="o">|</span> <span class="nf">to_uuid</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.9.</span></p>
</div>
<p>To make use of one attribute from each item in a list of complex variables, use the <a class="reference external" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#jinja-filters.map" title="(in Jinja v3.1.x)"><code class="xref py py-func docutils literal notranslate"><span class="pre">Jinja2</span> <span class="pre">map</span> <span class="pre">filter</span></code></a>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a comma-separated list of the mount points (for example, &quot;/,/mnt/stuff&quot;) on a host</span>
<span class="cp">{{</span> <span class="nv">ansible_mounts</span> <span class="o">|</span> <span class="nf">map</span><span class="o">(</span><span class="nv">attribute</span><span class="o">=</span><span class="s1">&#39;mount&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">join</span><span class="o">(</span><span class="s1">&#39;,&#39;</span><span class="o">)</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="handling-dates-and-times">
<h2><a class="toc-backref" href="#id45">Handling dates and times</a><a class="headerlink" href="#handling-dates-and-times" title="Permalink to this headline"></a></h2>
<p>To get a date object from a string use the <cite>to_datetime</cite> filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get total amount of seconds between two dates. Default date format is %Y-%m-%d %H:%M:%S but you can pass your own format</span>
<span class="cp">{{</span> <span class="o">((</span><span class="s2">&quot;2016-08-14 20:00:12&quot;</span> <span class="o">|</span> <span class="nf">to_datetime</span><span class="o">)</span> <span class="o">-</span> <span class="o">(</span><span class="s2">&quot;2015-12-25&quot;</span> <span class="o">|</span> <span class="nf">to_datetime</span><span class="o">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="o">)))</span><span class="nv">.total_seconds</span><span class="o">()</span>  <span class="cp">}}</span>

<span class="c1"># Get remaining seconds after delta has been calculated. NOTE: This does NOT convert years, days, hours, and so on to seconds. For that, use total_seconds()</span>
<span class="cp">{{</span> <span class="o">((</span><span class="s2">&quot;2016-08-14 20:00:12&quot;</span> <span class="o">|</span> <span class="nf">to_datetime</span><span class="o">)</span> <span class="o">-</span> <span class="o">(</span><span class="s2">&quot;2016-08-14 18:00:00&quot;</span> <span class="o">|</span> <span class="nf">to_datetime</span><span class="o">))</span><span class="nv">.seconds</span>  <span class="cp">}}</span>
<span class="c1"># This expression evaluates to &quot;12&quot; and not &quot;132&quot;. Delta is 2 hours, 12 seconds</span>

<span class="c1"># get amount of days between two dates. This returns only number of days and discards remaining hours, minutes, and seconds</span>
<span class="cp">{{</span> <span class="o">((</span><span class="s2">&quot;2016-08-14 20:00:12&quot;</span> <span class="o">|</span> <span class="nf">to_datetime</span><span class="o">)</span> <span class="o">-</span> <span class="o">(</span><span class="s2">&quot;2015-12-25&quot;</span> <span class="o">|</span> <span class="nf">to_datetime</span><span class="o">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="o">)))</span><span class="nv">.days</span>  <span class="cp">}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a full list of format codes for working with python date format strings, see <a class="reference external" href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior</a>.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.4.</span></p>
</div>
<p>To format a date using a string (like with the shell date command), use the “strftime” filter:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display year-month-day</span>
<span class="cp">{{</span> <span class="s1">&#39;%Y-%m-%d&#39;</span> <span class="o">|</span> <span class="nf">strftime</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;2021-03-19&quot;</span>

<span class="c1"># Display hour:min:sec</span>
<span class="cp">{{</span> <span class="s1">&#39;%H:%M:%S&#39;</span> <span class="o">|</span> <span class="nf">strftime</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;21:51:04&quot;</span>

<span class="c1"># Use ansible_date_time.epoch fact</span>
<span class="cp">{{</span> <span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span> <span class="o">|</span> <span class="nf">strftime</span><span class="o">(</span><span class="nv">ansible_date_time.epoch</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &quot;2021-03-19 21:54:09&quot;</span>

<span class="c1"># Use arbitrary epoch value</span>
<span class="cp">{{</span> <span class="s1">&#39;%Y-%m-%d&#39;</span> <span class="o">|</span> <span class="nf">strftime</span><span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="cp">}}</span>          <span class="c1"># =&gt; 1970-01-01</span>
<span class="cp">{{</span> <span class="s1">&#39;%Y-%m-%d&#39;</span> <span class="o">|</span> <span class="nf">strftime</span><span class="o">(</span><span class="m">1441357287</span><span class="o">)</span> <span class="cp">}}</span> <span class="c1"># =&gt; 2015-09-04</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To get all string possibilities, check <a class="reference external" href="https://docs.python.org/3/library/time.html#time.strftime">https://docs.python.org/3/library/time.html#time.strftime</a></p>
</div>
</section>
<section id="getting-kubernetes-resource-names">
<h2><a class="toc-backref" href="#id46">Getting Kubernetes resource names</a><a class="headerlink" href="#getting-kubernetes-resource-names" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These filters have migrated to the <a class="reference external" href="https://galaxy.ansible.com/kubernetes/core">kubernetes.core</a> collection. Follow the installation instructions to install that collection.</p>
</div>
<p>Use the “k8s_config_resource_name” filter to obtain the name of a Kubernetes ConfigMap or Secret,
including its hash:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">configmap_resource_definition</span> <span class="o">|</span> <span class="nf">kubernetes</span><span class="nv">.core.k8s_config_resource_name</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>This can then be used to reference hashes in Pod specifications:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">my_secret</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
  <span class="nt">metadata</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_secret_name</span>

<span class="nt">deployment_resource</span><span class="p">:</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
  <span class="nt">spec</span><span class="p">:</span>
    <span class="nt">template</span><span class="p">:</span>
      <span class="nt">spec</span><span class="p">:</span>
        <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">envFrom</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">secretRef</span><span class="p">:</span>
                <span class="nt">name</span><span class="p">:</span> <span class="cp">{{</span> <span class="nv">my_secret</span> <span class="o">|</span> <span class="nf">kubernetes</span><span class="nv">.core.k8s_config_resource_name</span> <span class="cp">}}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.8.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="playbooks_intro.html#about-playbooks"><span class="std std-ref">Intro to playbooks</span></a></dt><dd><p>An introduction to playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html#playbooks-conditionals"><span class="std std-ref">Conditionals</span></a></dt><dd><p>Conditional statements in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a></dt><dd><p>All about variables</p>
</dd>
<dt><a class="reference internal" href="playbooks_loops.html#playbooks-loops"><span class="std std-ref">Loops</span></a></dt><dd><p>Looping in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_reuse_roles.html#playbooks-reuse-roles"><span class="std std-ref">Roles</span></a></dt><dd><p>Playbook organization by roles</p>
</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html#playbooks-best-practices"><span class="std std-ref">Tips and tricks</span></a></dt><dd><p>Tips and tricks for playbooks</p>
</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-devel">User Mailing List</a></dt><dd><p>Have a question?  Stop by the google group!</p>
</dd>
<dt><a class="reference internal" href="../community/communication.html#communication-irc"><span class="std std-ref">Real-time chat</span></a></dt><dd><p>How to join Ansible chat channels</p>
</dd>
</dl>
</div>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="playbooks_templating.html" class="btn btn-neutral float-left" title="Templating (Jinja2)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="playbooks_tests.html" class="btn btn-neutral float-right" title="Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ansible project contributors.
      <span class="lastupdated">Last updated on Jul 06, 2022.
      </span></p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->
<!-- begin analytics -->
<script>
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = 'https://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script>
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script>

</body>
</html>