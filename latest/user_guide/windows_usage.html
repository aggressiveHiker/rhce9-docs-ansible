<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using Ansible and Windows &mdash; Ansible Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/ansible.css" type="text/css" />
      <link rel="stylesheet" href="../_static/antsibull-minimal.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/rtd-ethical-ads.css" type="text/css" />
    <link rel="shortcut icon" href="_static/images/Ansible-Mark-RGB_Black.svg"/>
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/user_guide/windows_usage.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Desired State Configuration" href="windows_dsc.html" />
    <link rel="prev" title="Windows Remote Management" href="windows_winrm.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->
<script src="https://www.redhat.com/dtm.js"></script>


<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="6">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->



<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','https://s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
    <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
    <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
    <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/Ansible-Mark-RGB_White.svg"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Documentation</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ansible
          </a>
              <div class="version">
                6
              </div><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <script>
        function switchVersionTo(slug) {
          var current_url_path = window.location.pathname;
          var url_version = current_url_path.search("/6/") > -1
            ? "/6/"
            : "/latest/";
          var new_version_url = current_url_path.replace(url_version, "/" + slug + "/");
          window.location.replace(new_version_url);
        }
      </script>
      <select
          class="version-list"
          id="version-list"
          onchange="switchVersionTo(this.value);"
      >
        
        <option
            value="latest"
            
        >
            latest
        </option>
        
        <option
            value="2.9"
            
        >
            2.9
        </option>
        
        <option
            value="devel"
            
        >
            devel
        </option>
        
      </select>
    </div>
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Ansible getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting started with Ansible</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tasks-plays-and-playbooks">Writing tasks, plays, and playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-inventory">Working with inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#interacting-with-data">Interacting with data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#executing-playbooks">Executing playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-features-and-reference">Advanced features and reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#table-of-contents">Table of contents</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basic_concepts.html">Ansible concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_adhoc.html">Introduction to ad hoc commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="cheatsheet.html">Ansible CLI cheatsheet</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_intro.html">Intro to playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks.html">Working with playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_best_practices.html">Tips and tricks</a></li>
<li class="toctree-l3"><a class="reference internal" href="become.html">Understanding privilege escalation: become</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_delegation.html">Controlling where tasks run: delegation and local actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tests.html">Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_handlers.html">Handlers: running operations on change</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_error_handling.html">Error handling in playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html">Setting the remote environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_environment.html#working-with-language-specific-version-managers">Working with language-specific version managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse.html">Re-using Ansible artifacts</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse_roles.html">Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse_includes.html">Including and importing</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_tags.html">Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_inventory.html">How to build your inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_dynamic_inventory.html">Working with dynamic inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_patterns.html">Patterns: targeting hosts and groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="connection_details.html">Connection methods and details</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_tools.html">Working with command line tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_variables.html">Using Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_vars_facts.html">Discovering variables: facts and magic variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="vault.html">Encrypting content with Ansible Vault</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_filters.html">Using filters to manipulate data</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_lookups.html">Lookups</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_prompts.html">Interactive input: prompts</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_module_defaults.html">Module defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_checkmode.html">Validating tasks: check mode and diff mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_startnstep.html">Executing playbooks for troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_debugger.html">Debugging tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_strategies.html">Controlling playbook execution: strategies and more</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_async.html">Asynchronous actions and polling</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_advanced_syntax.html">Advanced Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="complex_data_manipulation.html">Data manipulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_filtering_config.html">Rejecting modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample_setup.html">Sample Ansible setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="modules.html">Working With Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/plugins.html">Working with plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro_bsd.html">Ansible and BSD</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="windows.html">Windows Guides</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="windows_setup.html">Setting up a Windows Host</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_winrm.html">Windows Remote Management</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Using Ansible and Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_dsc.html">Desired State Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_performance.html">Windows performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_faq.html">Windows Frequently Asked Questions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="collections_using.html">Using collections</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions_collections.html">Ansible Collections Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/contributions.html">ansible-core Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/advanced_index.html">Advanced Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/style_guide/index.html">Ansible documentation style guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Legacy Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html">Collection Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections/all_plugins.html">Indexes of all modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Releases and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Automation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_roadmap_index.html">Ansible Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/ansible_core_roadmap_index.html">ansible-core Roadmaps</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">User Guide</a> &raquo;</li>
          <li><a href="windows.html">Windows Guides</a> &raquo;</li>
      <li>Using Ansible and Windows</li>
  <li class="wy-breadcrumbs-aside">
          <!-- Ansible-specific additions for modules etc -->
            
              <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/user_guide/windows_usage.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
            
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script>
    function startsWith(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    function startsWithOneOf(str, needles) {
      return needles.some(function (needle) {
        return startsWith(str, needle);
      });
    }
    var banner = '';
      var extra_banner = '';
    /*use extra_banner for when marketing wants something extra, like a survey or AnsibleFest notice
    var extra_banner =
      '<div id="latest_extra_banner_id" class="admonition important">' +
      '<br>' +
      '<p>' +
        'You\'re invited to AnsibleFest 2021! ' +
      '<p>' +
        'Explore ways to automate, innovate, and accelerate with our free virtual event September 29-30. ' +
      '<pr>' +
        '<a href="https://reg.ansiblefest.redhat.com/flow/redhat/ansible21/regGenAttendee/login?sc_cid=7013a000002pemAAAQ">Register now!</a> ' +
      '</p>' +
      '<br>' +
      '</div>'; */
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">' +
                     '<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>' +
                     '</div>');
    }
    
      // Create a banner
      current_url_path = window.location.pathname;

      var important = false;
      var msg = '<p>';
      if (startsWith(current_url_path, "/ansible-core/")) {
        msg += 'You are reading documentation for Ansible Core, which contains no plugins except for those in ansible.builtin. For documentation of the Ansible package, go to <a href="/ansible/latest">the latest documentation</a>.';
      } else if (startsWithOneOf(current_url_path, ["/ansible/latest/", "/ansible/6/"])) {
        /* temp extra banner to advertise AnsibeFest2021 */
        banner += extra_banner;

        msg += 'You are reading the <b>latest</b> (stable) community version of the Ansible documentation. Red Hat subscribers, select <b>2.9</b> in the version selection to the left for the most recent Red Hat release.';
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        msg += 'You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this version, or select <b>latest</b> from the version selector to the left for the most recent community version.';
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        /* temp extra banner to advertise AnsibleFest2021 */
        banner += extra_banner;

        /* temp banner to advertise survey
        important = true;
        msg += 'Please take our <a href="https://www.surveymonkey.co.uk/r/B9V3CDY">Docs survey</a> before December 31 to help us improve Ansible documentation.';
        */

        msg += 'You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      } else {
        msg += 'You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      }
      msg += '</p>';

      banner += '<div id="banner_id" class="admonition ';
      banner += important ? 'important' : 'caution';
      banner += '">';
      banner += important ? '<br>' : '';
      banner += msg;
      banner += important ? '<br>' : '';
      banner += '</div>';
      document.write(banner);
    
  </script>


  
           <div itemprop="articleBody">
             
  <section id="using-ansible-and-windows">
<h1>Using Ansible and Windows<a class="headerlink" href="#using-ansible-and-windows" title="Permalink to this headline"></a></h1>
<p>When using Ansible to manage Windows, many of the syntax and rules that apply
for Unix/Linux hosts also apply to Windows, but there are still some differences
when it comes to components like path separators and OS-specific tasks.
This document covers details specific to using Ansible for Windows.</p>
<div class="contents local topic" id="topics">
<p class="topic-title">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#use-cases" id="id1">Use Cases</a></p>
<ul>
<li><p><a class="reference internal" href="#installing-software" id="id2">Installing Software</a></p></li>
<li><p><a class="reference internal" href="#installing-updates" id="id3">Installing Updates</a></p></li>
<li><p><a class="reference internal" href="#set-up-users-and-groups" id="id4">Set Up Users and Groups</a></p>
<ul>
<li><p><a class="reference internal" href="#local" id="id5">Local</a></p></li>
<li><p><a class="reference internal" href="#domain" id="id6">Domain</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-commands" id="id7">Running Commands</a></p>
<ul>
<li><p><a class="reference internal" href="#choosing-command-or-shell" id="id8">Choosing Command or Shell</a></p></li>
<li><p><a class="reference internal" href="#argument-rules" id="id9">Argument Rules</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-and-running-a-scheduled-task" id="id10">Creating and Running a Scheduled Task</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#path-formatting-for-windows" id="id11">Path Formatting for Windows</a></p>
<ul>
<li><p><a class="reference internal" href="#yaml-style" id="id12">YAML Style</a></p></li>
<li><p><a class="reference internal" href="#legacy-key-value-style" id="id13">Legacy key=value Style</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#limitations" id="id14">Limitations</a></p></li>
<li><p><a class="reference internal" href="#developing-windows-modules" id="id15">Developing Windows Modules</a></p></li>
</ul>
</div>
<section id="use-cases">
<h2><a class="toc-backref" href="#id1">Use Cases</a><a class="headerlink" href="#use-cases" title="Permalink to this headline"></a></h2>
<p>Ansible can be used to orchestrate a multitude of tasks on Windows servers.
Below are some examples and info about common tasks.</p>
<section id="installing-software">
<h3><a class="toc-backref" href="#id2">Installing Software</a><a class="headerlink" href="#installing-software" title="Permalink to this headline"></a></h3>
<p>There are three main ways that Ansible can be used to install software:</p>
<ul class="simple">
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">win_chocolatey</span></code> module. This sources the program data from the default
public <a class="reference external" href="https://chocolatey.org/">Chocolatey</a> repository. Internal repositories can
be used instead by setting the <code class="docutils literal notranslate"><span class="pre">source</span></code> option.</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">win_package</span></code> module. This installs software using an MSI or .exe installer
from a local/network path or URL.</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">win_command</span></code> or <code class="docutils literal notranslate"><span class="pre">win_shell</span></code> module to run an installer manually.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">win_chocolatey</span></code> module is recommended since it has the most complete logic for checking to see if a package has already been installed and is up-to-date.</p>
<p>Below are some examples of using all three options to install 7-Zip:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install/uninstall with chocolatey</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is installed via Chocolatey</span>
  <span class="nt">win_chocolatey</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is not installed via Chocolatey</span>
  <span class="nt">win_chocolatey</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="c1"># Install/uninstall with win_package</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download the 7-Zip package</span>
  <span class="nt">win_get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://www.7-zip.org/a/7z1701-x64.msi</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is installed via win_package</span>
  <span class="nt">win_package</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is not installed via win_package</span>
  <span class="nt">win_package</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="c1"># Install/uninstall with win_command</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download the 7-Zip package</span>
  <span class="nt">win_get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://www.7-zip.org/a/7z1701-x64.msi</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Check if 7-Zip is already installed</span>
  <span class="nt">win_reg_stat</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{23170F69-40C1-2702-1701-000001000000}</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip_installed</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is installed via win_command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Windows\System32\msiexec.exe /i C:\temp\7z.msi /qn /norestart</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip_installed.exists == false</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is uninstalled via win_command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Windows\System32\msiexec.exe /x {23170F69-40C1-2702-1701-000001000000} /qn /norestart</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip_installed.exists == true</span>
</pre></div>
</div>
<p>Some installers like Microsoft Office or SQL Server require credential delegation or
access to components restricted by WinRM. The best method to bypass these
issues is to use <code class="docutils literal notranslate"><span class="pre">become</span></code> with the task. With <code class="docutils literal notranslate"><span class="pre">become</span></code>, Ansible will run
the installer as if it were run interactively on the host.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many installers do not properly pass back error information over WinRM. In these cases, if the install has been  verified to work locally the recommended method is to use become.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some installers restart the WinRM or HTTP services, or cause them to become temporarily unavailable, making Ansible assume the system is unreachable.</p>
</div>
</section>
<section id="installing-updates">
<h3><a class="toc-backref" href="#id3">Installing Updates</a><a class="headerlink" href="#installing-updates" title="Permalink to this headline"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">win_updates</span></code> and <code class="docutils literal notranslate"><span class="pre">win_hotfix</span></code> modules can be used to install updates
or hotfixes on a host. The module <code class="docutils literal notranslate"><span class="pre">win_updates</span></code> is used to install multiple
updates by category, while <code class="docutils literal notranslate"><span class="pre">win_hotfix</span></code> can be used to install a single
update or hotfix file that has been downloaded locally.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">win_hotfix</span></code> module has a requirement that the DISM PowerShell cmdlets are
present. These cmdlets were only added by default on Windows Server 2012
and newer and must be installed on older Windows hosts.</p>
</div>
<p>The following example shows how <code class="docutils literal notranslate"><span class="pre">win_updates</span></code> can be used:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install all critical and security updates</span>
  <span class="nt">win_updates</span><span class="p">:</span>
    <span class="nt">category_names</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CriticalUpdates</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">SecurityUpdates</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">installed</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update_result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Reboot host if required</span>
  <span class="nt">win_reboot</span><span class="p">:</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update_result.reboot_required</span>
</pre></div>
</div>
<p>The following example show how <code class="docutils literal notranslate"><span class="pre">win_hotfix</span></code> can be used to install a single
update or hotfix:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download KB3172729 for Server 2012 R2</span>
  <span class="nt">win_get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://download.windowsupdate.com/d/msdownload/update/software/secu/2016/07/windows8.1-kb3172729-x64_e8003822a7ef4705cbb65623b72fd3cec73fe222.msu</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\KB3172729.msu</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install hotfix</span>
  <span class="nt">win_hotfix</span><span class="p">:</span>
    <span class="nt">hotfix_kb</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KB3172729</span>
    <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\KB3172729.msu</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hotfix_result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Reboot host if required</span>
  <span class="nt">win_reboot</span><span class="p">:</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hotfix_result.reboot_required</span>
</pre></div>
</div>
</section>
<section id="set-up-users-and-groups">
<h3><a class="toc-backref" href="#id4">Set Up Users and Groups</a><a class="headerlink" href="#set-up-users-and-groups" title="Permalink to this headline"></a></h3>
<p>Ansible can be used to create Windows users and groups both locally and on a domain.</p>
<section id="local">
<h4><a class="toc-backref" href="#id5">Local</a><a class="headerlink" href="#local" title="Permalink to this headline"></a></h4>
<p>The modules <code class="docutils literal notranslate"><span class="pre">win_user</span></code>, <code class="docutils literal notranslate"><span class="pre">win_group</span></code> and <code class="docutils literal notranslate"><span class="pre">win_group_membership</span></code> manage
Windows users, groups and group memberships locally.</p>
<p>The following is an example of creating local accounts and groups that can
access a folder on the same host:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create local group to contain new users</span>
  <span class="nt">win_group</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LocalGroup</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow access to C:\Development folder</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create local user</span>
  <span class="nt">win_user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.password</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">groups</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LocalGroup</span>
    <span class="nt">update_password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">password_never_expires</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="nt">loop</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User1</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User2</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password2</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create Development folder</span>
  <span class="nt">win_file</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Development</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set ACL of Development folder</span>
  <span class="nt">win_acl</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Development</span>
    <span class="nt">rights</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FullControl</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">allow</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LocalGroup</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove parent inheritance of Development folder</span>
  <span class="nt">win_acl_inheritance</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Development</span>
    <span class="nt">reorganize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
</pre></div>
</div>
</section>
<section id="domain">
<h4><a class="toc-backref" href="#id6">Domain</a><a class="headerlink" href="#domain" title="Permalink to this headline"></a></h4>
<p>The modules <code class="docutils literal notranslate"><span class="pre">win_domain_user</span></code> and <code class="docutils literal notranslate"><span class="pre">win_domain_group</span></code> manages users and
groups in a domain. The below is an example of ensuring a batch of domain users
are created:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure each account is created</span>
  <span class="nt">win_domain_user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">upn</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">@MY.DOMAIN.COM&#39;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.password</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">password_never_expires</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Test User</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
    <span class="nt">company</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible</span>
    <span class="nt">update_password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on_create</span>
  <span class="nt">loop</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Test User</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Admin User</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SuperSecretPass01</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Dev User</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;@fvr3IbFBujSRh!3hBg%wgFucD8^x8W5&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="running-commands">
<h3><a class="toc-backref" href="#id7">Running Commands</a><a class="headerlink" href="#running-commands" title="Permalink to this headline"></a></h3>
<p>In cases where there is no appropriate module available for a task,
a command or script can be run using the <code class="docutils literal notranslate"><span class="pre">win_shell</span></code>, <code class="docutils literal notranslate"><span class="pre">win_command</span></code>, <code class="docutils literal notranslate"><span class="pre">raw</span></code>, and <code class="docutils literal notranslate"><span class="pre">script</span></code> modules.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">raw</span></code> module simply executes a Powershell command remotely. Since <code class="docutils literal notranslate"><span class="pre">raw</span></code>
has none of the wrappers that Ansible typically uses, <code class="docutils literal notranslate"><span class="pre">become</span></code>, <code class="docutils literal notranslate"><span class="pre">async</span></code>
and environment variables do not work.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">script</span></code> module executes a script from the Ansible controller on
one or more Windows hosts. Like <code class="docutils literal notranslate"><span class="pre">raw</span></code>, <code class="docutils literal notranslate"><span class="pre">script</span></code> currently does not support
<code class="docutils literal notranslate"><span class="pre">become</span></code>, <code class="docutils literal notranslate"><span class="pre">async</span></code>, or environment variables.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">win_command</span></code> module is used to execute a command which is either an
executable or batch file, while the <code class="docutils literal notranslate"><span class="pre">win_shell</span></code> module is used to execute commands within a shell.</p>
<section id="choosing-command-or-shell">
<h4><a class="toc-backref" href="#id8">Choosing Command or Shell</a><a class="headerlink" href="#choosing-command-or-shell" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">win_shell</span></code> and <code class="docutils literal notranslate"><span class="pre">win_command</span></code> modules can both be used to execute a command or commands.
The <code class="docutils literal notranslate"><span class="pre">win_shell</span></code> module is run within a shell-like process like <code class="docutils literal notranslate"><span class="pre">PowerShell</span></code> or <code class="docutils literal notranslate"><span class="pre">cmd</span></code>, so it has access to shell
operators like <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">;</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code>, and <code class="docutils literal notranslate"><span class="pre">||</span></code>. Multi-lined commands can also be run in <code class="docutils literal notranslate"><span class="pre">win_shell</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">win_command</span></code> module simply runs a process outside of a shell. It can still
run a shell command like <code class="docutils literal notranslate"><span class="pre">mkdir</span></code> or <code class="docutils literal notranslate"><span class="pre">New-Item</span></code> by passing the shell commands
to a shell executable like <code class="docutils literal notranslate"><span class="pre">cmd.exe</span></code> or <code class="docutils literal notranslate"><span class="pre">PowerShell.exe</span></code>.</p>
<p>Here are some examples of using <code class="docutils literal notranslate"><span class="pre">win_command</span></code> and <code class="docutils literal notranslate"><span class="pre">win_shell</span></code>:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a command under PowerShell</span>
  <span class="nt">win_shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get-Service -Name service | Stop-Service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a command under cmd</span>
  <span class="nt">win_shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mkdir C:\temp</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="nt">executable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cmd.exe</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a multiple shell commands</span>
  <span class="nt">win_shell</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">New-Item -Path C:\temp -ItemType Directory</span>
    <span class="no">Remove-Item -Path C:\temp -Force -Recurse</span>
    <span class="no">$path_info = Get-Item -Path C:\temp</span>
    <span class="no">$path_info.FullName</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run an executable using win_command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">whoami.exe</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a cmd command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cmd.exe /c mkdir C:\temp</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a vbs script</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cscript.exe script.vbs</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some commands like <code class="docutils literal notranslate"><span class="pre">mkdir</span></code>, <code class="docutils literal notranslate"><span class="pre">del</span></code>, and <code class="docutils literal notranslate"><span class="pre">copy</span></code> only exist in
the CMD shell. To run them with <code class="docutils literal notranslate"><span class="pre">win_command</span></code> they must be
prefixed with <code class="docutils literal notranslate"><span class="pre">cmd.exe</span> <span class="pre">/c</span></code>.</p>
</div>
</section>
<section id="argument-rules">
<h4><a class="toc-backref" href="#id9">Argument Rules</a><a class="headerlink" href="#argument-rules" title="Permalink to this headline"></a></h4>
<p>When running a command through <code class="docutils literal notranslate"><span class="pre">win_command</span></code>, the standard Windows argument
rules apply:</p>
<ul class="simple">
<li><p>Each argument is delimited by a white space, which can either be a space or a
tab.</p></li>
<li><p>An argument can be surrounded by double quotes <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>. Anything inside these
quotes is interpreted as a single argument even if it contains whitespace.</p></li>
<li><p>A double quote preceded by a backslash <code class="docutils literal notranslate"><span class="pre">\</span></code> is interpreted as just a double
quote <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> and not as an argument delimiter.</p></li>
<li><p>Backslashes are interpreted literally unless it immediately precedes double
quotes; for example <code class="docutils literal notranslate"><span class="pre">\</span></code> == <code class="docutils literal notranslate"><span class="pre">\</span></code> and <code class="docutils literal notranslate"><span class="pre">\&quot;</span></code> == <code class="docutils literal notranslate"><span class="pre">&quot;</span></code></p></li>
<li><p>If an even number of backslashes is followed by a double quote, one
backslash is used in the argument for every pair, and the double quote is
used as a string delimiter for the argument.</p></li>
<li><p>If an odd number of backslashes is followed by a double quote, one backslash
is used in the argument for every pair, and the double quote is escaped and
made a literal double quote in the argument.</p></li>
</ul>
<p>With those rules in mind, here are some examples of quoting:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\executable.exe argument1 &quot;argument 2&quot; &quot;C:\path\with space&quot; &quot;double \&quot;quoted\&quot;&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">argv[0] = C:\temp\executable.exe</span>
<span class="l l-Scalar l-Scalar-Plain">argv[1] = argument1</span>
<span class="l l-Scalar l-Scalar-Plain">argv[2] = argument 2</span>
<span class="l l-Scalar l-Scalar-Plain">argv[3] = C:\path\with space</span>
<span class="l l-Scalar l-Scalar-Plain">argv[4] = double &quot;quoted&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">win_command</span><span class="p">:</span> <span class="s">&#39;&quot;C:\Program</span><span class="nv"> </span><span class="s">Files\Program\program.exe&quot;</span><span class="nv"> </span><span class="s">&quot;escaped</span><span class="nv"> </span><span class="s">\\\&quot;</span><span class="nv"> </span><span class="s">backslash&quot;</span><span class="nv"> </span><span class="s">unquoted-end-backslash\&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">argv[0] = C:\Program Files\Program\program.exe</span>
<span class="l l-Scalar l-Scalar-Plain">argv[1] = escaped \&quot; backslash</span>
<span class="l l-Scalar l-Scalar-Plain">argv[2] = unquoted-end-backslash\</span>

<span class="c1"># Due to YAML and Ansible parsing &#39;\&quot;&#39; must be written as &#39;</span><span class="cp">{%</span> <span class="k">raw</span> <span class="cp">%}</span>\\<span class="cp">{%</span> <span class="k">endraw</span> <span class="cp">%}</span><span class="c1">&quot;&#39;</span>
<span class="p p-Indicator">-</span> <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\executable.exe C:\no\space\path &quot;arg with end \ before end quote</span><span class="cp">{%</span> <span class="k">raw</span> <span class="cp">%}</span>\\<span class="cp">{%</span> <span class="k">endraw</span> <span class="cp">%}</span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">argv[0] = C:\temp\executable.exe</span>
<span class="l l-Scalar l-Scalar-Plain">argv[1] = C:\no\space\path</span>
<span class="l l-Scalar l-Scalar-Plain">argv[2] = arg with end \ before end quote\&quot;</span>
</pre></div>
</div>
<p>For more information, see <a class="reference external" href="https://msdn.microsoft.com/en-us/library/17w5ykft(v=vs.85).aspx">escaping arguments</a>.</p>
</section>
</section>
<section id="creating-and-running-a-scheduled-task">
<h3><a class="toc-backref" href="#id10">Creating and Running a Scheduled Task</a><a class="headerlink" href="#creating-and-running-a-scheduled-task" title="Permalink to this headline"></a></h3>
<p>WinRM has some restrictions in place that cause errors when running certain
commands. One way to bypass these restrictions is to run a command through a
scheduled task. A scheduled task is a Windows component that provides the
ability to run an executable on a schedule and under a different account.</p>
<p>Ansible version 2.5 added modules that make it easier to work with scheduled tasks in Windows.
The following is an example of running a script as a scheduled task that deletes itself after
running:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create scheduled task to run a process</span>
  <span class="nt">win_scheduled_task</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">adhoc-task</span>
    <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SYSTEM</span>
    <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PowerShell.exe</span>
      <span class="nt">arguments</span><span class="p">:</span> <span class="p p-Indicator">|</span>
        <span class="no">Start-Sleep -Seconds 30  # This isn&#39;t required, just here as a demonstration</span>
        <span class="no">New-Item -Path C:\temp\test -ItemType Directory</span>
    <span class="c1"># Remove this action if the task shouldn&#39;t be deleted on completion</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cmd.exe</span>
      <span class="nt">arguments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/c schtasks.exe /Delete /TN &quot;adhoc-task&quot; /F</span>
    <span class="nt">triggers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">registration</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Wait for the scheduled task to complete</span>
  <span class="nt">win_scheduled_task_stat</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">adhoc-task</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">task_stat</span>
  <span class="nt">until</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(task_stat.state is defined and task_stat.state.status != &quot;TASK_STATE_RUNNING&quot;) or (task_stat.task_exists == False)</span>
  <span class="nt">retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
  <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The modules used in the above example were updated/added in Ansible
version 2.5.</p>
</div>
</section>
</section>
<section id="path-formatting-for-windows">
<h2><a class="toc-backref" href="#id11">Path Formatting for Windows</a><a class="headerlink" href="#path-formatting-for-windows" title="Permalink to this headline"></a></h2>
<p>Windows differs from a traditional POSIX operating system in many ways. One of
the major changes is the shift from <code class="docutils literal notranslate"><span class="pre">/</span></code> as the path separator to <code class="docutils literal notranslate"><span class="pre">\</span></code>. This
can cause major issues with how playbooks are written, since <code class="docutils literal notranslate"><span class="pre">\</span></code> is often used
as an escape character on POSIX systems.</p>
<p>Ansible allows two different styles of syntax; each deals with path separators for Windows differently:</p>
<section id="yaml-style">
<h3><a class="toc-backref" href="#id12">YAML Style</a><a class="headerlink" href="#yaml-style" title="Permalink to this headline"></a></h3>
<p>When using the YAML syntax for tasks, the rules are well-defined by the YAML
standard:</p>
<ul class="simple">
<li><p>When using a normal string (without quotes), YAML will not consider the
backslash an escape character.</p></li>
<li><p>When using single quotes <code class="docutils literal notranslate"><span class="pre">'</span></code>, YAML will not consider the backslash an
escape character.</p></li>
<li><p>When using double quotes <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>, the backslash is considered an escape
character and needs to escaped with another backslash.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should only quote strings when it is absolutely
necessary or required by YAML, and then use single quotes.</p>
</div>
<p>The YAML specification considers the following <a class="reference external" href="https://yaml.org/spec/current.html#id2517668">escape sequences</a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\0</span></code>, <code class="docutils literal notranslate"><span class="pre">\\</span></code>, <code class="docutils literal notranslate"><span class="pre">\&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">\_</span></code>, <code class="docutils literal notranslate"><span class="pre">\a</span></code>, <code class="docutils literal notranslate"><span class="pre">\b</span></code>, <code class="docutils literal notranslate"><span class="pre">\e</span></code>, <code class="docutils literal notranslate"><span class="pre">\f</span></code>, <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">\r</span></code>, <code class="docutils literal notranslate"><span class="pre">\t</span></code>,
<code class="docutils literal notranslate"><span class="pre">\v</span></code>, <code class="docutils literal notranslate"><span class="pre">\L</span></code>, <code class="docutils literal notranslate"><span class="pre">\N</span></code> and <code class="docutils literal notranslate"><span class="pre">\P</span></code> – Single character escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TAB&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;SPACE&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;NBSP&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;LNSP&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;PSP&gt;</span></code> – Special
characters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\x..</span></code> – 2-digit hex escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\u....</span></code> – 4-digit hex escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\U........</span></code> – 8-digit hex escape</p></li>
</ul>
<p>Here are some examples on how to write Windows paths:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="na">tempdir: C:\Windows\Temp</span>

<span class="c1"># WORKS</span>
<span class="na">tempdir: &#39;C:\Windows\Temp&#39;</span>
<span class="na">tempdir: &quot;C:\\Windows\\Temp&quot;</span>

<span class="c1"># BAD, BUT SOMETIMES WORKS</span>
<span class="na">tempdir: C:\\Windows\\Temp</span>
<span class="na">tempdir: &#39;C:\\Windows\\Temp&#39;</span>
<span class="na">tempdir: C:/Windows/Temp</span>
</pre></div>
</div>
<p>This is an example which will fail:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># FAILS
tempdir: &quot;C:\Windows\Temp&quot;
</pre></div>
</div>
<p>This example shows the use of single quotes when they are required:</p>
<div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Copy tomcat config</span>
  <span class="nt">win_copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">log4j.xml</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span><span class="nv">tc_home</span><span class="cp">}}</span><span class="s">\lib\log4j.xml&#39;</span>
</pre></div>
</div>
</section>
<section id="legacy-key-value-style">
<h3><a class="toc-backref" href="#id13">Legacy key=value Style</a><a class="headerlink" href="#legacy-key-value-style" title="Permalink to this headline"></a></h3>
<p>The legacy <code class="docutils literal notranslate"><span class="pre">key=value</span></code> syntax is used on the command line for ad hoc commands,
or inside playbooks. The use of this style is discouraged within playbooks
because backslash characters need to be escaped, making playbooks harder to read.
The legacy syntax depends on the specific implementation in Ansible, and quoting
(both single and double) does not have any effect on how it is parsed by
Ansible.</p>
<p>The Ansible key=value parser parse_kv() considers the following escape
sequences:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\</span></code>, <code class="docutils literal notranslate"><span class="pre">'</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">\a</span></code>, <code class="docutils literal notranslate"><span class="pre">\b</span></code>, <code class="docutils literal notranslate"><span class="pre">\f</span></code>, <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">\r</span></code>, <code class="docutils literal notranslate"><span class="pre">\t</span></code> and
<code class="docutils literal notranslate"><span class="pre">\v</span></code> – Single character escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\x..</span></code> – 2-digit hex escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\u....</span></code> – 4-digit hex escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\U........</span></code> – 8-digit hex escape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\N{...}</span></code> – Unicode character by name</p></li>
</ul>
<p>This means that the backslash is an escape character for some sequences, and it
is usually safer to escape a backslash when in this form.</p>
<p>Here are some examples of using Windows paths with the key=value style:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:\\Windows\\Temp</span>

<span class="c1"># WORKS</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&#39;C:\\Windows\\Temp&#39;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&quot;C:\\Windows\\Temp&quot;</span>

<span class="c1"># BAD, BUT SOMETIMES WORKS</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:\Windows\Temp</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&#39;C:\Windows\Temp&#39;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&quot;C:\Windows\Temp&quot;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:/Windows/Temp</span>

<span class="c1"># FAILS</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:\Windows\temp</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&#39;C:\Windows\temp&#39;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&quot;C:\Windows\temp&quot;</span>
</pre></div>
</div>
<p>The failing examples don’t fail outright but will substitute <code class="docutils literal notranslate"><span class="pre">\t</span></code> with the
<code class="docutils literal notranslate"><span class="pre">&lt;TAB&gt;</span></code> character resulting in <code class="docutils literal notranslate"><span class="pre">tempdir</span></code> being <code class="docutils literal notranslate"><span class="pre">C:\Windows&lt;TAB&gt;emp</span></code>.</p>
</section>
</section>
<section id="limitations">
<h2><a class="toc-backref" href="#id14">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this headline"></a></h2>
<p>Some things you cannot do with Ansible and Windows are:</p>
<ul class="simple">
<li><p>Upgrade PowerShell</p></li>
<li><p>Interact with the WinRM listeners</p></li>
</ul>
<p>Because WinRM is reliant on the services being online and running during normal operations, you cannot upgrade PowerShell or interact with WinRM listeners with Ansible. Both of these actions will cause the connection to fail. This can technically be avoided by using <code class="docutils literal notranslate"><span class="pre">async</span></code> or a scheduled task, but those methods are fragile if the process it runs breaks the underlying connection Ansible uses, and are best left to the bootstrapping process or before an image is
created.</p>
</section>
<section id="developing-windows-modules">
<h2><a class="toc-backref" href="#id15">Developing Windows Modules</a><a class="headerlink" href="#developing-windows-modules" title="Permalink to this headline"></a></h2>
<p>Because Ansible modules for Windows are written in PowerShell, the development
guides for Windows modules differ substantially from those for standard standard modules. Please see
<a class="reference internal" href="../dev_guide/developing_modules_general_windows.html#developing-modules-general-windows"><span class="std std-ref">Windows module development walkthrough</span></a> for more information.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="playbooks_intro.html#playbooks-intro"><span class="std std-ref">Intro to playbooks</span></a></dt><dd><p>An introduction to playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html#playbooks-best-practices"><span class="std std-ref">Tips and tricks</span></a></dt><dd><p>Tips and tricks for playbooks</p>
</dd>
<dt><a class="reference external" href="https://docs.ansible.com/ansible/2.9/modules/list_of_windows_modules.html#windows-modules" title="(in Ansible v2.9)"><span class="xref std std-ref">List of Windows Modules</span></a></dt><dd><p>Windows specific module list, all implemented in PowerShell</p>
</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-project">User Mailing List</a></dt><dd><p>Have a question?  Stop by the google group!</p>
</dd>
<dt><a class="reference internal" href="../community/communication.html#communication-irc"><span class="std std-ref">Real-time chat</span></a></dt><dd><p>How to join Ansible chat channels</p>
</dd>
</dl>
</div>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="windows_winrm.html" class="btn btn-neutral float-left" title="Windows Remote Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="windows_dsc.html" class="btn btn-neutral float-right" title="Desired State Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ansible project contributors.
      <span class="lastupdated">Last updated on Jun 27, 2022.
      </span></p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->
<!-- begin analytics -->
<script>
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = 'https://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script>
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script>

</body>
</html>